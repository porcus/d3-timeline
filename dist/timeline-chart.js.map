{"version":3,"sources":["timeline-chart.js"],"names":["TimelineChart","element","timelineData","opts","constructor","length","self","classList","add","options","extendOptions","forEach","series","data","item","at","getItemAvgDate","from","getItemMinDate","to","getItemMaxDate","sortedItems","sort","a","b","o","i","prevItem","nextItem","allElements","reduce","agg","e","concat","minDt","d3","min","maxDt","max","dateDelta","getTime","zoomOutPct","Date","timelineContainer","select","append","classed","timelineContainerElement","node","elementWidth","width","clientWidth","elementHeight","height","clientHeight","margin","top","right","bottom","left","dataIdClassPrefix","componentWidth","componentHeight","groupWidth","groupHeight","xTimeScaleOriginal","useLocalTimeScale","scaleTime","scaleUtc","domain","range","xTimeScaleForContent","xAxis","axisTop","tickSize","xAxisScaled","zoom","on","zoomed","scaleExtent","Infinity","extent","translateExtent","svg","svgElement","attr","svg_g","call","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","chartContentClipPathId","clipPathRect","interactionRect","enableLiveTimer","now","seriesBackground","selectAll","enter","d","style","index","Math","abs","floor","groupingKey","schemeCategory20","seriesDividers","translucentOverlay","boundingRect","gX","setInterval","handleWidthChange","newWidth","interactionWidth","scale","console","log","groupLabels","text","label","wrap","lineSection","groupIntervalItems","filter","_","type","TYPE","INTERVAL","intervalBarHeight","intervalBarMargin","intervals","curry","addClasses","intervalMinWidth","onClick","intervalTexts","groupDotItems","POINT","dots","tipContentGenerator","tip","container","document","createElement","body","appendChild","placeholderEl","result","_tooltip","getToolTip","window","Popper","Tooltip","placement","title","html","popperOptions","onCreate","p","instance","popper","modifiers","flip","behavior","show","hide","_tooltipNode","onMouseEnter","onMouseLeave","val","tipIsShowing","tipHideDelayTimeoutToken","targetElement","cancelHide","hideWithDelay","clearTimeout","hideNow","setTimeout","rect","getBoundingClientRect","cliprect","scrollY","scrollX","tt","updateTitleContent","updateNowMarker","liveTimerTickInterval","anchorPosition","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dx","parseFloat","dy","tspan","pop","push","join","getComputedTextLength","tspanFirst","nowX","fn","args","Array","prototype","slice","arguments","apply","defaultClass","classes","customClass","idClasses","ids","map","id","onVizChangeFn","event","translate","___dummy___","transform","rescaleX","positionData","getTextPositionData","upToPosition","textWidth","xPosition","percent","textTruncateThreshold","labelText","substr","textSizeInPx","pointOrInterval","animateTransitions","value","undefined","refresh","resetTransform","animate","transition","duration","zoomIdentity","translateToRangeValue","x","translateTo","setZoomScale","k","scaleTo","translateToPercent","normalizedPercentage","delta","translateToDate","date","rangeValue","highlightNodeByIds","idOrIdArray","moveIntoView","highlightCssClassName","idArray","selector","sel","nodes","items","itemToUse","find","itemTime","currentTransform","zoomTransform","neighborInfo","getSeriesNeighbors","nearest","timeCoord","nearestTimeCoord","time","timeDeltaInMs","kNew","ext","defaultOptions","Object","keys","earlierEndingItem","laterStartingItem","earlier","interval","later","Symbol","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAsEMA,a;AACF,+BAAYC,OAAZ,EAAqBC,YAArB,EAAmCC,IAAnC,EAAyC;AAAA;;AACrC,gBAAI,CAACD,YAAD,IAAiBA,aAAaE,WAAb,IAA4B,GAAGA,WAAhD,IAA+D,CAACF,aAAaG,MAAjF,EAAyF,OAAO,IAAP;;AAEzF,gBAAIC,OAAO,IAAX;;AAEAL,oBAAQM,SAAR,CAAkBC,GAAlB,CAAsB,0BAAtB;;AAEA,gBAAIC,UAAU,KAAKC,aAAL,CAAmBP,IAAnB,CAAd;;AAEAD,yBAAaS,OAAb,CAAqB,kBAAU;AAC3B;AACAC,uBAAOC,IAAP,CAAYF,OAAZ,CAAoB,gBAAQ;AACxBG,yBAAKC,EAAL,GAAUT,KAAKU,cAAL,CAAoBF,IAApB,CAAV;AACAA,yBAAKG,IAAL,GAAYX,KAAKY,cAAL,CAAoBJ,IAApB,CAAZ;AACAA,yBAAKK,EAAL,GAAUb,KAAKc,cAAL,CAAoBN,IAApB,CAAV;AACH,iBAJD;AAKA;AACA,oBAAIO,cAAcT,OAAOC,IAAP,CAAYS,IAAZ,CAAiB,UAACC,CAAD,EAAGC,CAAH;AAAA,2BAASD,EAAER,EAAF,GAAOS,EAAET,EAAT,GAAc,CAAC,CAAf,GAAmBQ,EAAER,EAAF,GAAOS,EAAET,EAAT,GAAc,CAAd,GAAkB,CAA9C;AAAA,iBAAjB,CAAlB;AACA;AACAM,4BAAYV,OAAZ,CAAoB,UAACc,CAAD,EAAGC,CAAH,EAAS;AACzBD,sBAAEE,QAAF,GAAaD,KAAK,CAAL,GAAS,IAAT,GAAgBL,YAAYK,IAAE,CAAd,CAA7B;AACAD,sBAAEG,QAAF,GAAaF,KAAKL,YAAYhB,MAAZ,GAAmB,CAAxB,GAA4B,IAA5B,GAAmCgB,YAAYK,IAAE,CAAd,CAAhD;AACH,iBAHD;AAIH,aAdD;;AAgBA;AACA,gBAAIG,cAAc3B,aAAa4B,MAAb,CAAoB,UAACC,GAAD,EAAMC,CAAN;AAAA,uBAAYD,IAAIE,MAAJ,CAAWD,EAAEnB,IAAb,CAAZ;AAAA,aAApB,EAAoD,EAApD,CAAlB;;AAEA,gBAAIqB,QAAQC,GAAGC,GAAH,CAAOP,WAAP,EAAoBvB,KAAKY,cAAzB,CAAZ;AACA,gBAAImB,QAAQF,GAAGG,GAAH,CAAOT,WAAP,EAAoBvB,KAAKc,cAAzB,CAAZ;AACA;AACA,gBAAImB,YAAYF,MAAMG,OAAN,KAAkBN,MAAMM,OAAN,EAAlC;AACA,gBAAIC,aAAa,GAAjB,CAhCqC,CAgCd;AACvBP,oBAAQ,IAAIQ,IAAJ,CAASR,MAAMM,OAAN,KAAmBD,YAAYE,UAAxC,CAAR;AACAJ,oBAAQ,IAAIK,IAAJ,CAASL,MAAMG,OAAN,KAAmBD,YAAYE,UAAxC,CAAR;;AAEA,gBAAIE,oBAAoBR,GAAGS,MAAH,CAAU3C,OAAV,EACnB4C,MADmB,CACZ,KADY,EAEnBC,OAFmB,CAEX,gBAFW,EAEO,IAFP,CAAxB;AAGA,gBAAIC,2BAA2BJ,kBAAkBK,IAAlB,EAA/B;;AAEA,gBAAIC,eAAexC,QAAQyC,KAAR,IAAiBH,yBAAyBI,WAA1C,IAAyD,GAA5E;AACA,gBAAIC,gBAAgB3C,QAAQ4C,MAAR,IAAkBN,yBAAyBO,YAA3C,IAA2D,GAA/E;;AAEA,gBAAIC,SAAS;AACTC,qBAAK,EADI;AAETC,uBAAO,CAFE;AAGTC,wBAAQ,CAHC,EAGG;AACZC,sBAAM;AAJG,aAAb;;AAOA,gBAAIC,oBAAoB,MAAxB;;AAEA,gBAAIC,iBAAiBZ,eAAeM,OAAOI,IAAtB,GAA6BJ,OAAOE,KAAzD;AACA,gBAAIK,kBAAkBV,gBAAgBG,OAAOC,GAAvB,GAA6BD,OAAOG,MAA1D;;AAEA;AACA,gBAAIK,aAAatD,QAAQsD,UAAR,IAAsB,GAAvC,CAzDqC,CAyDQ;;AAE7C;AACA,gBAAIC,cAAcF,kBAAkB5D,aAAaG,MAAjD;AACA;AACA,gBAAI,CAAC,CAACI,QAAQuD,WAAd,EACA;AACIA,8BAAcvD,QAAQuD,WAAtB;AACAF,kCAAkBE,cAAc9D,aAAaG,MAA7C;AACH;;AAED,gBAAI4D,qBAAqB,CAACxD,QAAQyD,iBAAR,KAA8B,IAA9B,GAAqC/B,GAAGgC,SAAH,EAArC,GAAsDhC,GAAGiC,QAAH,EAAvD,EACpBC,MADoB,CACb,CAACnC,KAAD,EAAQG,KAAR,CADa,EAEpBiC,KAFoB,CAEd,CAACP,UAAD,EAAaF,cAAb,CAFc,CAAzB;AAGA,gBAAIU,uBAAuBN,kBAA3B;;AAEA;AACA,gBAAIO,QAAQrC,GAAGsC,OAAH,CAAWF,oBAAX;AACR;AADQ,aAEPG,QAFO,CAEEZ,eAFF,CAAZ,CA1EqC,CA4EL;AAChC,gBAAIa,cAAcH,KAAlB;;AAEA;AACA;AACA,gBAAII,OAAOzC,GAAGyC,IAAH,GACNC,EADM,CACH,MADG,EACKC,MADL,EAENC,WAFM,CAEM,CAAC,CAAD,EAAIC,QAAJ,CAFN,EAGNC,MAHM,CAGC,CAAC,CAAClB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACF,cAAD,EAAiBC,eAAjB,CAAjB,CAHD,EAINoB,eAJM,CAIU,CAAC,CAACnB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACF,cAAD,EAAiBC,eAAjB,CAAjB,CAJV,CAAX;;AAMA,gBAAIqB,MAAM7E,KAAK8E,UAAL,GAAkBzC,kBACvBE,MADuB,CAChB,KADgB,EAEvBwC,IAFuB,CAElB,OAFkB,EAETxB,iBAAiBN,OAAOI,IAAxB,GAA+BJ,OAAOE,KAF7B,EAGvB4B,IAHuB,CAGlB,QAHkB,EAGRvB,kBAAkBP,OAAOC,GAAzB,GAA+BD,OAAOG,MAH9B,CAA5B;;AAKA;AACA,gBAAI4B,QAAQH,IACPtC,MADO,CACA,GADA,EAEPwC,IAFO,CAEF,WAFE,EAEW,eAAe9B,OAAOI,IAAtB,GAA6B,GAA7B,GAAmCJ,OAAOC,GAA1C,GAAgD,GAF3D,CAAZ;AAGA8B,kBAAMC,IAAN,CAAWX,IAAX,EAhGqC,CAgGnB;;AAElB;AACA;AACA;AACA;AACA;;AAEA,qBAASY,MAAT,GAAkB;AACd,uBAAO,CAAC,CAAC,GAAD,IAAM,CAAC,GAAP,GAAW,CAAC,GAAZ,GAAgB,CAAC,GAAjB,GAAqB,CAAC,IAAvB,EAA6BC,OAA7B,CAAqC,QAArC,EAA+C;AAAA,2BAClD,CAACC,IAAIC,OAAOC,eAAP,CAAuB,IAAIC,UAAJ,CAAe,CAAf,CAAvB,EAA0C,CAA1C,IAA+C,MAAMH,IAAI,CAA9D,EAAiEI,QAAjE,CAA0E,EAA1E,CADkD;AAAA,iBAA/C,CAAP;AAGH;;AAED,gBAAIC,yBAAyB,6BAA2BP,QAAxD;AACA,gBAAIQ,eAAeV,MAAMzC,MAAN,CAAa,MAAb,EACdA,MADc,CACP,UADO,EAEdwC,IAFc,CAET,IAFS,EAEHU,sBAFG,EAGdlD,MAHc,CAGP,MAHO,EAIdwC,IAJc,CAIT,GAJS,EAIJtB,UAJI,EAKdsB,IALc,CAKT,GALS,EAKJ,CALI,EAMdA,IANc,CAMT,QANS,EAMCvB,eAND,EAOduB,IAPc,CAOT,OAPS,EAOAxB,iBAAiBE,UAPjB,CAAnB;;AASA;AACA,gBAAIkC,kBAAkBX,MAAMzC,MAAN,CAAa,MAAb,EACjBwC,IADiB,CACZ,OADY,EACH,cADG,EAEjBA,IAFiB,CAEZ,GAFY,EAEPtB,UAFO,EAGjBsB,IAHiB,CAGZ,GAHY,EAGP,CAHO,EAIjBA,IAJiB,CAIZ,QAJY,EAIFvB,eAJE,EAKjBuB,IALiB,CAKZ,OALY,EAKHxB,iBAAiBE,UALd,CAAtB;;AAOA;;AAEA,gBAAItD,QAAQyF,eAAZ,EAA6B;AACzB5F,qBAAK6F,GAAL,GAAWb,MAAMzC,MAAN,CAAa,MAAb,EACNwC,IADM,CACD,WADC,YACoBU,sBADpB,QAENV,IAFM,CAED,OAFC,EAEQ,qBAFR,EAGNA,IAHM,CAGD,IAHC,EAGK,CAHL,EAINA,IAJM,CAID,IAJC,EAIKvB,eAJL,CAAX;AAKH;;AAED,gBAAIsC,mBAAmBd,MAAMe,SAAN,CAAgB,oBAAhB,EAClBxF,IADkB,CACbX,YADa,EAElBoG,KAFkB,GAGlBzD,MAHkB,CAGX,MAHW,EAIlBwC,IAJkB,CAIb,OAJa,EAIJ,mBAJI,EAKlBA,IALkB,CAKb,GALa,EAKR,CALQ,EAMlBA,IANkB,CAMb,GANa,EAMR,UAACkB,CAAD,EAAI7E,CAAJ,EAAU;AAAE,uBAAOsC,cAActC,CAArB;AAAyB,aAN7B,EAOlB2D,IAPkB,CAOb,OAPa,EAOJxB,cAPI,EAQlBwB,IARkB,CAQb,QARa,EAQHrB,WARG,EASlBwC,KATkB,CASZ,MATY,EASJ,UAACD,CAAD,EAAI7E,CAAJ,EAAU;AACrB;AACA,oBAAI+E,QAAQC,KAAKC,GAAL,CAASD,KAAKE,KAAL,CAAW,CAACL,EAAEM,WAAF,IAAiBN,EAAEM,WAAF,GAAc,CAA/B,GAAmCN,EAAEM,WAArC,GAAmDnF,CAApD,IAAuD,EAAlE,IAAsE,CAAtE,GAAwE,CAAjF,CAAZ;AACA,uBAAOS,GAAG2E,gBAAH,CAAoBL,KAApB,CAAP;AACH,aAbkB,CAAvB;;AAeA;AACA,gBAAIM,iBAAiBzB,MAAMe,SAAN,CAAgB,iBAAhB,EAChBxF,IADgB,CACXX,YADW,EAEhBoG,KAFgB,GAGhBzD,MAHgB,CAGT,MAHS,EAIhBwC,IAJgB,CAIX,OAJW,EAIF,gBAJE,EAKhBA,IALgB,CAKX,IALW,EAKL,CALK,EAMhBA,IANgB,CAMX,IANW,EAMLxB,cANK,EAOhBwB,IAPgB,CAOX,IAPW,EAOL,UAACkB,CAAD,EAAI7E,CAAJ,EAAU;AAClB,uBAAOsC,eAAetC,IAAI,CAAnB,CAAP;AACH,aATgB,EAUhB2D,IAVgB,CAUX,IAVW,EAUL,UAACkB,CAAD,EAAI7E,CAAJ,EAAU;AAClB,uBAAOsC,eAAetC,IAAI,CAAnB,CAAP;AACH,aAZgB,CAArB;;AAcA,gBAAIsF,qBAAqB1B,MAAMzC,MAAN,CAAa,MAAb,EACpBwC,IADoB,CACf,GADe,EACVtB,UADU,EAEpBsB,IAFoB,CAEf,GAFe,EAEV,CAFU,EAGpBA,IAHoB,CAGf,OAHe,EAGNxB,iBAAiBE,UAHX,EAIpBsB,IAJoB,CAIf,QAJe,EAILvB,eAJK,EAKpB0C,KALoB,CAKd,MALc,EAKN,MALM,EAMpBA,KANoB,CAMd,cANc,EAME,KANF,CAAzB;;AAQA,gBAAIS,eAAe3B,MAAMzC,MAAN,CAAa,MAAb,EACdwC,IADc,CACT,GADS,EACJ,CADI,EAEdA,IAFc,CAET,GAFS,EAEJ,CAFI,EAGdA,IAHc,CAGT,OAHS,EAGAxB,cAHA,EAIdwB,IAJc,CAIT,QAJS,EAICvB,eAJD,EAKd0C,KALc,CAKR,QALQ,EAKE,MALF,CAAnB;;AAOA;AACA,gBAAIU,KAAK5B,MAAMzC,MAAN,CAAa,GAAb,EACJwC,IADI,CACC,OADD,EACU,QADV,EAEJA,IAFI,CAEC,WAFD,EAEc,iBAAiBvB,eAAjB,GAAmC,GAFjD,EAGJyB,IAHI,CAGCf,KAHD,CAAT;;AAKA;AACA2C,wBAAYC,iBAAZ,EAA+B,IAA/B;;AAEA,qBAASA,iBAAT,GAA6B;AACzB,oBAAIC,WAAWtE,yBAAyBI,WAAzB,GAAuCI,OAAOI,IAA9C,GAAqDJ,OAAOE,KAA5D,GAAoE,CAAnF;;AAEA,oBAAI4D,WAAW,CAAX,IAAgBA,YAAYxD,cAAhC,EACA;AACIA,qCAAiBwD,QAAjB;AACAlC,wBAAIE,IAAJ,CAAS,OAAT,EAAkBxB,cAAlB;AACAkD,mCAAe1B,IAAf,CAAoB,IAApB,EAA0BxB,cAA1B;AACAuC,qCAAiBf,IAAjB,CAAsB,OAAtB,EAA+BxB,cAA/B;AACAoD,iCAAa5B,IAAb,CAAkB,OAAlB,EAA2BxB,cAA3B;;AAEA,wBAAIyD,mBAAmBzD,iBAAiBE,UAAxC;AACAiD,uCAAmB3B,IAAnB,CAAwB,OAAxB,EAAiCiC,gBAAjC;AACAtB,iCAAaX,IAAb,CAAkB,OAAlB,EAA2BiC,gBAA3B;AACArB,oCAAgBZ,IAAhB,CAAqB,OAArB,EAA8BiC,gBAA9B;;AAEArD,uCAAmBK,KAAnB,CAAyB,CAACP,UAAD,EAAaF,cAAb,CAAzB;AACAU,yCAAqBD,KAArB,CAA2B,CAACP,UAAD,EAAaF,cAAb,CAA3B;AACAc,kCAAcH,MAAM+C,KAAN,CAAYhD,oBAAZ,CAAd;AACAK,yBACKK,MADL,CACY,CAAC,CAAClB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACF,cAAD,EAAiBC,eAAjB,CAAjB,CADZ,EAEKoB,eAFL,CAEqB,CAAC,CAACnB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACF,cAAD,EAAiBC,eAAjB,CAAjB,CAFrB;AAGAgB;AACA0C,4BAAQC,GAAR,CAAY,mCAAZ,EAAiD5D,cAAjD,EAAiE,yBAAjE,EAA4FyD,gBAA5F;AACH;AACJ;;AAED;AACA,gBAAI7G,QAAQsD,UAAR,GAAqB,CAAzB,EAA4B;AACxB,oBAAI2D,cAAcpC,MAAMe,SAAN,CAAgB,eAAhB,EACbxF,IADa,CACRX,YADQ,EAEboG,KAFa,GAGbzD,MAHa,CAGN,MAHM,EAIbwC,IAJa,CAIR,OAJQ,EAIC,cAJD,EAKbA,IALa,CAKR,GALQ,EAKH,OALG,EAKM;AALN,iBAMbA,IANa,CAMR,GANQ,EAMH,UAACkB,CAAD,EAAI7E,CAAJ,EAAU;AACjB,2BAAQsC,cAActC,CAAf,GAAqBsC,cAAc,CAA1C,CADiB,CAC8B;AAClD,iBARa,EASbqB,IATa,CASR,IATQ,EASF,OATE,EAUbA,IAVa,CAUR,IAVQ,EAUF,MAVE,EAUO;AAVP,iBAWbsC,IAXa,CAWR;AAAA,2BAAKpB,EAAEqB,KAAP;AAAA,iBAXQ,EAYbrC,IAZa,CAYRsC,IAZQ,EAYF9D,UAZE,CAAlB;;AAcA,oBAAI+D,cAAcxC,MAAMzC,MAAN,CAAa,MAAb,EAAqBwC,IAArB,CAA0B,IAA1B,EAAgCtB,UAAhC,EAA4CsB,IAA5C,CAAiD,IAAjD,EAAuDtB,UAAvD,EAAmEsB,IAAnE,CAAwE,IAAxE,EAA8E,CAA9E,EAAiFA,IAAjF,CAAsF,IAAtF,EAA4FvB,eAA5F,EAA6GuB,IAA7G,CAAkH,QAAlH,EAA4H,QAA5H,CAAlB;AACH;;AAED,gBAAI0C,qBAAqBzC,MAAMe,SAAN,CAAgB,uBAAhB,EACpBxF,IADoB,CACfX,YADe,EAEpBoG,KAFoB,GAGpBzD,MAHoB,CAGb,GAHa,EAIpBwC,IAJoB,CAIf,WAJe,YAIMU,sBAJN,QAKpBV,IALoB,CAKf,OALe,EAKN,MALM,EAMpBA,IANoB,CAMf,WANe,EAMF,UAACkB,CAAD,EAAI7E,CAAJ;AAAA,yCAA0BsC,cAActC,CAAxC;AAAA,aANE,EAOpB2E,SAPoB,CAOV,MAPU,EAQpBxF,IARoB,CAQf;AAAA,uBAAK0F,EAAE1F,IAAF,CAAOmH,MAAP,CAAc;AAAA,2BAAKC,EAAEC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBC,QAAnC;AAAA,iBAAd,CAAL;AAAA,aARe,EASpB9B,KAToB,EAAzB;;AAWA,gBAAI+B,oBAAoB,MAAMrE,WAA9B;AACA,gBAAIsE,oBAAoB,CAACtE,cAAcqE,iBAAf,IAAoC,CAA5D;AACA,gBAAIE,YAAYR,mBACXlF,MADW,CACJ,MADI,EAEXwC,IAFW,CAEN,OAFM,EAEGmD,MAAMC,UAAN,EAAkB,UAAlB,CAFH,EAGXpD,IAHW,CAGN,OAHM,EAGG,UAACkB,CAAD;AAAA,uBAAOG,KAAKpE,GAAL,CAAS7B,QAAQiI,gBAAjB,EAAmCnE,qBAAqBgC,EAAEpF,EAAvB,IAA6BoD,qBAAqBgC,EAAEtF,IAAvB,CAAhE,CAAP;AAAA,aAHH,EAIXoE,IAJW,CAIN,QAJM,EAIIgD,iBAJJ,EAKXhD,IALW,CAKN,GALM,EAKDiD,iBALC,EAMXjD,IANW,CAMN,GANM,EAMD,UAACkB,CAAD;AAAA,uBAAOhC,qBAAqBgC,EAAEtF,IAAvB,CAAP;AAAA,aANC,EAOX4D,EAPW,CAOR,OAPQ,EAOC,UAAC0B,CAAD,EAAO;AAAE,iBAACA,EAAEoC,OAAH,IAAcpC,EAAEoC,OAAF,CAAUpC,CAAV,CAAd;AAA6B,aAPvC,CAAhB;;AASA;AACA,gBAAIqC,gBAAgBb,mBACflF,MADe,CACR,MADQ,EAEf8E,IAFe,CAEV;AAAA,uBAAKpB,EAAEqB,KAAF,IAAW,EAAhB;AAAA,aAFU,EAEW;AAFX,aAGfvC,IAHe,CAGV,OAHU,EAGDmD,MAAMC,UAAN,EAAkB,eAAlB,CAHC,EAIfpD,IAJe,CAIV,GAJU,EAIJrB,cAAc,CAAf,GAAoB,CAJf,EAKfqB,IALe,CAKV,GALU,EAKL,UAACkB,CAAD;AAAA,uBAAOhC,qBAAqBgC,EAAEtF,IAAvB,CAAP;AAAA,aALK,CAApB;;AAOA,gBAAI4H,gBAAgBvD,MAAMe,SAAN,CAAgB,kBAAhB,EACfxF,IADe,CACVX,YADU,EAEfoG,KAFe,GAGfzD,MAHe,CAGR,GAHQ,EAIfwC,IAJe,CAIV,WAJU,YAIWU,sBAJX,QAKfV,IALe,CAKV,OALU,EAKD,MALC,EAMfA,IANe,CAMV,WANU,EAMG,UAACkB,CAAD,EAAI7E,CAAJ;AAAA,yCAA0BsC,cAActC,CAAxC;AAAA,aANH,EAOf2E,SAPe,CAOL,MAPK,EAQfxF,IARe,CAQV,aAAK;AACP,uBAAO0F,EAAE1F,IAAF,CAAOmH,MAAP,CAAc;AAAA,2BAAKC,EAAEC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBW,KAAnC;AAAA,iBAAd,CAAP;AACH,aAVe,EAWfxC,KAXe,EAApB;;AAaA,gBAAIyC,OAAOF,cACNhG,MADM,CACC,QADD,EAENwC,IAFM,CAED,OAFC,EAEQmD,MAAMC,UAAN,EAAkB,KAAlB,CAFR,EAGNpD,IAHM,CAGD,IAHC,EAGK;AAAA,uBAAKd,qBAAqBgC,EAAExF,EAAvB,CAAL;AAAA,aAHL,EAINsE,IAJM,CAID,IAJC,EAIKrB,cAAc,CAJnB,EAKNqB,IALM,CAKD,GALC,EAKI,CALJ,EAMNR,EANM,CAMH,OANG,EAMM,UAAC0B,CAAD,EAAO;AAAE,iBAACA,EAAEoC,OAAH,IAAcpC,EAAEoC,OAAF,CAAUpC,CAAV,CAAd;AAA6B,aAN5C,CAAX;;AAQA;AACA;AACA,gBAAI9F,QAAQuI,mBAAZ,EAAiC;AAC7B,oBAAIC,MAAM,YAAW;AACjB;AACA;AACA,wBAAIC,YAAYC,SAASC,aAAT,CAAuB,KAAvB,CAAhB;AACAD,6BAASE,IAAT,CAAcC,WAAd,CAA0BJ,SAA1B;;AAEA;AACA;AACA,wBAAIK,gBAAgBpH,GAAGS,MAAH,CAAUuG,SAASC,aAAT,CAAuB,KAAvB,CAAV,CAApB;AACAG,kCACK/C,KADL,CACW,UADX,EACuB,UADvB,EACmCA,KADnC,CACyC,KADzC,EACgD,CADhD,EAEKA,KAFL,CAEW,SAFX,EAEsB,CAFtB,EAGKA,KAHL,CAGW,gBAHX,EAG6B,MAH7B,EAGqCA,KAHrC,CAG2C,YAH3C,EAGyD,YAHzD;AAIA0C,8BAAUI,WAAV,CAAsBC,cAAcvG,IAAd,EAAtB;;AAEA,6BAASwG,MAAT,GAAkB;AACdhC,gCAAQC,GAAR,CAAY,gBAAZ;AACH;;AAED,wBAAIgC,WAAW,IAAf;AACA,6BAASC,UAAT,GAAsB;;AAElB;AACA,4BAAIC,OAAOC,MAAP,IAAiBD,OAAOE,OAAxB,IAAmCJ,YAAY,IAAnD,EACA;AACIA,uCAAW,IAAII,OAAJ,CAAYN,cAAcvG,IAAd,EAAZ,EAAkC;AACzC8G,2CAAW,KAD8B;AAEzCC,uCAAO,eAFkC;AAGzCC,sCAAM,IAHmC;AAIzCC,+CAAe;AACXC,8CAAU,kBAASC,CAAT,EAAY;AAAEA,0CAAEC,QAAF,CAAWC,MAAX,CAAkB9J,SAAlB,CAA4BC,GAA5B,CAAgC,MAAhC;AAA0C,qCADvD;AAEX8J,+CAAW;AACPC,8CAAM;AACFC,sDAAU,CAAC,KAAD,EAAQ,QAAR,EAAkB,MAAlB,EAA0B,OAA1B;AADR;AADC;AAFA;AAJ0B,6BAAlC,CAAX;AAaA;AACAf,qCAASgB,IAAT;AACAhB,qCAASiB,IAAT;AACAvI,+BAAGS,MAAH,CAAU6G,SAASkB,YAAnB,EAAiC9F,EAAjC,CAAoC,YAApC,EAAkD2E,OAAOoB,YAAzD;AACAzI,+BAAGS,MAAH,CAAU6G,SAASkB,YAAnB,EAAiC9F,EAAjC,CAAoC,YAApC,EAAkD2E,OAAOqB,YAAzD;AACH;AACD,+BAAOpB,QAAP;AACH;;AAED,wBAAIT,mBAAJ;;AAEAQ,2BAAOQ,IAAP,GAAc,UAASc,GAAT,EAAc;AACxB9B,8CAAsB8B,GAAtB;AACH,qBAFD;;AAIA,wBAAIC,eAAe,KAAnB;AACA,wBAAIC,2BAA2B,IAA/B;AACA,wBAAIC,gBAAgB,IAApB;;AAEAzB,2BAAOoB,YAAP,GAAsB,YAAW;AAC7BpB,+BAAO0B,UAAP;AACH,qBAFD;;AAIA1B,2BAAOqB,YAAP,GAAsB,YAAW;AAC7BrB,+BAAO2B,aAAP;AACH,qBAFD;;AAIA;AACA3B,2BAAO0B,UAAP,GAAoB,YAAW;AAC3B,4BAAI,CAACF,wBAAL,EAA+B;;AAE/BI,qCAAaJ,wBAAb;AACAA,mDAA2B,IAA3B;AACH,qBALD;;AAOAxB,2BAAO6B,OAAP,GAAiB,YAAW;AACxB,4BAAI,CAACN,YAAL,EAAmB;;AAEnB;AACAvB,+BAAO0B,UAAP;;AAEAF,mDAA2B,IAA3B;AACAtB,qCAAagB,IAAb;AACAK,uCAAe,KAAf;AACAE,wCAAgB,IAAhB;AACH,qBAVD;;AAYAzB,2BAAO2B,aAAP,GAAuB,YAAW;AAC9BH,mDAA2BM,WAAW,YAAM;AACxC9B,mCAAO6B,OAAP;AACH,yBAF0B,EAExB,GAFwB,CAA3B;AAGH,qBAJD;;AAMA7B,2BAAOiB,IAAP,GAAc,UAASlE,CAAT,EAAY;AACtB,4BAAIwE,gBAAgB,QAAQE,aAA5B,EACIzB,OAAO0B,UAAP,GADJ,KAGI1B,OAAO6B,OAAP;;AAEJ;AACA,4BAAIE,OAAO,KAAKC,qBAAL,EAAX,CAPsB,CAOoB;AAC1C,4BAAIC,WAAWxF,gBAAgBjD,IAAhB,GAAuBwI,qBAAvB,EAAf,CARsB,CAQ0C;;AAEhE,4BAAIhI,MAAM+H,KAAK/H,GAAL,GAAWmG,OAAO+B,OAA5B;AACA,4BAAI/H,OAAO+C,KAAKpE,GAAL,CAASiJ,KAAK5H,IAAd,EAAmB8H,SAAS9H,IAA5B,IAAoCgG,OAAOgC,OAAtD;AACA,4BAAIlI,QAAQiD,KAAKtE,GAAL,CAASmJ,KAAK9H,KAAd,EAAoBgI,SAAShI,KAA7B,IAAsCkG,OAAOgC,OAAzD;AACA,4BAAIjI,SAAS6H,KAAK7H,MAAL,GAAciG,OAAO+B,OAAlC;AACA,4BAAIrI,SAASqD,KAAKtE,GAAL,CAASsB,SAAOF,GAAhB,EAAqB+H,KAAKlI,MAA1B,CAAb;AACA,4BAAIH,QAAQwD,KAAKtE,GAAL,CAASqB,QAAME,IAAf,EAAqB4H,KAAKrI,KAA1B,CAAZ;;AAEAqG,sCACK/C,KADL,CACW,KADX,EACkBhD,MAAI,IADtB,EAEKgD,KAFL,CAEW,MAFX,EAEmB7C,OAAK,IAFxB,EAGK6C,KAHL,CAGW,QAHX,EAGqBnD,SAAO,IAH5B,EAIKmD,KAJL,CAIW,OAJX,EAIoBtD,QAAM,IAJ1B;AAKA;AACA,4BAAI8G,OAAOhB,oBAAoBzC,CAApB,CAAX;AACA,4BAAIqF,KAAKlC,YAAT;AACAkC,2BAAGC,kBAAH,CAAsB7B,IAAtB;AACA;AACA4B,2BAAGnB,IAAH;AACAM,uCAAe,IAAf;AACAE,wCAAgB,IAAhB;AACH,qBA9BD;;AAgCA,2BAAOzB,MAAP;AACH,iBA5HS,EAAV;;AA+HA;AACAP,oBAAIe,IAAJ,CAASvJ,QAAQuI,mBAAjB;AACAD,qBAAKlE,EAAL,CAAQ,WAAR,EAAqBoE,IAAIwB,IAAzB,EAA+B5F,EAA/B,CAAkC,UAAlC,EAA8CoE,IAAIkC,aAAlD;AACA5C,0BAAU1D,EAAV,CAAa,WAAb,EAA0BoE,IAAIwB,IAA9B,EAAoC5F,EAApC,CAAuC,UAAvC,EAAmDoE,IAAIkC,aAAvD;AACH;;AAEDrG;;AAEA,gBAAIrE,QAAQyF,eAAZ,EAA6B;AACzBiB,4BAAY2E,eAAZ,EAA6BrL,QAAQsL,qBAArC;AACH;;AAGD,qBAASlE,IAAT,CAAcF,IAAd,EAAoBzE,KAApB,EAA2B8I,cAA3B,EACA;AACIrE,qBAAKsE,IAAL,CAAU,YAAW;AACjB,wBAAItE,OAAOxF,GAAGS,MAAH,CAAU,IAAV,CAAX;AAAA,wBACAsJ,QAAQvE,KAAKA,IAAL,GAAYwE,KAAZ,CAAkB,KAAlB,EAAyBC,OAAzB,EADR;AAAA,wBAEAC,IAFA;AAAA,wBAGAC,OAAO,EAHP;AAAA,wBAIAC,aAAa,CAJb;AAAA,wBAKAC,aAAa,GALb;AAAA,wBAKkB;AAClBC,wBAAI9E,KAAKtC,IAAL,CAAU,GAAV,CANJ;AAAA,wBAOAqH,KAAKC,WAAWhF,KAAKtC,IAAL,CAAU,IAAV,CAAX,CAPL;AAAA,wBAQAuH,KAAKD,WAAWhF,KAAKtC,IAAL,CAAU,IAAV,CAAX,CARL;AASA;AACA,wBAAIwH,QAAQlF,KAAKA,IAAL,CAAU,IAAV,EAAgB9E,MAAhB,CAAuB,OAAvB,EAAgCwC,IAAhC,CAAqC,GAArC,EAA0C,CAA1C,EAA6CA,IAA7C,CAAkD,GAAlD,EAAuDoH,CAAvD,EAA0DpH,IAA1D,CAA+D,IAA/D,EAAqEqH,KAAK,IAA1E,EAAgFrH,IAAhF,CAAqF,IAArF,EAA2FuH,KAAK,IAAhG,CAAZ;AACA,2BAAOP,OAAOH,MAAMY,GAAN,EAAd,EACA;AACIR,6BAAKS,IAAL,CAAUV,IAAV;AACAQ,8BAAMlF,IAAN,CAAW2E,KAAKU,IAAL,CAAU,GAAV,CAAX;AACA;AACA,4BAAIH,MAAM7J,IAAN,GAAaiK,qBAAb,KAAuC/J,KAA3C,EACA;AACIoJ,iCAAKQ,GAAL;AACAD,kCAAMlF,IAAN,CAAW2E,KAAKU,IAAL,CAAU,GAAV,CAAX;AACAV,mCAAO,CAACD,IAAD,CAAP;AACA;AACAQ,oCAAQlF,KAAK9E,MAAL,CAAY,OAAZ,EACHwC,IADG,CACE,GADF,EACO,CADP;AAEJ;AAFI,6BAGHA,IAHG,CAGE,IAHF,EAGQqH,KAAK,IAHb,EAIHrH,IAJG,CAIE,IAJF,EAIQmH,aAAa,IAJrB,EAI4B;AAJ5B,6BAKH7E,IALG,CAKE0E,IALF,CAAR;AAMA,gCAAIa,aAAavF,KAAK/E,MAAL,CAAY,OAAZ,CAAjB;AACAgK,iCAAKD,WAAWO,WAAW7H,IAAX,CAAgB,IAAhB,CAAX,CAAL;AACA6H,uCAAW7H,IAAX,CAAgB,IAAhB,EAAsBuH,KAAIJ,aAAW,EAAf,GAAmB,IAAzC;AACH;AACJ;AACJ,iBAlCD;AAmCH;;AAED,qBAASV,eAAT,GAA2B;AACvB,oBAAIqB,OAAO5I,qBAAqB,IAAI7B,IAAJ,EAArB,CAAX;;AAEApC,qBAAK6F,GAAL,CAASd,IAAT,CAAc,IAAd,EAAoB8H,IAApB,EAA0B9H,IAA1B,CAA+B,IAA/B,EAAqC8H,IAArC;AACH;;AAED,qBAAS3E,KAAT,CAAe4E,EAAf,EAAmB;AACf,oBAAIC,OAAOC,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBjI,IAAtB,CAA2BkI,SAA3B,EAAsC,CAAtC,CAAX,CADe,CACuC;AACtD,uBAAO,YAAW;AACd,2BAAOL,GAAGM,KAAH,CAAS,IAAT,EAAeL,KAAKpL,MAAL,CAAYqL,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBjI,IAAtB,CAA2BkI,SAA3B,EAAsC,CAAtC,CAAZ,CAAf,CAAP;AACH,iBAFD;AAGH;;AAED;AACA,qBAAShF,UAAT,CAAoBkF,YAApB,EAAkC9M,IAAlC,EAAwC;AACpC;AACA,oBAAI+M,UAAU,CAAED,YAAF,CAAd;AACA,oBAAI,CAAC,CAAC9M,KAAKgN,WAAX,EAAwBD,QAAQb,IAAR,CAAalM,KAAKgN,WAAlB;AACxB,oBAAIC,YAAY,CAACjN,KAAKkN,GAAL,IAAY,EAAb,EAAiBC,GAAjB,CAAqB;AAAA,2BAAMpK,oBAAkBqK,EAAxB;AAAA,iBAArB,CAAhB;AACA,uBAAOL,QAAQ3L,MAAR,CAAe6L,SAAf,EAA0Bd,IAA1B,CAA+B,GAA/B,CAAP;AACH;;AAED,qBAASlI,MAAT,GAAkB;AACd,oBAAIxE,KAAK4N,aAAL,IAAsB/L,GAAGgM,KAA7B,EAAoC;AAChC7N,yBAAK4N,aAAL,CAAmB3I,IAAnB,CAAwBjF,IAAxB,EAA8B;AAC1BiH,+BAAOpF,GAAGgM,KAAH,CAAS5G,KADU;AAE1B6G,mCAAWjM,GAAGgM,KAAH,CAASC,SAFM;AAG1B/J,gCAAQE,qBAAqBF,MAArB;AAHkB,qBAA9B;AAKH;;AAED,oBAAI5D,QAAQyF,eAAZ,EAA6B;AACzB4F;AACH;;AAED,oBAAIuC,cAAc,CAAEzJ,IAAF,CAAlB,CAbc,CAae;;AAE7B,oBAAIzC,GAAGgM,KAAH,IAAYhM,GAAGgM,KAAH,CAASG,SAAzB,EAAoC;AACpC;AACI;AACA/J,2CAAuBpC,GAAGgM,KAAH,CAASG,SAAT,CAAmBC,QAAnB,CAA4BtK,kBAA5B,CAAvB;AACH,iBAJD,MAKKuD,QAAQC,GAAR,CAAY,6BAAZ;;AAEL;AACA9C,8BAAcH,MAAM+C,KAAN,CAAYhD,oBAAZ,CAAd;;AAEA;AACA2C,mBAAG3B,IAAH,CAAQZ,WAAR;AACA;AACAW,sBAAMe,SAAN,CAAgB,YAAhB,EAA8BhB,IAA9B,CAAmC,IAAnC,EAAyC;AAAA,2BAAKd,qBAAqBgC,EAAExF,EAAvB,CAAL;AAAA,iBAAzC;AACAuE,sBAAMe,SAAN,CAAgB,eAAhB,EAAiChB,IAAjC,CAAsC,GAAtC,EAA2C;AAAA,2BAAKd,qBAAqBgC,EAAEtF,IAAvB,CAAL;AAAA,iBAA3C,EAA8EoE,IAA9E,CAAmF,OAAnF,EAA4F;AAAA,2BAAKqB,KAAKpE,GAAL,CAAS7B,QAAQiI,gBAAjB,EAAmCnE,qBAAqBgC,EAAEpF,EAAvB,IAA6BoD,qBAAqBgC,EAAEtF,IAAvB,CAAhE,CAAL;AAAA,iBAA5F;AACAqE,sBAAMe,SAAN,CAAgB,gBAAhB,EAAkChB,IAAlC,CAAuC,GAAvC,EAA4C,UAASkB,CAAT,EAAY;AAChD,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAKiI,aAAaE,YAAb,GAA4B3K,UAA5B,GAAyC,EAA1C,GAAgDyK,aAAaG,SAAjE,EAA4E;AACxE,+BAAOH,aAAaE,YAApB;AACH,qBAFD,MAEO,IAAIF,aAAaI,SAAb,GAAyB7K,UAAzB,IAAuCyK,aAAaE,YAAb,GAA4B3K,UAAvE,EAAmF;AACtF,+BAAOA,UAAP;AACH;AACD,2BAAOyK,aAAaI,SAApB;AACH,iBARL,EAQOvJ,IARP,CAQY,aARZ,EAQ2B,UAASkB,CAAT,EAAY;AAC/B,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAKiI,aAAaE,YAAb,GAA4B3K,UAA5B,GAAyC,EAA1C,GAAgDyK,aAAaG,SAAjE,EAA4E;AACxE,+BAAO,KAAP;AACH;AACD,2BAAO,OAAP;AACH,iBAdL,EAeKtJ,IAfL,CAeU,IAfV,EAegB,UAASkB,CAAT,EAAY;AACpB,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAKiI,aAAaE,YAAb,GAA4B3K,UAA5B,GAAyC,EAA1C,GAAgDyK,aAAaG,SAAjE,EAA4E;AACxE,+BAAO,QAAP;AACH;AACD,2BAAO,OAAP;AACH,iBArBL,EAqBOhH,IArBP,CAqBY,UAASpB,CAAT,EAAY;AAChB,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAIsI,UAAU,CAACL,aAAatL,KAAb,GAAqBzC,QAAQqO,qBAA9B,IAAuDN,aAAaG,SAAlF;AACA,wBAAII,YAAYxI,EAAEqB,KAAF,IAAW,EAA3B,CAHgB,CAGe;AAC/B,wBAAIiH,UAAU,CAAd,EAAiB;AACb,4BAAIL,aAAatL,KAAb,GAAqBzC,QAAQqO,qBAAjC,EAAwD;AACpD,mCAAOC,UAAUC,MAAV,CAAiB,CAAjB,EAAoBtI,KAAKE,KAAL,CAAWmI,UAAU1O,MAAV,GAAmBwO,OAA9B,CAApB,IAA8D,KAArE;AACH,yBAFD,MAEO;AACH,mCAAO,EAAP;AACH;AACJ;;AAED,2BAAOE,SAAP;AACH,iBAlCL;;AAoCA,yBAASN,mBAAT,CAA6BlI,CAA7B,EAAgC;AAC5B,yBAAK0I,YAAL,GAAoB,KAAKA,YAAL,IAAqB,KAAKhC,qBAAL,EAAzC;AACA,wBAAIhM,OAAOsD,qBAAqBgC,EAAEtF,IAAvB,CAAX;AACA,wBAAIE,KAAKoD,qBAAqBgC,EAAEpF,EAAvB,CAAT;AACA,2BAAO;AACHyN,mCAAW3N,IADR;AAEHyN,sCAAcvN,EAFX;AAGH+B,+BAAO/B,KAAKF,IAHT;AAIH0N,mCAAW,KAAKM;AAJb,qBAAP;AAMH;AACJ;;AAED,gBAAI/N,iBAAiBZ,KAAKY,cAAL,GAAsB,UAASgO,eAAT,EAA0B;AACjE,oBAAI/E,IAAI+E,eAAR;AACA,uBAAO/E,EAAEjC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEpJ,EAAxC,GAA6CoJ,EAAElJ,IAAtD;AACH,aAHD;AAIA,gBAAIG,iBAAiBd,KAAKc,cAAL,GAAsB,UAAS8N,eAAT,EAA0B;AACjE,oBAAI/E,IAAI+E,eAAR;AACA,uBAAO/E,EAAEjC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEpJ,EAAxC,GAA6CoJ,EAAEhJ,EAAtD;AACH,aAHD;;AAKA;AACA,gBAAIgO,qBAAqB,IAAzB;AACA7O,iBAAK6O,kBAAL,GAA0B,UAASC,KAAT,EAAgB;AACtC,oBAAIA,UAAUC,SAAd,EACI,OAAOF,kBAAP;AACJA,qCAAqB,CAAC,CAACC,KAAvB;AACH,aAJD;;AAMA9O,iBAAKgP,OAAL,GAAe,YAAW;AAAExK;AAAW,aAAvC;;AAEAxE,iBAAKiP,cAAL,GAAsB,UAASC,OAAT,EAAkB;AACpC,oBAAIA,YAAYH,SAAZ,GAAwBF,kBAAxB,GAA6CK,OAAjD,EACIlK,MAAMmK,UAAN,GAAmBC,QAAnB,CAA4B,GAA5B,EAAiCnK,IAAjC,CAAsCX,KAAK0J,SAA3C,EAAsDnM,GAAGwN,YAAzD,EADJ,KAGIrK,MAAMC,IAAN,CAAWX,KAAK0J,SAAhB,EAA2BnM,GAAGwN,YAA9B;AACP,aALD;;AAOA;AACA,qBAASC,qBAAT,CAA+BC,CAA/B,EAAkCL,OAAlC,EAA2C;AACvC,oBAAIA,YAAYH,SAAZ,GAAwBF,kBAAxB,GAA6CK,OAAjD,EACIlK,MAAMmK,UAAN,GAAmBC,QAAnB,CAA4B,GAA5B,EAAiCnK,IAAjC,CAAsCX,KAAKkL,WAA3C,EAAwDD,CAAxD,EAA2D,CAA3D,EADJ,KAGIvK,MAAMC,IAAN,CAAWX,KAAKkL,WAAhB,EAA6BD,CAA7B,EAAgC,CAAhC;AACP;AACD;;AAEA;AACA,qBAASE,YAAT,CAAsBC,CAAtB,EAAyBR,OAAzB,EAAkC;AAC9B,oBAAIA,YAAYH,SAAZ,GAAwBF,kBAAxB,GAA6CK,OAAjD,EACIlK,MAAMmK,UAAN,GAAmBC,QAAnB,CAA4B,GAA5B,EAAiCnK,IAAjC,CAAsCX,KAAKqL,OAA3C,EAAoDD,CAApD,EADJ,KAGI1K,MAAMC,IAAN,CAAWX,KAAKqL,OAAhB,EAAyBD,CAAzB;AACP;;AAED;AACA,qBAASE,kBAAT,CAA4BC,oBAA5B,EAAkD;AAC9C,oBAAI7L,QAAQC,qBAAqBD,KAArB,EAAZ;AACA,oBAAI8L,QAAQ9L,MAAM,CAAN,IAAWA,MAAM,CAAN,CAAvB;AACA,oBAAIuL,IAAIO,QAAQD,oBAAR,GAA+B7L,MAAM,CAAN,CAAvC;AACAsL,sCAAsBC,CAAtB;AACH;AACDvP,iBAAK4P,kBAAL,GAA0BA,kBAA1B;;AAEA,qBAASG,eAAT,CAAyBC,IAAzB,EAA+Bd,OAA/B,EAAwC;AACpC,oBAAIe,aAAatM,mBAAmBqM,IAAnB,CAAjB;AACAV,sCAAsBW,UAAtB,EAAkCf,OAAlC;AACH;AACDlP,iBAAK+P,eAAL,GAAuBA,eAAvB;;AAEA;AACA;AACA;AACA/P,iBAAKkQ,kBAAL,GAA0B,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,qBAApC,EAA2D;AACjF,oBAAItC,cAAc,CAACzJ,IAAD,EAAOL,oBAAP,CAAlB,CADiF,CAChC;AACjD,oBAAIqM,UAAU,OAAOH,WAAP,KAAwB,QAAxB,GAAoC,CAACA,WAAD,CAApC,GAAoDA,WAAlE;AACA,oBAAIG,QAAQxQ,WAAR,KAAwB,GAAGA,WAA/B,EAA4C,OAAO,EAAES,MAAM,EAAR,EAAP;;AAE5C;AACAsB,mBAAGkE,SAAH,CAAa,MAAIsK,qBAAjB,EAAwC7N,OAAxC,CAAgD6N,qBAAhD,EAAuE,KAAvE;;AAEA,oBAAIE,WAAWD,QAAQ5C,GAAR,CAAY;AAAA,2BAAM,MAAIpK,iBAAJ,GAAsBqK,EAA5B;AAAA,iBAAZ,EAA4CjB,IAA5C,CAAiD,GAAjD,CAAf;;AAEA;AACA,oBAAI,CAAC6D,QAAL,EAAe,OAAO,EAAEhQ,MAAM,EAAR,EAAP;;AAEf,oBAAIiQ,MAAM3O,GAAGkE,SAAH,CAAawK,QAAb,CAAV;;AAEA;AACA,oBAAIC,IAAIC,KAAJ,GAAY1Q,MAAZ,IAAsB,CAA1B,EAA6B,OAAO,EAAEQ,MAAM,EAAR,EAAP;;AAE7B;AACAiQ,oBAAIhO,OAAJ,CAAY6N,qBAAZ,EAAmC,IAAnC;;AAEA,oBAAIK,QAAQF,IAAIjQ,IAAJ,EAAZ;AACA,oBAAIoQ,YAAYD,MAAME,IAAN,CAAW;AAAA,2BAAQpQ,KAAKoH,IAAL,IAAalI,cAAcmI,IAAd,CAAmBW,KAAxC;AAAA,iBAAX,KAA6DkI,MAAM,CAAN,CAA7E;AACA;AACA,oBAAI,CAAC,CAACN,YAAN,EAAoB;AAChB;AACA;AACA;AACA,wBAAIS,WAAW7Q,KAAKU,cAAL,CAAoBiQ,SAApB,CAAf;AACA,wBAAIV,aAAatM,mBAAmBkN,QAAnB,CAAjB;AACA,wBAAIC,mBAAmBjP,GAAGkP,aAAH,CAAiB/L,MAAMtC,IAAN,EAAjB,CAAvB;;AAEA;AACA;AACA;AACA;AACA;;AAEA,wBAAIsO,eAAehR,KAAKiR,kBAAL,CAAwBN,SAAxB,CAAnB;AACA,wBAAIK,aAAaE,OAAb,IAAwB,IAA5B,EAAkC;AAC9B,4BAAIC,YAAYlN,qBAAqB4M,QAArB,CAAhB;AACA,4BAAIO,mBAAmBnN,qBAAqB+M,aAAaE,OAAb,CAAqBG,IAA1C,CAAvB;AACA,4BAAIC,gBAAgBlL,KAAKC,GAAL,CAAS8K,YAAYC,gBAArB,CAApB;AACA,4BAAIG,OAAQ,KAAKD,aAAN,GAAuBR,iBAAiBpB,CAAnD;AACA;AACA,4BAAI6B,OAAOT,iBAAiBpB,CAA5B,EAA+B;AAC3B;AACA;AACA;AACA;AACAD,yCAAa8B,IAAb,EAAmB,KAAnB;AACH;AACJ;;AAED;AACAxB,oCAAgBc,QAAhB,EAA0B,KAA1B;AACH;;AAED,uBAAO;AACHtQ,0BAAMmQ;AADH,iBAAP;AAGH,aA7DD;;AA+DA1Q,iBAAK2P,OAAL,GAAe,UAASD,CAAT,EAAY;AACvB1K,sBAAMC,IAAN,CAAWX,KAAKqL,OAAhB,EAAyBD,CAAzB;AACH,aAFD;;AAIAxI,oBAAQC,GAAR,CAAY,6CAAZ,EAA2DvH,YAA3D;AACAsH,oBAAQC,GAAR,CAAY,2BAAZ,EAAyC5F,WAAzC;AACH;;;;4CACuB;AAAA,oBAAViQ,GAAU,uEAAJ,EAAI;;AACpB,oBAAIC,iBAAiB;AACjB7N,uCAAmB,KADF;AAEjBwE,sCAAkB,CAFD,EAEI;AACrBM,yCAAqBqG,SAHJ;AAIjBP,2CAAuB,EAJN;AAKjB5I,qCAAiB,KALA;AAMjB6F,2CAAuB,IANN;AAOjB7I,2BAAOmM,SAPU;AAQjBhM,4BAAQgM,SARS;AASjBtL,gCAAY,GATK,EASA;AACjBC,iCAAa,EAVI,CAUD;AAVC,iBAArB;AAYAgO,uBAAOC,IAAP,CAAYH,GAAZ,EAAiB9D,GAAjB,CAAqB;AAAA,2BAAK+D,eAAe/B,CAAf,IAAoB8B,IAAI9B,CAAJ,CAAzB;AAAA,iBAArB;AACA,uBAAO+B,cAAP;AACH;;;2CACc5H,C,EAAG;AACd,uBAAOA,EAAEjC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEpJ,EAAxC,GAA6CoJ,EAAElJ,IAAtD;AACH;;;2CACckJ,C,EAAG;AACd,uBAAOA,EAAEjC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEpJ,EAAxC,GAA6CoJ,EAAEhJ,EAAtD;AACH;;;2CACcgJ,C,EAAG;AACd,uBAAOA,EAAEjC,IAAF,KAAWlI,cAAcmI,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEpJ,EAAxC,GAA6C,IAAI2B,IAAJ,CAASyH,EAAElJ,IAAF,GAAS,CAAT,GAAa,CAACkJ,EAAEhJ,EAAF,GAAOgJ,EAAElJ,IAAV,IAAgB,CAAtC,CAApD;AACH;;;+CAEkBH,I,EAAM;AACrB;AACA,oBAAIoR,oBAAoBpR,IAAxB;AACA,uBAAMoR,qBAAqB,IAArB,IAA6BA,kBAAkB/Q,EAAlB,IAAwBL,KAAKG,IAAhE;AACIiR,wCAAoBA,kBAAkBvQ,QAAtC;AADJ,iBAHqB,CAMrB;AACA,oBAAIwQ,oBAAoBrR,IAAxB;AACA,uBAAMqR,qBAAqB,IAArB,IAA6BA,kBAAkBlR,IAAlB,IAA0BH,KAAKK,EAAlE;AACIgR,wCAAoBA,kBAAkBvQ,QAAtC;AADJ,iBAGA,IAAI4H,SAAS;AACT4I,6BAASF,qBAAqB,IAArB,GAA4B,IAA5B,GAAmC;AACxCpR,8BAAMoR,iBADkC;AAExCP,8BAAMO,kBAAkB/Q,EAFgB;AAGxCkR,kCAAWvR,KAAKG,IAAL,GAAYiR,kBAAkB/Q;AAHD,qBADnC;AAMTmR,2BAAOH,qBAAqB,IAArB,GAA4B,IAA5B,GAAmC;AACtCrR,8BAAMqR,iBADgC;AAEtCR,8BAAMQ,kBAAkBlR,IAFc;AAGtCoR,kCAAUF,kBAAkBlR,IAAlB,GAAyBH,KAAKK;AAHF;AANjC,iBAAb;AAYA,oBAAI+Q,qBAAqB,IAAzB,EAA+B1I,OAAOgI,OAAP,GAAiBhI,OAAO8I,KAAxB,CAA/B,KACK,IAAIH,qBAAqB,IAAzB,EAA+B3I,OAAOgI,OAAP,GAAiBhI,OAAO4I,OAAxB,CAA/B,KACA5I,OAAOgI,OAAP,GAAiBhI,OAAO4I,OAAP,CAAeC,QAAf,GAA0B7I,OAAO8I,KAAP,CAAaD,QAAvC,GAAkD7I,OAAO4I,OAAzD,GAAmE5I,OAAO8I,KAA3F;AACL,uBAAO9I,MAAP;AACH;;;wCACW4D,E,EAAI;AACZ,qBAAKc,aAAL,GAAqBd,EAArB;AACA,uBAAO,IAAP;AACH;;;;;;AAGLpN,kBAAcmI,IAAd,GAAqB;AACjBW,eAAOyJ,QADU;AAEjBnK,kBAAUmK;AAFO,KAArB;;AAKAC,WAAOC,OAAP,GAAiBzS,aAAjB","file":"timeline-chart.js","sourcesContent":["/*\nProvided timeline data should match the following grammar/rules:\n\n    <timeline_data> : \n    [\n        <series_data>,\n        <series_data>,\n        ...\n    ]\n\n    <series_data> :\n    [\n        label: <label-expression>,\n        data: \n        [\n            <series_item>\n        ]\n    ]\n\n    <series_item> : <series_interval> OR <series_point>\n\n    <series_interval> : \n    {\n        type: TimelineChart.TYPE.INTERVAL,\n        label: <label-expression>,\n        from: <Date>,\n        to: <Date>,\n        customClass: <css-class>,\n        onClick: <function>,\n        ids: [ (unique ID strings) ]\n    }\n\n    <series_point> :\n    {\n        type: TimelineChart.TYPE.INTERVAL,\n        label: <label>,\n        at: <Date>,\n        customClass: <css-class>,\n        onClick: <function>,\n        ids: [ (unique ID strings) ]\n    }\n\n    <label-expression> : <string>\n\n    <css-class> : <string>\n\n\nSupported options (i.e. properties of opts) include the following:\n\n    useLocalTimeScale: <Boolean> Set to true if all times should be interpreted as local time.  \n        The default (false) is for all times to be interpreted as UTC times.\n    enableLiveTimer: <Boolean> Set to true if the current time should be represented on the timeline as a vertical line.\n        This is disabled/false by default.\n    liveTimerTickInterval: <Number> The interval (in ms) for the live timer (if enabled).  This defaults to 1000.\n    intervalMinWidth: <Number> The minimum width (in px) of a time interval (so it can still be seen when zoomed out).  \n        The default value is 8.\n    tipContentGenerator: <Function> A function for rendering an HTML representation of tip content for a timeline point or interval.\n        The provided argument is the data element bound to the point/interval. The result should be the HTML content to display.\n    textTruncateThreshold: \n    width: <Number> If provided, this value will be used as the fixed width (in px) of the timeline component.  \n        If not provided, the timeline component will fill the available space of its parent element.\n    height: <Number> If provided, this value will be used as the fixed height (in px) of the timeline component.  \n        If not provided, the timeline component will fill the available space of its parent element.\n        Note that the total height of the timeline component can also be affected by the groupHeight option.\n    groupWidth: <Number> Width (in px) of the series label region on the left side of the timeline component.  \n        If not specified, it defaults to 400.\n    groupHeight: <Number> Height (in px) of each horizontal division of the timeline containing a series of data.\n        If not specified, the total available vertical space will be divided equally among each series.\n*/\n\nclass TimelineChart {\n    constructor(element, timelineData, opts) {\n        if (!timelineData || timelineData.constructor != [].constructor || !timelineData.length) return null;\n\n        let self = this;\n\n        element.classList.add('timeline-chart-component');\n\n        let options = this.extendOptions(opts);\n\n        timelineData.forEach(series => {\n            // Normalize data with respect to at/from/to temporal properties\n            series.data.forEach(item => {\n                item.at = self.getItemAvgDate(item);\n                item.from = self.getItemMinDate(item);\n                item.to = self.getItemMaxDate(item);\n            });\n            // Sort items within the series\n            var sortedItems = series.data.sort((a,b) => a.at < b.at ? -1 : a.at > b.at ? 1 : 0);\n            // On each item, set references to previous and next items\n            sortedItems.forEach((o,i) => {\n                o.prevItem = i == 0 ? null : sortedItems[i-1];\n                o.nextItem = i == sortedItems.length-1 ? null : sortedItems[i+1];\n            });\n        })\n\n        // flatten grouped data elements into a single array\n        let allElements = timelineData.reduce((agg, e) => agg.concat(e.data), []);\n\n        let minDt = d3.min(allElements, self.getItemMinDate);\n        let maxDt = d3.max(allElements, self.getItemMaxDate);\n        // zoom out just slightly, to allow for a little space on either end of the timeline\n        let dateDelta = maxDt.getTime() - minDt.getTime();\n        let zoomOutPct = .02;  // 2%\n        minDt = new Date(minDt.getTime() - (dateDelta * zoomOutPct));\n        maxDt = new Date(maxDt.getTime() + (dateDelta * zoomOutPct));\n\n        let timelineContainer = d3.select(element)\n            .append('div')\n            .classed('timeline-chart', true);\n        let timelineContainerElement = timelineContainer.node();\n\n        let elementWidth = options.width || timelineContainerElement.clientWidth || 600;\n        let elementHeight = options.height || timelineContainerElement.clientHeight || 200;\n\n        let margin = {\n            top: 20,\n            right: 0,\n            bottom: 0,  // set to about 20 for a bottom-aligned axis\n            left: 0\n        };\n\n        let dataIdClassPrefix = \"_id_\";\n\n        let componentWidth = elementWidth - margin.left - margin.right;\n        let componentHeight = elementHeight - margin.top - margin.bottom;\n\n        // Width of the series label area\n        let groupWidth = options.groupWidth || 400;  // options.hideGroupLabels ? 0 : 400;\n\n        // Height of each section containing a horizontal series.  By default, fit each series into the available vertical space.\n        let groupHeight = componentHeight / timelineData.length;\n        // Otherwise, if the groupHeight option is set, then use its value for the height of each series, and set the total height accordingly.\n        if (!!options.groupHeight)\n        {\n            groupHeight = options.groupHeight;\n            componentHeight = groupHeight * timelineData.length;\n        }\n\n        let xTimeScaleOriginal = (options.useLocalTimeScale === true ? d3.scaleTime() : d3.scaleUtc())\n            .domain([minDt, maxDt])\n            .range([groupWidth, componentWidth]);\n        let xTimeScaleForContent = xTimeScaleOriginal;\n\n        // X axis ticks\n        let xAxis = d3.axisTop(xTimeScaleForContent)\n            //.orient('top') // set to 'bottom' for a bottom-aligned axis and to 'top' for a top-aligned axis\n            .tickSize(componentHeight); // set to height for a bottom-aligned axis and to -height for a top-aligned axis\n        let xAxisScaled = xAxis;\n\n        // In order to upgrade from v3 to v4, this needs to change.\n        // See here:  https://coderwall.com/p/psogia/simplest-way-to-add-zoom-pan-on-d3-js\n        let zoom = d3.zoom()\n            .on('zoom', zoomed)\n            .scaleExtent([1, Infinity])\n            .extent([[groupWidth,0], [componentWidth, componentHeight]])\n            .translateExtent([[groupWidth,0], [componentWidth, componentHeight]])\n\n        let svg = self.svgElement = timelineContainer\n            .append('svg')\n            .attr('width', componentWidth + margin.left + margin.right)\n            .attr('height', componentHeight + margin.top + margin.bottom);\n\n        // All elements affected by the zooming behavior are created in the zoom() fn.\n        let svg_g = svg\n            .append('g')\n            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n        svg_g.call(zoom); //.transform);\n\n        // let selectionFilter = svg_g.append(\"defs\")\n        //     .append(\"filter\")\n        //     .attr(\"id\",'blurred')\n        //     .attr({\"x\":\"-50%\", \"y\":\"-50%\", \"width\":\"200%\", \"height\":\"200%\"})\n        //     .append(\"feGaussianBlur\").attr(\"stdDeviation\", 12);\n\n        function uuidv4() {\n            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n            )\n        }\n          \n        let chartContentClipPathId = \"chart-content-clip-path-\"+uuidv4();\n        let clipPathRect = svg_g.append('defs')\n            .append('clipPath')\n            .attr('id', chartContentClipPathId)\n            .append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', componentHeight)\n            .attr('width', componentWidth - groupWidth)\n\n        // Invisible rect covering chart bounds, ensuring that all interactions intended for the chart will be raised as events on SVG elements\n        let interactionRect = svg_g.append('rect')\n            .attr('class', 'chart-bounds')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', componentHeight)\n            .attr('width', componentWidth - groupWidth);\n\n        //interactionRect.call(zoom);\n\n        if (options.enableLiveTimer) {\n            self.now = svg_g.append('line')\n                .attr('clip-path', `url(#${chartContentClipPathId})`)\n                .attr('class', 'vertical-marker now')\n                .attr(\"y1\", 0)\n                .attr(\"y2\", componentHeight);\n        }\n\n        let seriesBackground = svg_g.selectAll('.series-background')\n            .data(timelineData)\n            .enter()\n            .append('rect')\n            .attr('class', 'series-background')\n            .attr('x', 0)\n            .attr('y', (d, i) => { return groupHeight * i; })\n            .attr('width', componentWidth)\n            .attr('height', groupHeight)\n            .style('fill', (d, i) => {\n                // For numeric values of grouping key, use them.  Otherwise, use the supplied index (i).\n                var index = Math.abs(Math.floor((d.groupingKey == d.groupingKey*1 ? d.groupingKey : i)%10)*2-1);\n                return d3.schemeCategory20[index];\n            });\n\n        // horizontal lines between groups.  (This used to use the 'group-section' class, but is now using the 'series' terminology.)\n        let seriesDividers = svg_g.selectAll('.series-divider')\n            .data(timelineData)\n            .enter()\n            .append('line')\n            .attr('class', 'series-divider')\n            .attr('x1', 0)\n            .attr('x2', componentWidth)\n            .attr('y1', (d, i) => {\n                return groupHeight * (i + 1);\n            })\n            .attr('y2', (d, i) => {\n                return groupHeight * (i + 1);\n            });\n\n        let translucentOverlay = svg_g.append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('width', componentWidth - groupWidth)\n            .attr('height', componentHeight)\n            .style('fill', \"#fff\")\n            .style('fill-opacity', '.25');\n\n        let boundingRect = svg_g.append('rect')\n            .attr('x', 0)\n            .attr('y', 0)\n            .attr('width', componentWidth)\n            .attr('height', componentHeight)\n            .style('stroke', \"#000\");\n\n        // Axis with labels and ticks\n        let gX = svg_g.append('g')\n            .attr('class', 'x axis')\n            .attr('transform', 'translate(0,' + componentHeight + ')')\n            .call(xAxis);\n\n        // Monitor for change in size of containing element\n        setInterval(handleWidthChange, 1000);\n\n        function handleWidthChange() {\n            var newWidth = timelineContainerElement.clientWidth - margin.left - margin.right - 2;\n\n            if (newWidth > 0 && newWidth != componentWidth)\n            {\n                componentWidth = newWidth;\n                svg.attr(\"width\", componentWidth) ;\n                seriesDividers.attr('x2', componentWidth);\n                seriesBackground.attr('width', componentWidth);\n                boundingRect.attr('width', componentWidth);\n\n                var interactionWidth = componentWidth - groupWidth;\n                translucentOverlay.attr('width', interactionWidth);\n                clipPathRect.attr(\"width\", interactionWidth);\n                interactionRect.attr(\"width\", interactionWidth);\n                \n                xTimeScaleOriginal.range([groupWidth, componentWidth]);\n                xTimeScaleForContent.range([groupWidth, componentWidth]);\n                xAxisScaled = xAxis.scale(xTimeScaleForContent);\n                zoom\n                    .extent([[groupWidth,0], [componentWidth, componentHeight]])\n                    .translateExtent([[groupWidth,0], [componentWidth, componentHeight]]);\n                zoomed();\n                console.log(\"Width changed.  New total width: \", componentWidth, \"New interactive width: \", interactionWidth);\n            }\n        }\n\n        // heading / label text (for each series)\n        if (options.groupWidth > 0) {\n            let groupLabels = svg_g.selectAll('.series-label')\n                .data(timelineData)\n                .enter()\n                .append('text')\n                .attr('class', 'series-label')\n                .attr('x', '0.5em') //0)\n                .attr('y', (d, i) => {\n                    return (groupHeight * i) + (groupHeight / 2) ; //+ 5.5;\n                })\n                .attr('dx', '0.5em')\n                .attr('dy', '.4em')  //'-.1em')  //'0.5em')\n                .text(d => d.label)\n                .call(wrap, groupWidth);\n\n            let lineSection = svg_g.append('line').attr('x1', groupWidth).attr('x2', groupWidth).attr('y1', 0).attr('y2', componentHeight).attr('stroke', 'orange');\n        }\n\n        let groupIntervalItems = svg_g.selectAll('.series-interval-item')\n            .data(timelineData)\n            .enter()\n            .append('g')\n            .attr('clip-path', `url(#${chartContentClipPathId})`)\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.INTERVAL))\n            .enter();\n\n        let intervalBarHeight = 0.8 * groupHeight;\n        let intervalBarMargin = (groupHeight - intervalBarHeight) / 2;\n        let intervals = groupIntervalItems\n            .append('rect')\n            .attr('class', curry(addClasses, 'interval'))\n            .attr('width', (d) => Math.max(options.intervalMinWidth, xTimeScaleForContent(d.to) - xTimeScaleForContent(d.from)))\n            .attr('height', intervalBarHeight)\n            .attr('y', intervalBarMargin)\n            .attr('x', (d) => xTimeScaleForContent(d.from))\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        // interval text\n        let intervalTexts = groupIntervalItems\n            .append('text')\n            .text(d => d.label || '')  //  (typeof(d.label) === 'function' ? d.label(d) : d.label) || '')\n            .attr('class', curry(addClasses, 'interval-text'))\n            .attr('y', (groupHeight / 2) + 5)\n            .attr('x', (d) => xTimeScaleForContent(d.from));\n\n        let groupDotItems = svg_g.selectAll('.series-dot-item')\n            .data(timelineData)\n            .enter()\n            .append('g')\n            .attr('clip-path', `url(#${chartContentClipPathId})`)\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => {\n                return d.data.filter(_ => _.type === TimelineChart.TYPE.POINT);\n            })\n            .enter();\n\n        let dots = groupDotItems\n            .append('circle')\n            .attr('class', curry(addClasses, 'dot'))\n            .attr('cx', d => xTimeScaleForContent(d.at))\n            .attr('cy', groupHeight / 2)\n            .attr('r', 7)\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        // If set, options.tipContentGenerator should have the following form: function(timelineObjectForWhichToRenderTipContent)\n        // Note:  popper.js and tooltip.js are not required at this point.\n        if (options.tipContentGenerator) {\n            let tip = function() {\n                // The container element will hold the placeholder element and the tooltip element\n                // The reason we need this is because of how tooltip.js resolves the tooltip-inner element when updating the tooltip \"title\".\n                var container = document.createElement('div');\n                document.body.appendChild(container);\n\n                // The placeholder element will be used to position the tooltip by representing the\n                // area of the target element which is capable of being viewed.\n                var placeholderEl = d3.select(document.createElement('div'));\n                placeholderEl\n                    .style('position', 'absolute').style('top', 0)\n                    .style('opacity', 0)\n                    .style('pointer-events', 'none').style('box-sizing', 'border-box');\n                container.appendChild(placeholderEl.node());\n\n                function result() {\n                    console.log('calling tip fn');\n                }\n\n                var _tooltip = null;\n                function getToolTip() {\n\n                    // At this point, we should expect popper.js and tooltip.js to have been included, so that the Tooltip class is available before proceeding.\n                    if (window.Popper && window.Tooltip && _tooltip == null)\n                    {\n                        _tooltip = new Tooltip(placeholderEl.node(), {\n                            placement: 'top', \n                            title: 'initial value', \n                            html: true,\n                            popperOptions: {\n                                onCreate: function(p) { p.instance.popper.classList.add('show'); },\n                                modifiers: {\n                                    flip: {\n                                        behavior: ['top', 'bottom', 'left', 'right']\n                                    }\n                                }\n                            }\n                        });\n                        // Showing and hiding the tooltip will cause the tooltip node to be created\n                        _tooltip.show();\n                        _tooltip.hide();\n                        d3.select(_tooltip._tooltipNode).on('mouseenter', result.onMouseEnter);\n                        d3.select(_tooltip._tooltipNode).on('mouseleave', result.onMouseLeave);\n                    }\n                    return _tooltip;\n                }\n\n                var tipContentGenerator;\n\n                result.html = function(val) {\n                    tipContentGenerator = val;\n                };\n\n                var tipIsShowing = false;\n                var tipHideDelayTimeoutToken = null;\n                var targetElement = null;\n\n                result.onMouseEnter = function() {\n                    result.cancelHide();\n                };\n\n                result.onMouseLeave = function() {\n                    result.hideWithDelay();\n                };\n\n                // Cancel the delayed hide operation\n                result.cancelHide = function() {\n                    if (!tipHideDelayTimeoutToken) return;\n\n                    clearTimeout(tipHideDelayTimeoutToken);\n                    tipHideDelayTimeoutToken = null;\n                };\n\n                result.hideNow = function() {\n                    if (!tipIsShowing) return;\n\n                    // If this method was called before the hide delay timeout expired, then cancel the pending operation\n                    result.cancelHide();\n\n                    tipHideDelayTimeoutToken = null;\n                    getToolTip().hide();\n                    tipIsShowing = false;\n                    targetElement = null;\n                };\n\n                result.hideWithDelay = function() {\n                    tipHideDelayTimeoutToken = setTimeout(() => {\n                        result.hideNow();\n                    }, 250);\n                };\n\n                result.show = function(d) {\n                    if (tipIsShowing && this == targetElement)\n                        result.cancelHide();\n                    else\n                        result.hideNow();\n\n                    // Update the position and dimensions of the placeholder element to match that of the target element.\n                    var rect = this.getBoundingClientRect();  // bounding client rect of target element\n                    var cliprect = interactionRect.node().getBoundingClientRect();  // bounding client rect of element to clip the target element's coords to\n\n                    var top = rect.top + window.scrollY;\n                    var left = Math.max(rect.left,cliprect.left) + window.scrollX;\n                    var right = Math.min(rect.right,cliprect.right) + window.scrollX;\n                    var bottom = rect.bottom + window.scrollY;\n                    var height = Math.min(bottom-top, rect.height);\n                    var width = Math.min(right-left, rect.width);\n\n                    placeholderEl\n                        .style('top', top+'px')\n                        .style('left', left+'px')\n                        .style('height', height+'px')\n                        .style('width', width+'px');\n                    // Update the content of the tooltip by regenerating it to match the current data.\n                    var html = tipContentGenerator(d);\n                    var tt = getToolTip();\n                    tt.updateTitleContent(html);\n                    // show\n                    tt.show();\n                    tipIsShowing = true;\n                    targetElement = this;\n                };\n\n                return result;\n            }();\n\n\n            // Set fn for generating tip content\n            tip.html(options.tipContentGenerator);\n            dots.on('mouseover', tip.show).on('mouseout', tip.hideWithDelay);\n            intervals.on('mouseover', tip.show).on('mouseout', tip.hideWithDelay);\n        }\n\n        zoomed();\n\n        if (options.enableLiveTimer) {\n            setInterval(updateNowMarker, options.liveTimerTickInterval);\n        }\n\n\n        function wrap(text, width, anchorPosition) \n        {\n            text.each(function() {\n                var text = d3.select(this),\n                words = text.text().split(/\\s+/).reverse(),\n                word,\n                line = [],\n                lineNumber = 0,\n                lineHeight = 1.2, // ems\n                y = text.attr(\"y\"),\n                dx = parseFloat(text.attr(\"dx\")),\n                dy = parseFloat(text.attr(\"dy\"));\n                //lines = [];\n                var tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dx\", dx + \"em\").attr(\"dy\", dy + \"em\");\n                while (word = words.pop()) \n                {\n                    line.push(word);\n                    tspan.text(line.join(\" \"));\n                    // create line break\n                    if (tspan.node().getComputedTextLength() > width) \n                    {\n                        line.pop();\n                        tspan.text(line.join(\" \"));\n                        line = [word];\n                        //lines.push(line);\n                        tspan = text.append(\"tspan\")\n                            .attr(\"x\", 0)\n                            //.attr(\"y\", y)\n                            .attr(\"dx\", dx + \"em\")\n                            .attr(\"dy\", lineHeight + \"em\")  //++lineNumber * lineHeight + dy + \"em\")\n                            .text(word);\n                        var tspanFirst = text.select('tspan');\n                        dy = parseFloat(tspanFirst.attr(\"dy\"));\n                        tspanFirst.attr('dy', dy-(lineHeight*.5)+\"em\");\n                    }\n                }\n            });\n        }\n      \n        function updateNowMarker() {\n            let nowX = xTimeScaleForContent(new Date());\n\n            self.now.attr('x1', nowX).attr('x2', nowX);\n        }\n\n        function curry(fn) {\n            var args = Array.prototype.slice.call(arguments, 1);  // capture all but the 1st arg\n            return function() {\n                return fn.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n            }\n        }\n        \n        // Add to (this) selection the provided defaultClass and any customClass specified within the data.\n        function addClasses(defaultClass, data) {\n            //console.log('this: ', this, ' arguments: ', arguments);\n            var classes = [ defaultClass ];\n            if (!!data.customClass) classes.push(data.customClass);\n            var idClasses = (data.ids || []).map(id => dataIdClassPrefix+id);\n            return classes.concat(idClasses).join(' ');\n        }\n\n        function zoomed() {\n            if (self.onVizChangeFn && d3.event) {\n                self.onVizChangeFn.call(self, {\n                    scale: d3.event.scale,\n                    translate: d3.event.translate,\n                    domain: xTimeScaleForContent.domain()\n                });\n            }\n\n            if (options.enableLiveTimer) {\n                updateNowMarker();\n            }\n\n            var ___dummy___ = [ zoom ];  // include in closure\n            \n            if (d3.event && d3.event.transform) {\n            //console.log(d3.event.transform);  // includes k(scale), x, and y\n                // create new scale ojects based on event\n                xTimeScaleForContent = d3.event.transform.rescaleX(xTimeScaleOriginal);\n            }\n            else console.log('d3.event.transform is empty');\n\n            // update axes\n            xAxisScaled = xAxis.scale(xTimeScaleForContent);\n\n            // redraw axis\n            gX.call(xAxisScaled);\n            // redraw points and intervals\n            svg_g.selectAll('circle.dot').attr('cx', d => xTimeScaleForContent(d.at));\n            svg_g.selectAll('rect.interval').attr('x', d => xTimeScaleForContent(d.from)).attr('width', d => Math.max(options.intervalMinWidth, xTimeScaleForContent(d.to) - xTimeScaleForContent(d.from)));\n            svg_g.selectAll('.interval-text').attr('x', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return positionData.upToPosition;\n                    } else if (positionData.xPosition < groupWidth && positionData.upToPosition > groupWidth) {\n                        return groupWidth;\n                    }\n                    return positionData.xPosition;\n                }).attr('text-anchor', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return 'end';\n                    }\n                    return 'start';\n                })\n                .attr('dx', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return '-0.5em';\n                    }\n                    return '0.5em';\n                }).text(function(d) {\n                    var positionData = getTextPositionData.call(this, d);\n                    var percent = (positionData.width - options.textTruncateThreshold) / positionData.textWidth;\n                    var labelText = d.label || ''; //typeof(d.label)===\"string\" ? d.label : typeof(d.label)===\"function\" ? d.label(d) : '';\n                    if (percent < 1) {\n                        if (positionData.width > options.textTruncateThreshold) {\n                            return labelText.substr(0, Math.floor(labelText.length * percent)) + '...';\n                        } else {\n                            return '';\n                        }\n                    }\n\n                    return labelText;\n                });\n\n            function getTextPositionData(d) {\n                this.textSizeInPx = this.textSizeInPx || this.getComputedTextLength();\n                var from = xTimeScaleForContent(d.from);\n                var to = xTimeScaleForContent(d.to);\n                return {\n                    xPosition: from,\n                    upToPosition: to,\n                    width: to - from,\n                    textWidth: this.textSizeInPx\n                }\n            }\n        }\n\n        var getItemMinDate = self.getItemMinDate = function(pointOrInterval) {\n            var p = pointOrInterval;\n            return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n        };\n        var getItemMaxDate = self.getItemMaxDate = function(pointOrInterval) {\n            var p = pointOrInterval;\n            return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n        };\n    \n        // whether transitions should be animated by default\n        var animateTransitions = true;\n        self.animateTransitions = function(value) {\n            if (value === undefined)\n                return animateTransitions;\n            animateTransitions = !!value;\n        }\n\n        self.refresh = function() { zoomed(); }\n        \n        self.resetTransform = function(animate) {\n            if (animate === undefined ? animateTransitions : animate)\n                svg_g.transition().duration(500).call(zoom.transform, d3.zoomIdentity);\n            else\n                svg_g.call(zoom.transform, d3.zoomIdentity);\n        };\n\n        // translate the timeline so that the specified range value is centered within the view.  Extent constraints will be respected.\n        function translateToRangeValue(x, animate) {\n            if (animate === undefined ? animateTransitions : animate)\n                svg_g.transition().duration(500).call(zoom.translateTo, x, 0);\n            else\n                svg_g.call(zoom.translateTo, x, 0);\n        }\n        //self.translateToRangeValue = translateToRangeValue;\n\n        // set zoom scale\n        function setZoomScale(k, animate) {\n            if (animate === undefined ? animateTransitions : animate)\n                svg_g.transition().duration(500).call(zoom.scaleTo, k);\n            else\n                svg_g.call(zoom.scaleTo, k);\n        }\n\n        // translate to a position that is the given percentage between the min and max values\n        function translateToPercent(normalizedPercentage) {\n            var range = xTimeScaleForContent.range();\n            var delta = range[1] - range[0];\n            var x = delta * normalizedPercentage + range[0];\n            translateToRangeValue(x);\n        }\n        self.translateToPercent = translateToPercent;\n        \n        function translateToDate(date, animate) {\n            var rangeValue = xTimeScaleOriginal(date);\n            translateToRangeValue(rangeValue, animate);\n        }\n        self.translateToDate = translateToDate;\n\n        // Given one or more [string] ids, do one or both of the following:\n        //  - move the elements into view (via zooming and panning)\n        //  - apply the specified CSS class to the elements\n        self.highlightNodeByIds = function(idOrIdArray, moveIntoView, highlightCssClassName) {\n            var ___dummy___ = [zoom, xTimeScaleForContent];  // include zoom in closure\n            var idArray = typeof(idOrIdArray) === \"string\" ?  [idOrIdArray] : idOrIdArray;\n            if (idArray.constructor !== [].constructor) return { data: [] };\n\n            // Clear highlight in case one is set\n            d3.selectAll('.'+highlightCssClassName).classed(highlightCssClassName, false);\n\n            var selector = idArray.map(id => \".\"+dataIdClassPrefix+id).join(',');\n\n            // Bail out if no selector is available\n            if (!selector) return { data: [] };\n\n            var sel = d3.selectAll(selector);\n\n            // Bail out if selector doesn't match an element\n            if (sel.nodes().length == 0) return { data: [] };\n\n            // Highlight new node\n            sel.classed(highlightCssClassName, true);\n\n            var items = sel.data();\n            var itemToUse = items.find(item => item.type == TimelineChart.TYPE.POINT) || items[0];\n            // optionally scroll the node into view\n            if (!!moveIntoView) {\n                // TODO:  when an interval spans the entire view, using the itemTime returned for it will likely change the view considerably. \n                // Instead, find a better way to deal witht this, possibly using the time associated with the point clicked.  \n                // To do this, consider allowing an optional time to be provided to this method which will serve as the itemToUse/itemTime around which the view will be centered.\n                var itemTime = self.getItemAvgDate(itemToUse);\n                var rangeValue = xTimeScaleOriginal(itemTime);\n                var currentTransform = d3.zoomTransform(svg_g.node());\n\n                // leave log statements in here for now, for troubleshooting purposes\n                //console.log('target range value: ', rangeValue);\n                //console.log('current transform: ', currentTransform);\n                //console.log('original scale:  range: ', xTimeScaleOriginal.range(), 'domain: ', xTimeScaleOriginal.domain())\n                //console.log('current scale:  range: ', xTimeScaleForContent.range(), 'domain: ', xTimeScaleForContent.domain())\n\n                var neighborInfo = self.getSeriesNeighbors(itemToUse);\n                if (neighborInfo.nearest != null) {\n                    var timeCoord = xTimeScaleForContent(itemTime);\n                    var nearestTimeCoord = xTimeScaleForContent(neighborInfo.nearest.time);\n                    var timeDeltaInMs = Math.abs(timeCoord - nearestTimeCoord);\n                    var kNew = (20 / timeDeltaInMs) * currentTransform.k;\n                    //console.log('time delta (ms): ', timeDeltaInMs, 'new k: ', kNew);\n                    if (kNew > currentTransform.k) {\n                        //console.log('date: ', itemTime, 'x: ', timeCoord);\n                        //console.log('nearestDate: ', itemTime, 'x: ', nearestTimeCoord);\n                        //console.log('k current: ', currentTransform.k, 'new: ', kNew);\n                        // Perform scale transformation instantly\n                        setZoomScale(kNew, false);\n                    }\n                }\n\n                // Perform translation transformation with animation\n                translateToDate(itemTime, false);\n            }\n\n            return {\n                data: items\n            };\n        };\n\n        self.scaleTo = function(k) {\n            svg_g.call(zoom.scaleTo, k);\n        }\n\n        console.log(\"timeline data successfully bound to chart: \", timelineData);\n        console.log(\"timeline data flattened: \", allElements);\n    }\n    extendOptions(ext = {}) {\n        let defaultOptions = {\n            useLocalTimeScale: false,\n            intervalMinWidth: 8, // px\n            tipContentGenerator: undefined,\n            textTruncateThreshold: 30,\n            enableLiveTimer: false,\n            liveTimerTickInterval: 1000,\n            width: undefined,\n            height: undefined,\n            groupWidth: 400, // px\n            groupHeight: 40 // px\n        };\n        Object.keys(ext).map(k => defaultOptions[k] = ext[k]);\n        return defaultOptions;\n    }\n    getItemMinDate(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n    }\n    getItemMaxDate(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n    }\n    getItemAvgDate(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : new Date(p.from * 1 + (p.to - p.from)/2);\n    }\n    // get the previous and next dates in the series (that are not identical to the starting/ending dates of the current item)\n    getSeriesNeighbors(item) {\n        // Find an earlier item that ends before this item begins\n        var earlierEndingItem = item;\n        while(earlierEndingItem != null && earlierEndingItem.to >= item.from)\n            earlierEndingItem = earlierEndingItem.prevItem;\n    \n        // Find a later item that starts after this item ends\n        var laterStartingItem = item;\n        while(laterStartingItem != null && laterStartingItem.from <= item.to)\n            laterStartingItem = laterStartingItem.nextItem;\n\n        var result = {\n            earlier: earlierEndingItem == null ? null : {\n                item: earlierEndingItem,\n                time: earlierEndingItem.to,\n                interval:  item.from - earlierEndingItem.to\n            },\n            later: laterStartingItem == null ? null : {\n                item: laterStartingItem,\n                time: laterStartingItem.from,\n                interval: laterStartingItem.from - item.to\n            }\n        };\n        if (earlierEndingItem == null) result.nearest = result.later;\n        else if (laterStartingItem == null) result.nearest = result.earlier;\n        else result.nearest = result.earlier.interval < result.later.interval ? result.earlier : result.later;\n        return result;\n    }\n    onVizChange(fn) {\n        this.onVizChangeFn = fn;\n        return this;\n    }\n}\n\nTimelineChart.TYPE = {\n    POINT: Symbol(),\n    INTERVAL: Symbol()\n};\n\nmodule.exports = TimelineChart;\n "]}