{"version":3,"sources":["timeline-chart.js"],"names":["TimelineChart","element","data","opts","self","classList","add","options","extendOptions","allElements","reduce","agg","e","concat","minDt","d3","min","getPointMinDt","maxDt","max","getPointMaxDt","dateDelta","getTime","zoomOutPct","Date","elementWidth","width","clientWidth","elementHeight","height","clientHeight","margin","top","right","bottom","left","groupWidth","hideGroupLabels","groupHeight","length","xTimeScale","time","scale","domain","range","xAxis","svg","axis","orient","tickSize","zoom","behavior","x","on","zoomed","select","append","attr","svg_g","call","clipPathRect","interactionRect","enableLiveTimer","now","c20","category20c","seriesBackground","selectAll","enter","d","i","style","groupingKey","seriesDividers","setInterval","handleWidthChange","newWidth","groupLabels","text","label","wrap","lineSection","groupIntervalItems","filter","_","type","TYPE","INTERVAL","intervalBarHeight","intervalBarMargin","intervals","withCustom","Math","intervalMinWidth","to","from","onClick","intervalTexts","groupDotItems","POINT","dots","at","tip","html","show","hide","console","error","updateNowMarker","timerTickInterval","anchorPosition","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dx","parseFloat","dy","lines","tspan","pop","push","join","node","getComputedTextLength","nowX","defaultClass","customClass","onVizChangeFn","event","translate","positionData","getTextPositionData","upToPosition","textWidth","xPosition","percent","textTruncateThreshold","labelText","substr","floor","textSizeInPx","ext","defaultOptions","undefined","Object","keys","map","k","p","fn","Symbol","module","exports"],"mappings":"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","file":"timeline-chart.js","sourcesContent":["/*\nProvided data should match the following grammar/rules:\n\n<timeline_data> : \n[\n    <series_data>,\n    <series_data>,\n    ...\n]\n\n<series_data> :\n[\n    label: <label-expression>,\n    data: \n    [\n        <series_item>\n    ]\n]\n\n<series_item> : <series_interval> OR <series_point>\n\n<series_interval> : \n{\n    type: TimelineChart.TYPE.INTERVAL,\n    label: <label-expression>,\n    from: <Date>,\n    to: <Date>,\n    customClass: <css-class>,\n    onClick: <function>\n}\n\n<series_point> :\n{\n    type: TimelineChart.TYPE.INTERVAL,\n    label: <label>,\n    at: <Date>,\n    customClass: <css-class>,\n    onClick: <function>\n}\n\n<label-expression> : <string>\n\n<css-class> : <string>\n\n*/\nclass TimelineChart {\n    constructor(element, data, opts) {\n        let self = this;\n\n        element.classList.add('timeline-chart');\n\n        let options = this.extendOptions(opts);\n\n        let allElements = data.reduce((agg, e) => agg.concat(e.data), []);\n\n        let minDt = d3.min(allElements, this.getPointMinDt);\n        let maxDt = d3.max(allElements, this.getPointMaxDt);\n        // zoom out just slightly, to allow for a little space on either end of the timeline\n        let dateDelta = maxDt.getTime() - minDt.getTime();\n        let zoomOutPct = .02;  // 2%\n        minDt = new Date(minDt.getTime() - (dateDelta * zoomOutPct));\n        maxDt = new Date(maxDt.getTime() + (dateDelta * zoomOutPct));\n\n        let elementWidth = options.width || element.clientWidth || 600;\n        let elementHeight = options.height || element.clientHeight || 200;\n\n        let margin = {\n            top: 20,\n            right: 0,\n            bottom: 0,  // set to about 20 for a bottom-aligned axis\n            left: 0\n        };\n\n        let width = elementWidth - margin.left - margin.right;\n        let height = elementHeight - margin.top - margin.bottom;\n\n        // Width of the series label area\n        let groupWidth = options.hideGroupLabels ? 0 : 400;\n        // Height of each section containing a horizontal series.  By default, fit each series into the available vertical space.\n        let groupHeight = height / data.length;\n\n        // If the groupHeight option is set, then use its value for the height of each series, and set the total height accordingly.\n        if (!!options.groupHeight)\n        {\n            groupHeight = options.groupHeight;\n            height = groupHeight * data.length;\n        }\n\n        let xTimeScale = d3.time.scale()\n            .domain([minDt, maxDt])\n            .range([groupWidth, width]);\n\n        // X axis ticks\n        let xAxis = d3.svg.axis()\n            .scale(xTimeScale)\n            .orient('top') // set to 'bottom' for a bottom-aligned axis and to 'top' for a top-aligned axis\n            .tickSize(height); // set to height for a bottom-aligned axis and to -height for a top-aligned axis\n\n        // In order to upgrade from v3 to v4, this needs to change.\n        // See here:  https://coderwall.com/p/psogia/simplest-way-to-add-zoom-pan-on-d3-js\n        let zoom = d3.behavior.zoom()\n            .x(xTimeScale)\n            .on('zoom', zoomed);\n\n        let svg = d3.select(element).append('svg')\n            .attr('width', width + margin.left + margin.right)\n            .attr('height', height + margin.top + margin.bottom);\n\n        // All elements affected by the zooming behavior are created in the zoom() fn.\n        let svg_g = svg\n            .append('g')\n            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n            .call(zoom);\n\n        let clipPathRect = svg_g.append('defs')\n            .append('clipPath')\n            .attr('id', 'chart-content')\n            .append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        // Invisible rect covering chart bounds, ensuring that all interactions intended for the chart will be raised as events on SVG elements\n        let interactionRect = svg_g.append('rect')\n            .attr('class', 'chart-bounds')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        if (options.enableLiveTimer) {\n            self.now = svg_g.append('line')\n                .attr('clip-path', 'url(#chart-content)')\n                .attr('class', 'vertical-marker now')\n                .attr(\"y1\", 0)\n                .attr(\"y2\", height);\n        }\n\n        var c20 = d3.scale.category20c();\n        let seriesBackground = svg_g.selectAll('.series-background')\n            .data(data)\n            .enter()\n            .append('rect')\n            .attr('class', 'series-background')\n            .attr('x', 0)\n            .attr('y', (d, i) => { return groupHeight * i; })\n            .attr('width', width)\n            .attr('height', groupHeight)\n            .style('fill', (d, i) => {\n                return c20(d.groupingKey || i);\n            });\n\n        // horizontal lines between groups.  (This used to use the 'group-section' class, but is now using the 'series' terminology.)\n        let seriesDividers = svg_g.selectAll('.series-divider')\n            .data(data)\n            .enter()\n            .append('line')\n            .attr('class', 'series-divider')\n            .attr('x1', 0)\n            .attr('x2', width)\n            .attr('y1', (d, i) => {\n                return groupHeight * (i + 1);\n            })\n            .attr('y2', (d, i) => {\n                return groupHeight * (i + 1);\n            });\n\n        // Axis with labels and ticks\n        svg_g.append('g')\n            .attr('class', 'x axis')\n            .attr('transform', 'translate(0,' + height + ')')\n            .call(xAxis);\n\n        // Monitor for change in size of containing element\n        setInterval(handleWidthChange, 1000);\n\n        function handleWidthChange() {\n            var newWidth = element.clientWidth - margin.left - margin.right - 2;\n\n            if (newWidth != width)\n            {\n                //console.log('xTimeScale', xTimeScale);\n                //console.log(\"old width: \", width);\n                //console.log(\"new width: \", newWidth);\n                width = newWidth;\n\n                svg.attr(\"width\", width) ;\n                seriesDividers.attr('x2', width);\n                seriesBackground.attr('width', width);\n                clipPathRect.attr(\"width\", width);\n                interactionRect.attr(\"width\", width - groupWidth);\n                xTimeScale.range([xTimeScale.range()[0], width]);\n                zoomed();\n            }\n        }\n\n        // heading / label text (for each series)\n        if (!options.hideGroupLabels) {\n            let groupLabels = svg_g.selectAll('.series-label')\n                .data(data)\n                .enter()\n                .append('text')\n                .attr('class', 'series-label')\n                .attr('x', '0.5em') //0)\n                .attr('y', (d, i) => {\n                    return (groupHeight * i) + (groupHeight / 2) ; //+ 5.5;\n                })\n                .attr('dx', '0.5em')\n                .attr('dy', '0')  //'0.5em')\n                .text(d => d.label)\n                .call(wrap, groupWidth);\n\n            let lineSection = svg_g.append('line').attr('x1', groupWidth).attr('x2', groupWidth).attr('y1', 0).attr('y2', height).attr('stroke', 'orange');\n        }\n\n        let groupIntervalItems = svg_g.selectAll('.series-interval-item')\n            .data(data)\n            .enter()\n            .append('g')\n            .attr('clip-path', 'url(#chart-content)')\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.INTERVAL))\n            .enter();\n\n        let intervalBarHeight = 0.8 * groupHeight;\n        let intervalBarMargin = (groupHeight - intervalBarHeight) / 2;\n        let intervals = groupIntervalItems\n            .append('rect')\n            .attr('class', withCustom('interval'))\n            .attr('width', (d) => Math.max(options.intervalMinWidth, xTimeScale(d.to) - xTimeScale(d.from)))\n            .attr('height', intervalBarHeight)\n            .attr('y', intervalBarMargin)\n            .attr('x', (d) => xTimeScale(d.from))\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        // interval text\n        let intervalTexts = groupIntervalItems\n            .append('text')\n            .text(d => d.label || '')  //  (typeof(d.label) === 'function' ? d.label(d) : d.label) || '')\n            .attr('fill', 'white')\n            .attr('class', withCustom('interval-text'))\n            .attr('y', (groupHeight / 2) + 5)\n            .attr('x', (d) => xTimeScale(d.from));\n\n        let groupDotItems = svg_g.selectAll('.series-dot-item')\n            .data(data)\n            .enter()\n            .append('g')\n            .attr('clip-path', 'url(#chart-content)')\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => {\n                return d.data.filter(_ => _.type === TimelineChart.TYPE.POINT);\n            })\n            .enter();\n\n        let dots = groupDotItems\n            .append('circle')\n            .attr('class', withCustom('dot'))\n            .attr('cx', d => xTimeScale(d.at))\n            .attr('cy', groupHeight / 2)\n            .attr('r', 7)\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        if (options.tip) {\n            if (d3.tip) {\n                let tip = d3.tip().attr('class', 'd3-tip').html(options.tip);\n                svg_g.call(tip);\n                dots.on('mouseover', tip.show).on('mouseout', tip.hide);\n                intervals.on('mouseover', tip.show).on('mouseout', tip.hide);\n            } else {\n                console.error('Please make sure you have d3.tip included as dependency (https://github.com/Caged/d3-tip)');\n            }\n        }\n\n        zoomed();\n\n        if (options.enableLiveTimer) {\n            setInterval(updateNowMarker, options.timerTickInterval);\n        }\n\n\n        function wrap(text, width, anchorPosition) \n        {\n            text.each(function() {\n                var text = d3.select(this),\n                words = text.text().split(/\\s+/).reverse(),\n                word,\n                line = [],\n                lineNumber = 0,\n                lineHeight = 1.1, // ems\n                y = text.attr(\"y\"),\n                dx = parseFloat(text.attr(\"dx\")),\n                dy = parseFloat(text.attr(\"dy\")),\n                lines = [];\n                var tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dx\", dx + \"em\").attr(\"dy\", dy + \"em\");\n                while (word = words.pop()) \n                {\n                    line.push(word);\n                    tspan.text(line.join(\" \"));\n                    if (tspan.node().getComputedTextLength() > width) \n                    {\n                        line.pop();\n                        tspan.text(line.join(\" \"));\n                        line = [word];\n                        lines.push(line);\n                        tspan = text.append(\"tspan\")\n                            .attr(\"x\", 0)\n                            .attr(\"y\", y)\n                            .attr(\"dx\", dx + \"em\")\n                            .attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\")\n                            .text(word);\n                    }\n                }\n            });\n        }\n      \n        function updateNowMarker() {\n            let nowX = xTimeScale(new Date());\n\n            self.now.attr('x1', nowX).attr('x2', nowX);\n        }\n\n        function withCustom(defaultClass) {\n            return d => d.customClass ? [d.customClass, defaultClass].join(' ') : defaultClass\n        }\n\n        function zoomed() {\n            if (self.onVizChangeFn && d3.event) {\n                self.onVizChangeFn.call(self, {\n                    scale: d3.event.scale,\n                    translate: d3.event.translate,\n                    domain: xTimeScale.domain()\n                });\n            }\n\n            if (options.enableLiveTimer) {\n                updateNowMarker();\n            }\n\n            svg_g.select('.x.axis').call(xAxis);\n\n            svg_g.selectAll('circle.dot').attr('cx', d => xTimeScale(d.at));\n            svg_g.selectAll('rect.interval').attr('x', d => xTimeScale(d.from)).attr('width', d => Math.max(options.intervalMinWidth, xTimeScale(d.to) - xTimeScale(d.from)));\n\n            svg_g.selectAll('.interval-text').attr('x', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return positionData.upToPosition;\n                    } else if (positionData.xPosition < groupWidth && positionData.upToPosition > groupWidth) {\n                        return groupWidth;\n                    }\n                    return positionData.xPosition;\n                }).attr('text-anchor', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return 'end';\n                    }\n                    return 'start';\n                })\n                .attr('dx', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return '-0.5em';\n                    }\n                    return '0.5em';\n                }).text(function(d) {\n                    var positionData = getTextPositionData.call(this, d);\n                    var percent = (positionData.width - options.textTruncateThreshold) / positionData.textWidth;\n                    // (typeof(d.label) === 'function' ? d.label(d) : d.label) || ''\n                    var labelText = d.label || ''; //typeof(d.label)===\"string\" ? d.label : typeof(d.label)===\"function\" ? d.label(d) : '';\n                    if (percent < 1) {\n                        if (positionData.width > options.textTruncateThreshold) {\n                            //return d.label.substr(0, Math.floor(d.label.length * percent)) + '...';\n                            return labelText.substr(0, Math.floor(labelText.length * percent)) + '...';\n                        } else {\n                            return '';\n                        }\n                    }\n\n                    return labelText;\n                });\n\n            function getTextPositionData(d) {\n                this.textSizeInPx = this.textSizeInPx || this.getComputedTextLength();\n                var from = xTimeScale(d.from);\n                var to = xTimeScale(d.to);\n                return {\n                    xPosition: from,\n                    upToPosition: to,\n                    width: to - from,\n                    textWidth: this.textSizeInPx\n                }\n            }\n        }\n    }\n    extendOptions(ext = {}) {\n        let defaultOptions = {\n            intervalMinWidth: 8, // px\n            tip: undefined,\n            textTruncateThreshold: 30,\n            enableLiveTimer: false,\n            timerTickInterval: 1000,\n            hideGroupLabels: false\n        };\n        Object.keys(ext).map(k => defaultOptions[k] = ext[k]);\n        return defaultOptions;\n    }\n    getPointMinDt(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n    }\n    getPointMaxDt(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n    }\n    onVizChange(fn) {\n        this.onVizChangeFn = fn;\n        return this;\n    }\n\n}\n\nTimelineChart.TYPE = {\n    POINT: Symbol(),\n    INTERVAL: Symbol()\n};\n\nmodule.exports = TimelineChart;\n "]}