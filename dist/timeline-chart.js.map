{"version":3,"sources":["timeline-chart.js"],"names":["TimelineChart","element","data","opts","self","classList","add","options","extendOptions","allElements","reduce","agg","e","concat","minDt","d3","min","getPointMinDt","maxDt","max","getPointMaxDt","dateDelta","getTime","zoomOutPct","Date","elementWidth","width","clientWidth","elementHeight","height","clientHeight","margin","top","right","bottom","left","groupWidth","hideGroupLabels","groupHeight","length","x","time","scale","domain","range","xAxis","svg","axis","orient","tickSize","zoom","behavior","on","zoomed","select","append","attr","call","enableLiveTimer","now","groupSection","selectAll","enter","d","i","groupLabels","text","label","wrap","lineSection","groupIntervalItems","filter","_","type","TYPE","INTERVAL","intervalBarHeight","intervalBarMargin","intervals","withCustom","Math","intervalMinWidth","to","from","onClick","intervalTexts","groupDotItems","POINT","dots","at","tip","html","show","hide","console","error","setInterval","updateNowMarker","timerTickInterval","anchorPosition","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dx","parseFloat","dy","lines","tspan","pop","push","join","node","getComputedTextLength","nowX","defaultClass","customClass","onVizChangeFn","event","translate","positionData","getTextPositionData","upToPosition","textWidth","xPosition","percent","textTruncateThreshold","labelText","substr","floor","textSizeInPx","ext","defaultOptions","undefined","Object","keys","map","k","p","fn","Symbol","module","exports"],"mappings":"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","file":"timeline-chart.js","sourcesContent":["class TimelineChart {\n    constructor(element, data, opts) {\n        let self = this;\n\n        element.classList.add('timeline-chart');\n\n        let options = this.extendOptions(opts);\n\n        let allElements = data.reduce((agg, e) => agg.concat(e.data), []);\n\n        let minDt = d3.min(allElements, this.getPointMinDt);\n        let maxDt = d3.max(allElements, this.getPointMaxDt);\n        // zoom out just slightly, to allow for a little space on either end of the timeline\n        let dateDelta = maxDt.getTime() - minDt.getTime();\n        let zoomOutPct = .02;\n        minDt = new Date(minDt.getTime() - (dateDelta * zoomOutPct));\n        maxDt = new Date(maxDt.getTime() + (dateDelta * zoomOutPct));\n\n        let elementWidth = options.width || element.clientWidth || 600;\n        let elementHeight = options.height || element.clientHeight || 200;\n\n        let margin = {\n            top: 20,\n            right: 0,\n            bottom: 0,  // set to about 20 for a bottom-aligned axis\n            left: 0\n        };\n\n        let width = elementWidth - margin.left - margin.right;\n        let height = elementHeight - margin.top - margin.bottom;\n\n        // Width of the group label area\n        let groupWidth = options.hideGroupLabels ? 0 : 400;\n        // Height of each section containing a horizontal series.  By default, fit each series into the available vertical space.\n        let groupHeight = height / data.length;\n\n        // If the groupHeight option is set, then use its value for the height of each series, and set the total height accordingly.\n        if (!!options.groupHeight)\n        {\n            groupHeight = options.groupHeight;\n            height = groupHeight * data.length;\n        }\n\n        let x = d3.time.scale()\n            .domain([minDt, maxDt])\n            .range([groupWidth, width]);\n\n        // X axis ticks\n        let xAxis = d3.svg.axis()\n            .scale(x)\n            .orient('top') // set to 'bottom' for a bottom-aligned axis and to 'top' for a top-aligned axis\n            .tickSize(height); // set to height for a bottom-aligned axis and to -height for a top-aligned axis\n\n        let zoom = d3.behavior.zoom()\n            .x(x)\n            .on('zoom', zoomed);\n\n        let svg = d3.select(element).append('svg')\n            .attr('width', width + margin.left + margin.right)\n            .attr('height', height + margin.top + margin.bottom)\n            .append('g')\n            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n            .call(zoom);\n\n        svg.append('defs')\n            .append('clipPath')\n            .attr('id', 'chart-content')\n            .append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        svg.append('rect')\n            .attr('class', 'chart-bounds')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        // Axis with labels and ticks\n        svg.append('g')\n            .attr('class', 'x axis')\n            .attr('transform', 'translate(0,' + height + ')')\n            .call(xAxis);\n\n        if (options.enableLiveTimer) {\n            self.now = svg.append('line')\n                .attr('clip-path', 'url(#chart-content)')\n                .attr('class', 'vertical-marker now')\n                .attr(\"y1\", 0)\n                .attr(\"y2\", height);\n        }\n\n        // horizontal lines between groups\n        let groupSection = svg.selectAll('.group-section')\n            .data(data)\n            .enter()\n            .append('line')\n            .attr('class', 'group-section')\n            .attr('x1', 0)\n            .attr('x2', width)\n            .attr('y1', (d, i) => {\n                return groupHeight * (i + 1);\n            })\n            .attr('y2', (d, i) => {\n                return groupHeight * (i + 1);\n            });\n\n        // group label text (for each series)\n        if (!options.hideGroupLabels) {\n            let groupLabels = svg.selectAll('.group-label')\n                .data(data)\n                .enter()\n                .append('text')\n                .attr('class', 'group-label')\n                .attr('x', '0.5em') //0)\n                .attr('y', (d, i) => {\n                    return (groupHeight * i) + (groupHeight / 2) ; //+ 5.5;\n                })\n                .attr('dx', '0.5em')\n                .attr('dy', '0')  //'0.5em')\n                .text(d => d.label)\n                .call(wrap, groupWidth);\n\n            let lineSection = svg.append('line').attr('x1', groupWidth).attr('x2', groupWidth).attr('y1', 0).attr('y2', height).attr('stroke', 'orange');\n        }\n\n        let groupIntervalItems = svg.selectAll('.group-interval-item')\n            .data(data)\n            .enter()\n            .append('g')\n            .attr('clip-path', 'url(#chart-content)')\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.INTERVAL))\n            .enter();\n\n        let intervalBarHeight = 0.8 * groupHeight;\n        let intervalBarMargin = (groupHeight - intervalBarHeight) / 2;\n        let intervals = groupIntervalItems\n            .append('rect')\n            .attr('class', withCustom('interval'))\n            .attr('width', (d) => Math.max(options.intervalMinWidth, x(d.to) - x(d.from)))\n            .attr('height', intervalBarHeight)\n            .attr('y', intervalBarMargin)\n            .attr('x', (d) => x(d.from))\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        // interval text\n        let intervalTexts = groupIntervalItems\n            .append('text')\n            .text(d => d.label || '')  //  (typeof(d.label) === 'function' ? d.label(d) : d.label) || '')\n            .attr('fill', 'white')\n            .attr('class', withCustom('interval-text'))\n            .attr('y', (groupHeight / 2) + 5)\n            .attr('x', (d) => x(d.from));\n\n        let groupDotItems = svg.selectAll('.group-dot-item')\n            .data(data)\n            .enter()\n            .append('g')\n            .attr('clip-path', 'url(#chart-content)')\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => {\n                return d.data.filter(_ => _.type === TimelineChart.TYPE.POINT);\n            })\n            .enter();\n\n        let dots = groupDotItems\n            .append('circle')\n            .attr('class', withCustom('dot'))\n            .attr('cx', d => x(d.at))\n            .attr('cy', groupHeight / 2)\n            .attr('r', 7)\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        if (options.tip) {\n            if (d3.tip) {\n                let tip = d3.tip().attr('class', 'd3-tip').html(options.tip);\n                svg.call(tip);\n                dots.on('mouseover', tip.show).on('mouseout', tip.hide);\n                intervals.on('mouseover', tip.show).on('mouseout', tip.hide);\n            } else {\n                console.error('Please make sure you have d3.tip included as dependency (https://github.com/Caged/d3-tip)');\n            }\n        }\n\n        zoomed();\n\n        if (options.enableLiveTimer) {\n            setInterval(updateNowMarker, options.timerTickInterval);\n        }\n\n        function wrap(text, width, anchorPosition) \n        {\n            text.each(function() {\n                var text = d3.select(this),\n                words = text.text().split(/\\s+/).reverse(),\n                word,\n                line = [],\n                lineNumber = 0,\n                lineHeight = 1.1, // ems\n                y = text.attr(\"y\"),\n                dx = parseFloat(text.attr(\"dx\")),\n                dy = parseFloat(text.attr(\"dy\")),\n                lines = [];\n                var tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dx\", dx + \"em\").attr(\"dy\", dy + \"em\");\n                while (word = words.pop()) \n                {\n                    line.push(word);\n                    tspan.text(line.join(\" \"));\n                    if (tspan.node().getComputedTextLength() > width) \n                    {\n                        line.pop();\n                        tspan.text(line.join(\" \"));\n                        line = [word];\n                        lines.push(line);\n                        tspan = text.append(\"tspan\")\n                            .attr(\"x\", 0)\n                            .attr(\"y\", y)\n                            .attr(\"dx\", dx + \"em\")\n                            .attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\")\n                            .text(word);\n                    }\n                }\n            });\n        }\n      \n        function updateNowMarker() {\n            let nowX = x(new Date());\n\n            self.now.attr('x1', nowX).attr('x2', nowX);\n        }\n\n        function withCustom(defaultClass) {\n            return d => d.customClass ? [d.customClass, defaultClass].join(' ') : defaultClass\n        }\n\n        function zoomed() {\n            if (self.onVizChangeFn && d3.event) {\n                self.onVizChangeFn.call(self, {\n                    scale: d3.event.scale,\n                    translate: d3.event.translate,\n                    domain: x.domain()\n                });\n            }\n\n            if (options.enableLiveTimer) {\n                updateNowMarker();\n            }\n\n            svg.select('.x.axis').call(xAxis);\n\n            svg.selectAll('circle.dot').attr('cx', d => x(d.at));\n            svg.selectAll('rect.interval').attr('x', d => x(d.from)).attr('width', d => Math.max(options.intervalMinWidth, x(d.to) - x(d.from)));\n\n            svg.selectAll('.interval-text').attr('x', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return positionData.upToPosition;\n                    } else if (positionData.xPosition < groupWidth && positionData.upToPosition > groupWidth) {\n                        return groupWidth;\n                    }\n                    return positionData.xPosition;\n                }).attr('text-anchor', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return 'end';\n                    }\n                    return 'start';\n                })\n                .attr('dx', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return '-0.5em';\n                    }\n                    return '0.5em';\n                }).text(function(d) {\n                    var positionData = getTextPositionData.call(this, d);\n                    var percent = (positionData.width - options.textTruncateThreshold) / positionData.textWidth;\n                    // (typeof(d.label) === 'function' ? d.label(d) : d.label) || ''\n                    var labelText = d.label || ''; //typeof(d.label)===\"string\" ? d.label : typeof(d.label)===\"function\" ? d.label(d) : '';\n                    if (percent < 1) {\n                        if (positionData.width > options.textTruncateThreshold) {\n                            //return d.label.substr(0, Math.floor(d.label.length * percent)) + '...';\n                            return labelText.substr(0, Math.floor(labelText.length * percent)) + '...';\n                        } else {\n                            return '';\n                        }\n                    }\n\n                    return labelText;\n                });\n\n            function getTextPositionData(d) {\n                this.textSizeInPx = this.textSizeInPx || this.getComputedTextLength();\n                var from = x(d.from);\n                var to = x(d.to);\n                return {\n                    xPosition: from,\n                    upToPosition: to,\n                    width: to - from,\n                    textWidth: this.textSizeInPx\n                }\n            }\n        }\n    }\n    extendOptions(ext = {}) {\n        let defaultOptions = {\n            intervalMinWidth: 8, // px\n            tip: undefined,\n            textTruncateThreshold: 30,\n            enableLiveTimer: false,\n            timerTickInterval: 1000,\n            hideGroupLabels: false\n        };\n        Object.keys(ext).map(k => defaultOptions[k] = ext[k]);\n        return defaultOptions;\n    }\n    getPointMinDt(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n    }\n    getPointMaxDt(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n    }\n    onVizChange(fn) {\n        this.onVizChangeFn = fn;\n        return this;\n    }\n}\n\nTimelineChart.TYPE = {\n    POINT: Symbol(),\n    INTERVAL: Symbol()\n};\n\nmodule.exports = TimelineChart;\n "]}