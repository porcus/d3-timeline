{"version":3,"sources":["timeline-chart.js"],"names":["TimelineChart","element","timelineData","opts","constructor","length","self","classList","add","options","extendOptions","forEach","series","data","item","at","getItemAvgDate","from","getItemMinDate","to","getItemMaxDate","sortedItems","sort","a","b","o","i","prevItem","nextItem","allElements","reduce","agg","e","concat","minDt","d3","min","maxDt","max","dateDelta","getTime","zoomOutPct","Date","timelineContainer","select","append","classed","timelineContainerElement","node","elementWidth","width","clientWidth","elementHeight","height","clientHeight","margin","top","right","bottom","left","dataIdClassPrefix","groupWidth","groupHeight","xTimeScaleOriginal","scaleTime","domain","range","xTimeScaleForContent","xAxis","axisTop","tickSize","xAxisScaled","zoom","on","zoomed","scaleExtent","Infinity","extent","translateExtent","svg","svgElement","attr","svg_g","call","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","chartContentClipPathId","clipPathRect","interactionRect","enableLiveTimer","now","seriesBackground","selectAll","enter","d","style","index","Math","abs","floor","groupingKey","schemeCategory20","seriesDividers","translucentOverlay","boundingRect","gX","setInterval","handleWidthChange","newWidth","interactionWidth","scale","console","log","groupLabels","text","label","wrap","lineSection","groupIntervalItems","filter","_","type","TYPE","INTERVAL","intervalBarHeight","intervalBarMargin","intervals","curry","addClasses","intervalMinWidth","onClick","intervalTexts","groupDotItems","POINT","dots","window","Popper","Tooltip","tipContentGenerator","tip","container","document","createElement","body","appendChild","placeholderEl","result","_tooltip","getToolTip","placement","title","html","popperOptions","onCreate","p","instance","popper","modifiers","flip","behavior","show","hide","_tooltipNode","onMouseEnter","onMouseLeave","val","tipIsShowing","tipHideDelayTimeoutToken","targetElement","cancelHide","hideWithDelay","clearTimeout","hideNow","setTimeout","rect","getBoundingClientRect","cliprect","scrollY","scrollX","tt","updateTitleContent","updateNowMarker","timerTickInterval","anchorPosition","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dx","parseFloat","dy","tspan","pop","push","join","getComputedTextLength","tspanFirst","nowX","fn","args","Array","prototype","slice","arguments","apply","defaultClass","classes","customClass","idClasses","ids","map","id","onVizChangeFn","event","translate","___dummy___","transform","rescaleX","positionData","getTextPositionData","upToPosition","textWidth","xPosition","percent","textTruncateThreshold","labelText","substr","textSizeInPx","pointOrInterval","animateTransitions","value","undefined","refresh","resetTransform","animate","transition","duration","zoomIdentity","translateToRangeValue","x","translateTo","setZoomScale","k","scaleTo","translateToPercent","normalizedPercentage","delta","translateToDate","date","rangeValue","highlightNodeByIds","idOrIdArray","moveIntoView","highlightCssClassName","idArray","selector","sel","nodes","items","itemToUse","find","itemTime","currentTransform","zoomTransform","neighborInfo","getSeriesNeighbors","nearest","timeCoord","nearestTimeCoord","time","timeDeltaInMs","kNew","ext","defaultOptions","Object","keys","earlierEndingItem","laterStartingItem","earlier","interval","later","Symbol","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAgDMA,a;AACF,+BAAYC,OAAZ,EAAqBC,YAArB,EAAmCC,IAAnC,EAAyC;AAAA;;AACrC,gBAAI,CAACD,YAAD,IAAiBA,aAAaE,WAAb,IAA4B,GAAGA,WAAhD,IAA+D,CAACF,aAAaG,MAAjF,EAAyF,OAAO,IAAP;;AAEzF,gBAAIC,OAAO,IAAX;;AAEAL,oBAAQM,SAAR,CAAkBC,GAAlB,CAAsB,0BAAtB;;AAEA,gBAAIC,UAAU,KAAKC,aAAL,CAAmBP,IAAnB,CAAd;;AAEAD,yBAAaS,OAAb,CAAqB,kBAAU;AAC3B;AACAC,uBAAOC,IAAP,CAAYF,OAAZ,CAAoB,gBAAQ;AACxBG,yBAAKC,EAAL,GAAUT,KAAKU,cAAL,CAAoBF,IAApB,CAAV;AACAA,yBAAKG,IAAL,GAAYX,KAAKY,cAAL,CAAoBJ,IAApB,CAAZ;AACAA,yBAAKK,EAAL,GAAUb,KAAKc,cAAL,CAAoBN,IAApB,CAAV;AACH,iBAJD;AAKA;AACA,oBAAIO,cAAcT,OAAOC,IAAP,CAAYS,IAAZ,CAAiB,UAACC,CAAD,EAAGC,CAAH;AAAA,2BAASD,EAAER,EAAF,GAAOS,EAAET,EAAT,GAAc,CAAC,CAAf,GAAmBQ,EAAER,EAAF,GAAOS,EAAET,EAAT,GAAc,CAAd,GAAkB,CAA9C;AAAA,iBAAjB,CAAlB;AACA;AACAM,4BAAYV,OAAZ,CAAoB,UAACc,CAAD,EAAGC,CAAH,EAAS;AACzBD,sBAAEE,QAAF,GAAaD,KAAK,CAAL,GAAS,IAAT,GAAgBL,YAAYK,IAAE,CAAd,CAA7B;AACAD,sBAAEG,QAAF,GAAaF,KAAKL,YAAYhB,MAAZ,GAAmB,CAAxB,GAA4B,IAA5B,GAAmCgB,YAAYK,IAAE,CAAd,CAAhD;AACH,iBAHD;AAIH,aAdD;;AAgBA;AACA,gBAAIG,cAAc3B,aAAa4B,MAAb,CAAoB,UAACC,GAAD,EAAMC,CAAN;AAAA,uBAAYD,IAAIE,MAAJ,CAAWD,EAAEnB,IAAb,CAAZ;AAAA,aAApB,EAAoD,EAApD,CAAlB;;AAEA,gBAAIqB,QAAQC,GAAGC,GAAH,CAAOP,WAAP,EAAoBvB,KAAKY,cAAzB,CAAZ;AACA,gBAAImB,QAAQF,GAAGG,GAAH,CAAOT,WAAP,EAAoBvB,KAAKc,cAAzB,CAAZ;AACA;AACA,gBAAImB,YAAYF,MAAMG,OAAN,KAAkBN,MAAMM,OAAN,EAAlC;AACA,gBAAIC,aAAa,GAAjB,CAhCqC,CAgCd;AACvBP,oBAAQ,IAAIQ,IAAJ,CAASR,MAAMM,OAAN,KAAmBD,YAAYE,UAAxC,CAAR;AACAJ,oBAAQ,IAAIK,IAAJ,CAASL,MAAMG,OAAN,KAAmBD,YAAYE,UAAxC,CAAR;;AAEA,gBAAIE,oBAAoBR,GAAGS,MAAH,CAAU3C,OAAV,EACnB4C,MADmB,CACZ,KADY,EAEnBC,OAFmB,CAEX,gBAFW,EAEO,IAFP,CAAxB;AAGA,gBAAIC,2BAA2BJ,kBAAkBK,IAAlB,EAA/B;;AAEA,gBAAIC,eAAexC,QAAQyC,KAAR,IAAiBH,yBAAyBI,WAA1C,IAAyD,GAA5E;AACA,gBAAIC,gBAAgB3C,QAAQ4C,MAAR,IAAkBN,yBAAyBO,YAA3C,IAA2D,GAA/E;;AAEA,gBAAIC,SAAS;AACTC,qBAAK,EADI;AAETC,uBAAO,CAFE;AAGTC,wBAAQ,CAHC,EAGG;AACZC,sBAAM;AAJG,aAAb;;AAOA,gBAAIC,oBAAoB,MAAxB;;AAEA,gBAAIV,QAAQD,eAAeM,OAAOI,IAAtB,GAA6BJ,OAAOE,KAAhD;AACA,gBAAIJ,SAASD,gBAAgBG,OAAOC,GAAvB,GAA6BD,OAAOG,MAAjD;;AAEA;AACA,gBAAIG,aAAapD,QAAQoD,UAAR,IAAsB,GAAvC,CAzDqC,CAyDQ;;AAE7C;AACA,gBAAIC,cAAcT,SAASnD,aAAaG,MAAxC;AACA;AACA,gBAAI,CAAC,CAACI,QAAQqD,WAAd,EACA;AACIA,8BAAcrD,QAAQqD,WAAtB;AACAT,yBAASS,cAAc5D,aAAaG,MAApC;AACH;;AAED,gBAAI0D,qBAAqB5B,GAAG6B,SAAH,GACpBC,MADoB,CACb,CAAC/B,KAAD,EAAQG,KAAR,CADa,EAEpB6B,KAFoB,CAEd,CAACL,UAAD,EAAaX,KAAb,CAFc,CAAzB;AAGA,gBAAIiB,uBAAuBJ,kBAA3B;;AAEA;AACA,gBAAIK,QAAQjC,GAAGkC,OAAH,CAAWF,oBAAX;AACR;AADQ,aAEPG,QAFO,CAEEjB,MAFF,CAAZ,CA1EqC,CA4Ed;AACvB,gBAAIkB,cAAcH,KAAlB;;AAEA;AACA;AACA,gBAAII,OAAOrC,GAAGqC,IAAH,GACNC,EADM,CACH,MADG,EACKC,MADL,EAENC,WAFM,CAEM,CAAC,CAAD,EAAIC,QAAJ,CAFN,EAGNC,MAHM,CAGC,CAAC,CAAChB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACX,KAAD,EAAQG,MAAR,CAAjB,CAHD,EAINyB,eAJM,CAIU,CAAC,CAACjB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACX,KAAD,EAAQG,MAAR,CAAjB,CAJV,CAAX;;AAMA,gBAAI0B,MAAMzE,KAAK0E,UAAL,GAAkBrC,kBACvBE,MADuB,CAChB,KADgB,EAEvBoC,IAFuB,CAElB,OAFkB,EAET/B,QAAQK,OAAOI,IAAf,GAAsBJ,OAAOE,KAFpB,EAGvBwB,IAHuB,CAGlB,QAHkB,EAGR5B,SAASE,OAAOC,GAAhB,GAAsBD,OAAOG,MAHrB,CAA5B;;AAKA;AACA,gBAAIwB,QAAQH,IACPlC,MADO,CACA,GADA,EAEPoC,IAFO,CAEF,WAFE,EAEW,eAAe1B,OAAOI,IAAtB,GAA6B,GAA7B,GAAmCJ,OAAOC,GAA1C,GAAgD,GAF3D,CAAZ;AAGA0B,kBAAMC,IAAN,CAAWX,IAAX,EAhGqC,CAgGnB;;AAElB;AACA;AACA;AACA;AACA;;AAEA,qBAASY,MAAT,GAAkB;AACd,uBAAO,CAAC,CAAC,GAAD,IAAM,CAAC,GAAP,GAAW,CAAC,GAAZ,GAAgB,CAAC,GAAjB,GAAqB,CAAC,IAAvB,EAA6BC,OAA7B,CAAqC,QAArC,EAA+C;AAAA,2BAClD,CAACC,IAAIC,OAAOC,eAAP,CAAuB,IAAIC,UAAJ,CAAe,CAAf,CAAvB,EAA0C,CAA1C,IAA+C,MAAMH,IAAI,CAA9D,EAAiEI,QAAjE,CAA0E,EAA1E,CADkD;AAAA,iBAA/C,CAAP;AAGH;;AAED,gBAAIC,yBAAyB,6BAA2BP,QAAxD;AACA,gBAAIQ,eAAeV,MAAMrC,MAAN,CAAa,MAAb,EACdA,MADc,CACP,UADO,EAEdoC,IAFc,CAET,IAFS,EAEHU,sBAFG,EAGd9C,MAHc,CAGP,MAHO,EAIdoC,IAJc,CAIT,GAJS,EAIJpB,UAJI,EAKdoB,IALc,CAKT,GALS,EAKJ,CALI,EAMdA,IANc,CAMT,QANS,EAMC5B,MAND,EAOd4B,IAPc,CAOT,OAPS,EAOA/B,QAAQW,UAPR,CAAnB;;AASA;AACA,gBAAIgC,kBAAkBX,MAAMrC,MAAN,CAAa,MAAb,EACjBoC,IADiB,CACZ,OADY,EACH,cADG,EAEjBA,IAFiB,CAEZ,GAFY,EAEPpB,UAFO,EAGjBoB,IAHiB,CAGZ,GAHY,EAGP,CAHO,EAIjBA,IAJiB,CAIZ,QAJY,EAIF5B,MAJE,EAKjB4B,IALiB,CAKZ,OALY,EAKH/B,QAAQW,UALL,CAAtB;;AAOA;;AAEA,gBAAIpD,QAAQqF,eAAZ,EAA6B;AACzBxF,qBAAKyF,GAAL,GAAWb,MAAMrC,MAAN,CAAa,MAAb,EACNoC,IADM,CACD,WADC,YACoBU,sBADpB,QAENV,IAFM,CAED,OAFC,EAEQ,qBAFR,EAGNA,IAHM,CAGD,IAHC,EAGK,CAHL,EAINA,IAJM,CAID,IAJC,EAIK5B,MAJL,CAAX;AAKH;;AAED,gBAAI2C,mBAAmBd,MAAMe,SAAN,CAAgB,oBAAhB,EAClBpF,IADkB,CACbX,YADa,EAElBgG,KAFkB,GAGlBrD,MAHkB,CAGX,MAHW,EAIlBoC,IAJkB,CAIb,OAJa,EAIJ,mBAJI,EAKlBA,IALkB,CAKb,GALa,EAKR,CALQ,EAMlBA,IANkB,CAMb,GANa,EAMR,UAACkB,CAAD,EAAIzE,CAAJ,EAAU;AAAE,uBAAOoC,cAAcpC,CAArB;AAAyB,aAN7B,EAOlBuD,IAPkB,CAOb,OAPa,EAOJ/B,KAPI,EAQlB+B,IARkB,CAQb,QARa,EAQHnB,WARG,EASlBsC,KATkB,CASZ,MATY,EASJ,UAACD,CAAD,EAAIzE,CAAJ,EAAU;AACrB;AACA,oBAAI2E,QAAQC,KAAKC,GAAL,CAASD,KAAKE,KAAL,CAAW,CAACL,EAAEM,WAAF,IAAiBN,EAAEM,WAAF,GAAc,CAA/B,GAAmCN,EAAEM,WAArC,GAAmD/E,CAApD,IAAuD,EAAlE,IAAsE,CAAtE,GAAwE,CAAjF,CAAZ;AACA,uBAAOS,GAAGuE,gBAAH,CAAoBL,KAApB,CAAP;AACH,aAbkB,CAAvB;;AAeA;AACA,gBAAIM,iBAAiBzB,MAAMe,SAAN,CAAgB,iBAAhB,EAChBpF,IADgB,CACXX,YADW,EAEhBgG,KAFgB,GAGhBrD,MAHgB,CAGT,MAHS,EAIhBoC,IAJgB,CAIX,OAJW,EAIF,gBAJE,EAKhBA,IALgB,CAKX,IALW,EAKL,CALK,EAMhBA,IANgB,CAMX,IANW,EAML/B,KANK,EAOhB+B,IAPgB,CAOX,IAPW,EAOL,UAACkB,CAAD,EAAIzE,CAAJ,EAAU;AAClB,uBAAOoC,eAAepC,IAAI,CAAnB,CAAP;AACH,aATgB,EAUhBuD,IAVgB,CAUX,IAVW,EAUL,UAACkB,CAAD,EAAIzE,CAAJ,EAAU;AAClB,uBAAOoC,eAAepC,IAAI,CAAnB,CAAP;AACH,aAZgB,CAArB;;AAcA,gBAAIkF,qBAAqB1B,MAAMrC,MAAN,CAAa,MAAb,EACpBoC,IADoB,CACf,GADe,EACVpB,UADU,EAEpBoB,IAFoB,CAEf,GAFe,EAEV,CAFU,EAGpBA,IAHoB,CAGf,OAHe,EAGN/B,QAAQW,UAHF,EAIpBoB,IAJoB,CAIf,QAJe,EAIL5B,MAJK,EAKpB+C,KALoB,CAKd,MALc,EAKN,MALM,EAMpBA,KANoB,CAMd,cANc,EAME,KANF,CAAzB;;AAQA,gBAAIS,eAAe3B,MAAMrC,MAAN,CAAa,MAAb,EACdoC,IADc,CACT,GADS,EACJ,CADI,EAEdA,IAFc,CAET,GAFS,EAEJ,CAFI,EAGdA,IAHc,CAGT,OAHS,EAGA/B,KAHA,EAId+B,IAJc,CAIT,QAJS,EAIC5B,MAJD,EAKd+C,KALc,CAKR,QALQ,EAKE,MALF,CAAnB;;AAOA;AACA,gBAAIU,KAAK5B,MAAMrC,MAAN,CAAa,GAAb,EACJoC,IADI,CACC,OADD,EACU,QADV,EAEJA,IAFI,CAEC,WAFD,EAEc,iBAAiB5B,MAAjB,GAA0B,GAFxC,EAGJ8B,IAHI,CAGCf,KAHD,CAAT;;AAKA;AACA2C,wBAAYC,iBAAZ,EAA+B,IAA/B;;AAEA,qBAASA,iBAAT,GAA6B;AACzB,oBAAIC,WAAWlE,yBAAyBI,WAAzB,GAAuCI,OAAOI,IAA9C,GAAqDJ,OAAOE,KAA5D,GAAoE,CAAnF;;AAEA,oBAAIwD,WAAW,CAAX,IAAgBA,YAAY/D,KAAhC,EACA;AACIA,4BAAQ+D,QAAR;AACAlC,wBAAIE,IAAJ,CAAS,OAAT,EAAkB/B,KAAlB;AACAyD,mCAAe1B,IAAf,CAAoB,IAApB,EAA0B/B,KAA1B;AACA8C,qCAAiBf,IAAjB,CAAsB,OAAtB,EAA+B/B,KAA/B;AACA2D,iCAAa5B,IAAb,CAAkB,OAAlB,EAA2B/B,KAA3B;;AAEA,wBAAIgE,mBAAmBhE,QAAQW,UAA/B;AACA+C,uCAAmB3B,IAAnB,CAAwB,OAAxB,EAAiCiC,gBAAjC;AACAtB,iCAAaX,IAAb,CAAkB,OAAlB,EAA2BiC,gBAA3B;AACArB,oCAAgBZ,IAAhB,CAAqB,OAArB,EAA8BiC,gBAA9B;;AAEAnD,uCAAmBG,KAAnB,CAAyB,CAACL,UAAD,EAAaX,KAAb,CAAzB;AACAiB,yCAAqBD,KAArB,CAA2B,CAACL,UAAD,EAAaX,KAAb,CAA3B;AACAqB,kCAAcH,MAAM+C,KAAN,CAAYhD,oBAAZ,CAAd;AACAK,yBACKK,MADL,CACY,CAAC,CAAChB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACX,KAAD,EAAQG,MAAR,CAAjB,CADZ,EAEKyB,eAFL,CAEqB,CAAC,CAACjB,UAAD,EAAY,CAAZ,CAAD,EAAiB,CAACX,KAAD,EAAQG,MAAR,CAAjB,CAFrB;AAGAqB;AACA0C,4BAAQC,GAAR,CAAY,mCAAZ,EAAiDnE,KAAjD,EAAwD,yBAAxD,EAAmFgE,gBAAnF;AACH;AACJ;;AAED;AACA,gBAAIzG,QAAQoD,UAAR,GAAqB,CAAzB,EAA4B;AACxB,oBAAIyD,cAAcpC,MAAMe,SAAN,CAAgB,eAAhB,EACbpF,IADa,CACRX,YADQ,EAEbgG,KAFa,GAGbrD,MAHa,CAGN,MAHM,EAIboC,IAJa,CAIR,OAJQ,EAIC,cAJD,EAKbA,IALa,CAKR,GALQ,EAKH,OALG,EAKM;AALN,iBAMbA,IANa,CAMR,GANQ,EAMH,UAACkB,CAAD,EAAIzE,CAAJ,EAAU;AACjB,2BAAQoC,cAAcpC,CAAf,GAAqBoC,cAAc,CAA1C,CADiB,CAC8B;AAClD,iBARa,EASbmB,IATa,CASR,IATQ,EASF,OATE,EAUbA,IAVa,CAUR,IAVQ,EAUF,MAVE,EAUO;AAVP,iBAWbsC,IAXa,CAWR;AAAA,2BAAKpB,EAAEqB,KAAP;AAAA,iBAXQ,EAYbrC,IAZa,CAYRsC,IAZQ,EAYF5D,UAZE,CAAlB;;AAcA,oBAAI6D,cAAcxC,MAAMrC,MAAN,CAAa,MAAb,EAAqBoC,IAArB,CAA0B,IAA1B,EAAgCpB,UAAhC,EAA4CoB,IAA5C,CAAiD,IAAjD,EAAuDpB,UAAvD,EAAmEoB,IAAnE,CAAwE,IAAxE,EAA8E,CAA9E,EAAiFA,IAAjF,CAAsF,IAAtF,EAA4F5B,MAA5F,EAAoG4B,IAApG,CAAyG,QAAzG,EAAmH,QAAnH,CAAlB;AACH;;AAED,gBAAI0C,qBAAqBzC,MAAMe,SAAN,CAAgB,uBAAhB,EACpBpF,IADoB,CACfX,YADe,EAEpBgG,KAFoB,GAGpBrD,MAHoB,CAGb,GAHa,EAIpBoC,IAJoB,CAIf,WAJe,YAIMU,sBAJN,QAKpBV,IALoB,CAKf,OALe,EAKN,MALM,EAMpBA,IANoB,CAMf,WANe,EAMF,UAACkB,CAAD,EAAIzE,CAAJ;AAAA,yCAA0BoC,cAAcpC,CAAxC;AAAA,aANE,EAOpBuE,SAPoB,CAOV,MAPU,EAQpBpF,IARoB,CAQf;AAAA,uBAAKsF,EAAEtF,IAAF,CAAO+G,MAAP,CAAc;AAAA,2BAAKC,EAAEC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBC,QAAnC;AAAA,iBAAd,CAAL;AAAA,aARe,EASpB9B,KAToB,EAAzB;;AAWA,gBAAI+B,oBAAoB,MAAMnE,WAA9B;AACA,gBAAIoE,oBAAoB,CAACpE,cAAcmE,iBAAf,IAAoC,CAA5D;AACA,gBAAIE,YAAYR,mBACX9E,MADW,CACJ,MADI,EAEXoC,IAFW,CAEN,OAFM,EAEGmD,MAAMC,UAAN,EAAkB,UAAlB,CAFH,EAGXpD,IAHW,CAGN,OAHM,EAGG,UAACkB,CAAD;AAAA,uBAAOG,KAAKhE,GAAL,CAAS7B,QAAQ6H,gBAAjB,EAAmCnE,qBAAqBgC,EAAEhF,EAAvB,IAA6BgD,qBAAqBgC,EAAElF,IAAvB,CAAhE,CAAP;AAAA,aAHH,EAIXgE,IAJW,CAIN,QAJM,EAIIgD,iBAJJ,EAKXhD,IALW,CAKN,GALM,EAKDiD,iBALC,EAMXjD,IANW,CAMN,GANM,EAMD,UAACkB,CAAD;AAAA,uBAAOhC,qBAAqBgC,EAAElF,IAAvB,CAAP;AAAA,aANC,EAOXwD,EAPW,CAOR,OAPQ,EAOC,UAAC0B,CAAD,EAAO;AAAE,iBAACA,EAAEoC,OAAH,IAAcpC,EAAEoC,OAAF,CAAUpC,CAAV,CAAd;AAA6B,aAPvC,CAAhB;;AASA;AACA,gBAAIqC,gBAAgBb,mBACf9E,MADe,CACR,MADQ,EAEf0E,IAFe,CAEV;AAAA,uBAAKpB,EAAEqB,KAAF,IAAW,EAAhB;AAAA,aAFU,EAEW;AAFX,aAGfvC,IAHe,CAGV,OAHU,EAGDmD,MAAMC,UAAN,EAAkB,eAAlB,CAHC,EAIfpD,IAJe,CAIV,GAJU,EAIJnB,cAAc,CAAf,GAAoB,CAJf,EAKfmB,IALe,CAKV,GALU,EAKL,UAACkB,CAAD;AAAA,uBAAOhC,qBAAqBgC,EAAElF,IAAvB,CAAP;AAAA,aALK,CAApB;;AAOA,gBAAIwH,gBAAgBvD,MAAMe,SAAN,CAAgB,kBAAhB,EACfpF,IADe,CACVX,YADU,EAEfgG,KAFe,GAGfrD,MAHe,CAGR,GAHQ,EAIfoC,IAJe,CAIV,WAJU,YAIWU,sBAJX,QAKfV,IALe,CAKV,OALU,EAKD,MALC,EAMfA,IANe,CAMV,WANU,EAMG,UAACkB,CAAD,EAAIzE,CAAJ;AAAA,yCAA0BoC,cAAcpC,CAAxC;AAAA,aANH,EAOfuE,SAPe,CAOL,MAPK,EAQfpF,IARe,CAQV,aAAK;AACP,uBAAOsF,EAAEtF,IAAF,CAAO+G,MAAP,CAAc;AAAA,2BAAKC,EAAEC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBW,KAAnC;AAAA,iBAAd,CAAP;AACH,aAVe,EAWfxC,KAXe,EAApB;;AAaA,gBAAIyC,OAAOF,cACN5F,MADM,CACC,QADD,EAENoC,IAFM,CAED,OAFC,EAEQmD,MAAMC,UAAN,EAAkB,KAAlB,CAFR,EAGNpD,IAHM,CAGD,IAHC,EAGK;AAAA,uBAAKd,qBAAqBgC,EAAEpF,EAAvB,CAAL;AAAA,aAHL,EAINkE,IAJM,CAID,IAJC,EAIKnB,cAAc,CAJnB,EAKNmB,IALM,CAKD,GALC,EAKI,CALJ,EAMNR,EANM,CAMH,OANG,EAMM,UAAC0B,CAAD,EAAO;AAAE,iBAACA,EAAEoC,OAAH,IAAcpC,EAAEoC,OAAF,CAAUpC,CAAV,CAAd;AAA6B,aAN5C,CAAX;;AAQA;AACA,gBAAIyC,OAAOC,MAAP,IAAiBD,OAAOE,OAAxB,IAAmCrI,QAAQsI,mBAA/C,EAAoE;AAChE,oBAAIC,MAAM,YAAW;AACjB;AACA;AACA,wBAAIC,YAAYC,SAASC,aAAT,CAAuB,KAAvB,CAAhB;AACAD,6BAASE,IAAT,CAAcC,WAAd,CAA0BJ,SAA1B;;AAEA;AACA;AACA,wBAAIK,gBAAgBnH,GAAGS,MAAH,CAAUsG,SAASC,aAAT,CAAuB,KAAvB,CAAV,CAApB;AACAG,kCACKlD,KADL,CACW,UADX,EACuB,UADvB,EACmCA,KADnC,CACyC,KADzC,EACgD,CADhD,EAEKA,KAFL,CAEW,SAFX,EAEsB,CAFtB,EAGKA,KAHL,CAGW,gBAHX,EAG6B,MAH7B,EAGqCA,KAHrC,CAG2C,YAH3C,EAGyD,YAHzD;AAIA6C,8BAAUI,WAAV,CAAsBC,cAActG,IAAd,EAAtB;;AAEA,6BAASuG,MAAT,GAAkB;AACdnC,gCAAQC,GAAR,CAAY,gBAAZ;AACH;;AAED,wBAAImC,WAAW,IAAf;AACA,6BAASC,UAAT,GAAsB;AAClB,4BAAIb,OAAOC,MAAP,IAAiBD,OAAOE,OAAxB,IAAmCU,YAAY,IAAnD,EACA;AACIA,uCAAW,IAAIV,OAAJ,CAAYQ,cAActG,IAAd,EAAZ,EAAkC;AACzC0G,2CAAW,KAD8B;AAEzCC,uCAAO,eAFkC;AAGzCC,sCAAM,IAHmC;AAIzCC,+CAAe;AACXC,8CAAU,kBAASC,CAAT,EAAY;AAAEA,0CAAEC,QAAF,CAAWC,MAAX,CAAkB1J,SAAlB,CAA4BC,GAA5B,CAAgC,MAAhC;AAA0C,qCADvD;AAEX0J,+CAAW;AACPC,8CAAM;AACFC,sDAAU,CAAC,KAAD,EAAQ,QAAR,EAAkB,MAAlB,EAA0B,OAA1B;AADR;AADC;AAFA;AAJ0B,6BAAlC,CAAX;AAaA;AACAZ,qCAASa,IAAT;AACAb,qCAASc,IAAT;AACAnI,+BAAGS,MAAH,CAAU4G,SAASe,YAAnB,EAAiC9F,EAAjC,CAAoC,YAApC,EAAkD8E,OAAOiB,YAAzD;AACArI,+BAAGS,MAAH,CAAU4G,SAASe,YAAnB,EAAiC9F,EAAjC,CAAoC,YAApC,EAAkD8E,OAAOkB,YAAzD;AACH;AACD,+BAAOjB,QAAP;AACH;;AAED,wBAAIT,mBAAJ;;AAEAQ,2BAAOK,IAAP,GAAc,UAASc,GAAT,EAAc;AACxB3B,8CAAsB2B,GAAtB;AACH,qBAFD;;AAIA,wBAAIC,eAAe,KAAnB;AACA,wBAAIC,2BAA2B,IAA/B;AACA,wBAAIC,gBAAgB,IAApB;;AAEAtB,2BAAOiB,YAAP,GAAsB,YAAW;AAC7BjB,+BAAOuB,UAAP;AACH,qBAFD;;AAIAvB,2BAAOkB,YAAP,GAAsB,YAAW;AAC7BlB,+BAAOwB,aAAP;AACH,qBAFD;;AAIA;AACAxB,2BAAOuB,UAAP,GAAoB,YAAW;AAC3B,4BAAI,CAACF,wBAAL,EAA+B;;AAE/BI,qCAAaJ,wBAAb;AACAA,mDAA2B,IAA3B;AACH,qBALD;;AAOArB,2BAAO0B,OAAP,GAAiB,YAAW;AACxB,4BAAI,CAACN,YAAL,EAAmB;;AAEnB;AACApB,+BAAOuB,UAAP;;AAEAF,mDAA2B,IAA3B;AACAnB,qCAAaa,IAAb;AACAK,uCAAe,KAAf;AACAE,wCAAgB,IAAhB;AACH,qBAVD;;AAYAtB,2BAAOwB,aAAP,GAAuB,YAAW;AAC9BH,mDAA2BM,WAAW,YAAM;AACxC3B,mCAAO0B,OAAP;AACH,yBAF0B,EAExB,GAFwB,CAA3B;AAGH,qBAJD;;AAMA1B,2BAAOc,IAAP,GAAc,UAASlE,CAAT,EAAY;AACtB,4BAAIwE,gBAAgB,QAAQE,aAA5B,EACItB,OAAOuB,UAAP,GADJ,KAGIvB,OAAO0B,OAAP;;AAEJ;AACA,4BAAIE,OAAO,KAAKC,qBAAL,EAAX,CAPsB,CAOoB;AAC1C,4BAAIC,WAAWxF,gBAAgB7C,IAAhB,GAAuBoI,qBAAvB,EAAf,CARsB,CAQ0C;;AAEhE,4BAAI5H,MAAM2H,KAAK3H,GAAL,GAAWoF,OAAO0C,OAA5B;AACA,4BAAI3H,OAAO2C,KAAKhE,GAAL,CAAS6I,KAAKxH,IAAd,EAAmB0H,SAAS1H,IAA5B,IAAoCiF,OAAO2C,OAAtD;AACA,4BAAI9H,QAAQ6C,KAAKlE,GAAL,CAAS+I,KAAK1H,KAAd,EAAoB4H,SAAS5H,KAA7B,IAAsCmF,OAAO2C,OAAzD;AACA,4BAAI7H,SAASyH,KAAKzH,MAAL,GAAckF,OAAO0C,OAAlC;AACA,4BAAIjI,SAASiD,KAAKlE,GAAL,CAASsB,SAAOF,GAAhB,EAAqB2H,KAAK9H,MAA1B,CAAb;AACA,4BAAIH,QAAQoD,KAAKlE,GAAL,CAASqB,QAAME,IAAf,EAAqBwH,KAAKjI,KAA1B,CAAZ;;AAEAoG,sCACKlD,KADL,CACW,KADX,EACkB5C,MAAI,IADtB,EAEK4C,KAFL,CAEW,MAFX,EAEmBzC,OAAK,IAFxB,EAGKyC,KAHL,CAGW,QAHX,EAGqB/C,SAAO,IAH5B,EAIK+C,KAJL,CAIW,OAJX,EAIoBlD,QAAM,IAJ1B;AAKA;AACA,4BAAI0G,OAAOb,oBAAoB5C,CAApB,CAAX;AACA,4BAAIqF,KAAK/B,YAAT;AACA+B,2BAAGC,kBAAH,CAAsB7B,IAAtB;AACA;AACA4B,2BAAGnB,IAAH;AACAM,uCAAe,IAAf;AACAE,wCAAgB,IAAhB;AACH,qBA9BD;;AAgCA,2BAAOtB,MAAP;AACH,iBA1HS,EAAV;;AA6HA;AACAP,oBAAIY,IAAJ,CAASnJ,QAAQsI,mBAAjB;AACAJ,qBAAKlE,EAAL,CAAQ,WAAR,EAAqBuE,IAAIqB,IAAzB,EAA+B5F,EAA/B,CAAkC,UAAlC,EAA8CuE,IAAI+B,aAAlD;AACA5C,0BAAU1D,EAAV,CAAa,WAAb,EAA0BuE,IAAIqB,IAA9B,EAAoC5F,EAApC,CAAuC,UAAvC,EAAmDuE,IAAI+B,aAAvD;AACH;;AAEDrG;;AAEA,gBAAIjE,QAAQqF,eAAZ,EAA6B;AACzBiB,4BAAY2E,eAAZ,EAA6BjL,QAAQkL,iBAArC;AACH;;AAGD,qBAASlE,IAAT,CAAcF,IAAd,EAAoBrE,KAApB,EAA2B0I,cAA3B,EACA;AACIrE,qBAAKsE,IAAL,CAAU,YAAW;AACjB,wBAAItE,OAAOpF,GAAGS,MAAH,CAAU,IAAV,CAAX;AAAA,wBACAkJ,QAAQvE,KAAKA,IAAL,GAAYwE,KAAZ,CAAkB,KAAlB,EAAyBC,OAAzB,EADR;AAAA,wBAEAC,IAFA;AAAA,wBAGAC,OAAO,EAHP;AAAA,wBAIAC,aAAa,CAJb;AAAA,wBAKAC,aAAa,GALb;AAAA,wBAKkB;AAClBC,wBAAI9E,KAAKtC,IAAL,CAAU,GAAV,CANJ;AAAA,wBAOAqH,KAAKC,WAAWhF,KAAKtC,IAAL,CAAU,IAAV,CAAX,CAPL;AAAA,wBAQAuH,KAAKD,WAAWhF,KAAKtC,IAAL,CAAU,IAAV,CAAX,CARL;AASA;AACA,wBAAIwH,QAAQlF,KAAKA,IAAL,CAAU,IAAV,EAAgB1E,MAAhB,CAAuB,OAAvB,EAAgCoC,IAAhC,CAAqC,GAArC,EAA0C,CAA1C,EAA6CA,IAA7C,CAAkD,GAAlD,EAAuDoH,CAAvD,EAA0DpH,IAA1D,CAA+D,IAA/D,EAAqEqH,KAAK,IAA1E,EAAgFrH,IAAhF,CAAqF,IAArF,EAA2FuH,KAAK,IAAhG,CAAZ;AACA,2BAAOP,OAAOH,MAAMY,GAAN,EAAd,EACA;AACIR,6BAAKS,IAAL,CAAUV,IAAV;AACAQ,8BAAMlF,IAAN,CAAW2E,KAAKU,IAAL,CAAU,GAAV,CAAX;AACA;AACA,4BAAIH,MAAMzJ,IAAN,GAAa6J,qBAAb,KAAuC3J,KAA3C,EACA;AACIgJ,iCAAKQ,GAAL;AACAD,kCAAMlF,IAAN,CAAW2E,KAAKU,IAAL,CAAU,GAAV,CAAX;AACAV,mCAAO,CAACD,IAAD,CAAP;AACA;AACAQ,oCAAQlF,KAAK1E,MAAL,CAAY,OAAZ,EACHoC,IADG,CACE,GADF,EACO,CADP;AAEJ;AAFI,6BAGHA,IAHG,CAGE,IAHF,EAGQqH,KAAK,IAHb,EAIHrH,IAJG,CAIE,IAJF,EAIQmH,aAAa,IAJrB,EAI4B;AAJ5B,6BAKH7E,IALG,CAKE0E,IALF,CAAR;AAMA,gCAAIa,aAAavF,KAAK3E,MAAL,CAAY,OAAZ,CAAjB;AACA4J,iCAAKD,WAAWO,WAAW7H,IAAX,CAAgB,IAAhB,CAAX,CAAL;AACA6H,uCAAW7H,IAAX,CAAgB,IAAhB,EAAsBuH,KAAIJ,aAAW,EAAf,GAAmB,IAAzC;AACH;AACJ;AACJ,iBAlCD;AAmCH;;AAED,qBAASV,eAAT,GAA2B;AACvB,oBAAIqB,OAAO5I,qBAAqB,IAAIzB,IAAJ,EAArB,CAAX;;AAEApC,qBAAKyF,GAAL,CAASd,IAAT,CAAc,IAAd,EAAoB8H,IAApB,EAA0B9H,IAA1B,CAA+B,IAA/B,EAAqC8H,IAArC;AACH;;AAED,qBAAS3E,KAAT,CAAe4E,EAAf,EAAmB;AACf,oBAAIC,OAAOC,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBjI,IAAtB,CAA2BkI,SAA3B,EAAsC,CAAtC,CAAX,CADe,CACuC;AACtD,uBAAO,YAAW;AACd,2BAAOL,GAAGM,KAAH,CAAS,IAAT,EAAeL,KAAKhL,MAAL,CAAYiL,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBjI,IAAtB,CAA2BkI,SAA3B,EAAsC,CAAtC,CAAZ,CAAf,CAAP;AACH,iBAFD;AAGH;;AAED;AACA,qBAAShF,UAAT,CAAoBkF,YAApB,EAAkC1M,IAAlC,EAAwC;AACpC;AACA,oBAAI2M,UAAU,CAAED,YAAF,CAAd;AACA,oBAAI,CAAC,CAAC1M,KAAK4M,WAAX,EAAwBD,QAAQb,IAAR,CAAa9L,KAAK4M,WAAlB;AACxB,oBAAIC,YAAY,CAAC7M,KAAK8M,GAAL,IAAY,EAAb,EAAiBC,GAAjB,CAAqB;AAAA,2BAAMhK,oBAAkBiK,EAAxB;AAAA,iBAArB,CAAhB;AACA,uBAAOL,QAAQvL,MAAR,CAAeyL,SAAf,EAA0Bd,IAA1B,CAA+B,GAA/B,CAAP;AACH;;AAED,qBAASlI,MAAT,GAAkB;AACd,oBAAIpE,KAAKwN,aAAL,IAAsB3L,GAAG4L,KAA7B,EAAoC;AAChCzN,yBAAKwN,aAAL,CAAmB3I,IAAnB,CAAwB7E,IAAxB,EAA8B;AAC1B6G,+BAAOhF,GAAG4L,KAAH,CAAS5G,KADU;AAE1B6G,mCAAW7L,GAAG4L,KAAH,CAASC,SAFM;AAG1B/J,gCAAQE,qBAAqBF,MAArB;AAHkB,qBAA9B;AAKH;;AAED,oBAAIxD,QAAQqF,eAAZ,EAA6B;AACzB4F;AACH;;AAED,oBAAIuC,cAAc,CAAEzJ,IAAF,CAAlB,CAbc,CAae;;AAE7B,oBAAIrC,GAAG4L,KAAH,IAAY5L,GAAG4L,KAAH,CAASG,SAAzB,EAAoC;AACpC;AACI;AACA/J,2CAAuBhC,GAAG4L,KAAH,CAASG,SAAT,CAAmBC,QAAnB,CAA4BpK,kBAA5B,CAAvB;AACH,iBAJD,MAKKqD,QAAQC,GAAR,CAAY,6BAAZ;;AAEL;AACA9C,8BAAcH,MAAM+C,KAAN,CAAYhD,oBAAZ,CAAd;;AAEA;AACA2C,mBAAG3B,IAAH,CAAQZ,WAAR;AACA;AACAW,sBAAMe,SAAN,CAAgB,YAAhB,EAA8BhB,IAA9B,CAAmC,IAAnC,EAAyC;AAAA,2BAAKd,qBAAqBgC,EAAEpF,EAAvB,CAAL;AAAA,iBAAzC;AACAmE,sBAAMe,SAAN,CAAgB,eAAhB,EAAiChB,IAAjC,CAAsC,GAAtC,EAA2C;AAAA,2BAAKd,qBAAqBgC,EAAElF,IAAvB,CAAL;AAAA,iBAA3C,EAA8EgE,IAA9E,CAAmF,OAAnF,EAA4F;AAAA,2BAAKqB,KAAKhE,GAAL,CAAS7B,QAAQ6H,gBAAjB,EAAmCnE,qBAAqBgC,EAAEhF,EAAvB,IAA6BgD,qBAAqBgC,EAAElF,IAAvB,CAAhE,CAAL;AAAA,iBAA5F;AACAiE,sBAAMe,SAAN,CAAgB,gBAAhB,EAAkChB,IAAlC,CAAuC,GAAvC,EAA4C,UAASkB,CAAT,EAAY;AAChD,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAKiI,aAAaE,YAAb,GAA4BzK,UAA5B,GAAyC,EAA1C,GAAgDuK,aAAaG,SAAjE,EAA4E;AACxE,+BAAOH,aAAaE,YAApB;AACH,qBAFD,MAEO,IAAIF,aAAaI,SAAb,GAAyB3K,UAAzB,IAAuCuK,aAAaE,YAAb,GAA4BzK,UAAvE,EAAmF;AACtF,+BAAOA,UAAP;AACH;AACD,2BAAOuK,aAAaI,SAApB;AACH,iBARL,EAQOvJ,IARP,CAQY,aARZ,EAQ2B,UAASkB,CAAT,EAAY;AAC/B,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAKiI,aAAaE,YAAb,GAA4BzK,UAA5B,GAAyC,EAA1C,GAAgDuK,aAAaG,SAAjE,EAA4E;AACxE,+BAAO,KAAP;AACH;AACD,2BAAO,OAAP;AACH,iBAdL,EAeKtJ,IAfL,CAeU,IAfV,EAegB,UAASkB,CAAT,EAAY;AACpB,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAKiI,aAAaE,YAAb,GAA4BzK,UAA5B,GAAyC,EAA1C,GAAgDuK,aAAaG,SAAjE,EAA4E;AACxE,+BAAO,QAAP;AACH;AACD,2BAAO,OAAP;AACH,iBArBL,EAqBOhH,IArBP,CAqBY,UAASpB,CAAT,EAAY;AAChB,wBAAIiI,eAAeC,oBAAoBlJ,IAApB,CAAyB,IAAzB,EAA+BgB,CAA/B,CAAnB;AACA,wBAAIsI,UAAU,CAACL,aAAalL,KAAb,GAAqBzC,QAAQiO,qBAA9B,IAAuDN,aAAaG,SAAlF;AACA,wBAAII,YAAYxI,EAAEqB,KAAF,IAAW,EAA3B,CAHgB,CAGe;AAC/B,wBAAIiH,UAAU,CAAd,EAAiB;AACb,4BAAIL,aAAalL,KAAb,GAAqBzC,QAAQiO,qBAAjC,EAAwD;AACpD,mCAAOC,UAAUC,MAAV,CAAiB,CAAjB,EAAoBtI,KAAKE,KAAL,CAAWmI,UAAUtO,MAAV,GAAmBoO,OAA9B,CAApB,IAA8D,KAArE;AACH,yBAFD,MAEO;AACH,mCAAO,EAAP;AACH;AACJ;;AAED,2BAAOE,SAAP;AACH,iBAlCL;;AAoCA,yBAASN,mBAAT,CAA6BlI,CAA7B,EAAgC;AAC5B,yBAAK0I,YAAL,GAAoB,KAAKA,YAAL,IAAqB,KAAKhC,qBAAL,EAAzC;AACA,wBAAI5L,OAAOkD,qBAAqBgC,EAAElF,IAAvB,CAAX;AACA,wBAAIE,KAAKgD,qBAAqBgC,EAAEhF,EAAvB,CAAT;AACA,2BAAO;AACHqN,mCAAWvN,IADR;AAEHqN,sCAAcnN,EAFX;AAGH+B,+BAAO/B,KAAKF,IAHT;AAIHsN,mCAAW,KAAKM;AAJb,qBAAP;AAMH;AACJ;;AAED,gBAAI3N,iBAAiBZ,KAAKY,cAAL,GAAsB,UAAS4N,eAAT,EAA0B;AACjE,oBAAI/E,IAAI+E,eAAR;AACA,uBAAO/E,EAAEjC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEhJ,EAAxC,GAA6CgJ,EAAE9I,IAAtD;AACH,aAHD;AAIA,gBAAIG,iBAAiBd,KAAKc,cAAL,GAAsB,UAAS0N,eAAT,EAA0B;AACjE,oBAAI/E,IAAI+E,eAAR;AACA,uBAAO/E,EAAEjC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEhJ,EAAxC,GAA6CgJ,EAAE5I,EAAtD;AACH,aAHD;;AAKA;AACA,gBAAI4N,qBAAqB,IAAzB;AACAzO,iBAAKyO,kBAAL,GAA0B,UAASC,KAAT,EAAgB;AACtC,oBAAIA,UAAUC,SAAd,EACI,OAAOF,kBAAP;AACJA,qCAAqB,CAAC,CAACC,KAAvB;AACH,aAJD;;AAMA1O,iBAAK4O,OAAL,GAAe,YAAW;AAAExK;AAAW,aAAvC;;AAEApE,iBAAK6O,cAAL,GAAsB,UAASC,OAAT,EAAkB;AACpC,oBAAIA,YAAYH,SAAZ,GAAwBF,kBAAxB,GAA6CK,OAAjD,EACIlK,MAAMmK,UAAN,GAAmBC,QAAnB,CAA4B,GAA5B,EAAiCnK,IAAjC,CAAsCX,KAAK0J,SAA3C,EAAsD/L,GAAGoN,YAAzD,EADJ,KAGIrK,MAAMC,IAAN,CAAWX,KAAK0J,SAAhB,EAA2B/L,GAAGoN,YAA9B;AACP,aALD;;AAOA;AACA,qBAASC,qBAAT,CAA+BC,CAA/B,EAAkCL,OAAlC,EAA2C;AACvC,oBAAIA,YAAYH,SAAZ,GAAwBF,kBAAxB,GAA6CK,OAAjD,EACIlK,MAAMmK,UAAN,GAAmBC,QAAnB,CAA4B,GAA5B,EAAiCnK,IAAjC,CAAsCX,KAAKkL,WAA3C,EAAwDD,CAAxD,EAA2D,CAA3D,EADJ,KAGIvK,MAAMC,IAAN,CAAWX,KAAKkL,WAAhB,EAA6BD,CAA7B,EAAgC,CAAhC;AACP;AACD;;AAEA;AACA,qBAASE,YAAT,CAAsBC,CAAtB,EAAyBR,OAAzB,EAAkC;AAC9B,oBAAIA,YAAYH,SAAZ,GAAwBF,kBAAxB,GAA6CK,OAAjD,EACIlK,MAAMmK,UAAN,GAAmBC,QAAnB,CAA4B,GAA5B,EAAiCnK,IAAjC,CAAsCX,KAAKqL,OAA3C,EAAoDD,CAApD,EADJ,KAGI1K,MAAMC,IAAN,CAAWX,KAAKqL,OAAhB,EAAyBD,CAAzB;AACP;;AAED;AACA,qBAASE,kBAAT,CAA4BC,oBAA5B,EAAkD;AAC9C,oBAAI7L,QAAQC,qBAAqBD,KAArB,EAAZ;AACA,oBAAI8L,QAAQ9L,MAAM,CAAN,IAAWA,MAAM,CAAN,CAAvB;AACA,oBAAIuL,IAAIO,QAAQD,oBAAR,GAA+B7L,MAAM,CAAN,CAAvC;AACAsL,sCAAsBC,CAAtB;AACH;AACDnP,iBAAKwP,kBAAL,GAA0BA,kBAA1B;;AAEA,qBAASG,eAAT,CAAyBC,IAAzB,EAA+Bd,OAA/B,EAAwC;AACpC,oBAAIe,aAAapM,mBAAmBmM,IAAnB,CAAjB;AACAV,sCAAsBW,UAAtB,EAAkCf,OAAlC;AACH;AACD9O,iBAAK2P,eAAL,GAAuBA,eAAvB;;AAEA;AACA;AACA;AACA3P,iBAAK8P,kBAAL,GAA0B,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,qBAApC,EAA2D;AACjF,oBAAItC,cAAc,CAACzJ,IAAD,EAAOL,oBAAP,CAAlB,CADiF,CAChC;AACjD,oBAAIqM,UAAU,OAAOH,WAAP,KAAwB,QAAxB,GAAoC,CAACA,WAAD,CAApC,GAAoDA,WAAlE;AACA,oBAAIG,QAAQpQ,WAAR,KAAwB,GAAGA,WAA/B,EAA4C,OAAO,EAAES,MAAM,EAAR,EAAP;;AAE5C;AACAsB,mBAAG8D,SAAH,CAAa,MAAIsK,qBAAjB,EAAwCzN,OAAxC,CAAgDyN,qBAAhD,EAAuE,KAAvE;;AAEA,oBAAIE,WAAWD,QAAQ5C,GAAR,CAAY;AAAA,2BAAM,MAAIhK,iBAAJ,GAAsBiK,EAA5B;AAAA,iBAAZ,EAA4CjB,IAA5C,CAAiD,GAAjD,CAAf;;AAEA;AACA,oBAAI,CAAC6D,QAAL,EAAe,OAAO,EAAE5P,MAAM,EAAR,EAAP;;AAEf,oBAAI6P,MAAMvO,GAAG8D,SAAH,CAAawK,QAAb,CAAV;;AAEA;AACA,oBAAIC,IAAIC,KAAJ,GAAYtQ,MAAZ,IAAsB,CAA1B,EAA6B,OAAO,EAAEQ,MAAM,EAAR,EAAP;;AAE7B;AACA6P,oBAAI5N,OAAJ,CAAYyN,qBAAZ,EAAmC,IAAnC;;AAEA,oBAAIK,QAAQF,IAAI7P,IAAJ,EAAZ;AACA,oBAAIgQ,YAAYD,MAAME,IAAN,CAAW;AAAA,2BAAQhQ,KAAKgH,IAAL,IAAa9H,cAAc+H,IAAd,CAAmBW,KAAxC;AAAA,iBAAX,KAA6DkI,MAAM,CAAN,CAA7E;AACA;AACA,oBAAI,CAAC,CAACN,YAAN,EAAoB;AAChB;AACA;AACA;AACA,wBAAIS,WAAWzQ,KAAKU,cAAL,CAAoB6P,SAApB,CAAf;AACA,wBAAIV,aAAapM,mBAAmBgN,QAAnB,CAAjB;AACA,wBAAIC,mBAAmB7O,GAAG8O,aAAH,CAAiB/L,MAAMlC,IAAN,EAAjB,CAAvB;;AAEA;AACA;AACA;AACA;AACA;;AAEA,wBAAIkO,eAAe5Q,KAAK6Q,kBAAL,CAAwBN,SAAxB,CAAnB;AACA,wBAAIK,aAAaE,OAAb,IAAwB,IAA5B,EAAkC;AAC9B,4BAAIC,YAAYlN,qBAAqB4M,QAArB,CAAhB;AACA,4BAAIO,mBAAmBnN,qBAAqB+M,aAAaE,OAAb,CAAqBG,IAA1C,CAAvB;AACA,4BAAIC,gBAAgBlL,KAAKC,GAAL,CAAS8K,YAAYC,gBAArB,CAApB;AACA,4BAAIG,OAAQ,KAAKD,aAAN,GAAuBR,iBAAiBpB,CAAnD;AACA;AACA,4BAAI6B,OAAOT,iBAAiBpB,CAA5B,EAA+B;AAC3B;AACA;AACA;AACA;AACAD,yCAAa8B,IAAb,EAAmB,KAAnB;AACH;AACJ;;AAED;AACAxB,oCAAgBc,QAAhB,EAA0B,KAA1B;AACH;;AAED,uBAAO;AACHlQ,0BAAM+P;AADH,iBAAP;AAGH,aA7DD;;AA+DAtQ,iBAAKuP,OAAL,GAAe,UAASD,CAAT,EAAY;AACvB1K,sBAAMC,IAAN,CAAWX,KAAKqL,OAAhB,EAAyBD,CAAzB;AACH,aAFD;;AAIAxI,oBAAQC,GAAR,CAAY,6CAAZ,EAA2DnH,YAA3D;AACAkH,oBAAQC,GAAR,CAAY,2BAAZ,EAAyCxF,WAAzC;AACH;;;;4CACuB;AAAA,oBAAV6P,GAAU,uEAAJ,EAAI;;AACpB,oBAAIC,iBAAiB;AACjBrJ,sCAAkB,CADD,EACI;AACrBS,yCAAqBkG,SAFJ;AAGjBP,2CAAuB,EAHN;AAIjB5I,qCAAiB,KAJA;AAKjB6F,uCAAmB,IALF;AAMjB7H,iCAAa,EANI,EAMA;AACjBD,gCAAY,GAPK,CAOD;AAPC,iBAArB;AASA+N,uBAAOC,IAAP,CAAYH,GAAZ,EAAiB9D,GAAjB,CAAqB;AAAA,2BAAK+D,eAAe/B,CAAf,IAAoB8B,IAAI9B,CAAJ,CAAzB;AAAA,iBAArB;AACA,uBAAO+B,cAAP;AACH;;;2CACc5H,C,EAAG;AACd,uBAAOA,EAAEjC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEhJ,EAAxC,GAA6CgJ,EAAE9I,IAAtD;AACH;;;2CACc8I,C,EAAG;AACd,uBAAOA,EAAEjC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEhJ,EAAxC,GAA6CgJ,EAAE5I,EAAtD;AACH;;;2CACc4I,C,EAAG;AACd,uBAAOA,EAAEjC,IAAF,KAAW9H,cAAc+H,IAAd,CAAmBW,KAA9B,GAAsCqB,EAAEhJ,EAAxC,GAA6C,IAAI2B,IAAJ,CAASqH,EAAE9I,IAAF,GAAS,CAAT,GAAa,CAAC8I,EAAE5I,EAAF,GAAO4I,EAAE9I,IAAV,IAAgB,CAAtC,CAApD;AACH;;;+CAEkBH,I,EAAM;AACrB;AACA,oBAAIgR,oBAAoBhR,IAAxB;AACA,uBAAMgR,qBAAqB,IAArB,IAA6BA,kBAAkB3Q,EAAlB,IAAwBL,KAAKG,IAAhE;AACI6Q,wCAAoBA,kBAAkBnQ,QAAtC;AADJ,iBAHqB,CAMrB;AACA,oBAAIoQ,oBAAoBjR,IAAxB;AACA,uBAAMiR,qBAAqB,IAArB,IAA6BA,kBAAkB9Q,IAAlB,IAA0BH,KAAKK,EAAlE;AACI4Q,wCAAoBA,kBAAkBnQ,QAAtC;AADJ,iBAGA,IAAI2H,SAAS;AACTyI,6BAASF,qBAAqB,IAArB,GAA4B,IAA5B,GAAmC;AACxChR,8BAAMgR,iBADkC;AAExCP,8BAAMO,kBAAkB3Q,EAFgB;AAGxC8Q,kCAAWnR,KAAKG,IAAL,GAAY6Q,kBAAkB3Q;AAHD,qBADnC;AAMT+Q,2BAAOH,qBAAqB,IAArB,GAA4B,IAA5B,GAAmC;AACtCjR,8BAAMiR,iBADgC;AAEtCR,8BAAMQ,kBAAkB9Q,IAFc;AAGtCgR,kCAAUF,kBAAkB9Q,IAAlB,GAAyBH,KAAKK;AAHF;AANjC,iBAAb;AAYA,oBAAI2Q,qBAAqB,IAAzB,EAA+BvI,OAAO6H,OAAP,GAAiB7H,OAAO2I,KAAxB,CAA/B,KACK,IAAIH,qBAAqB,IAAzB,EAA+BxI,OAAO6H,OAAP,GAAiB7H,OAAOyI,OAAxB,CAA/B,KACAzI,OAAO6H,OAAP,GAAiB7H,OAAOyI,OAAP,CAAeC,QAAf,GAA0B1I,OAAO2I,KAAP,CAAaD,QAAvC,GAAkD1I,OAAOyI,OAAzD,GAAmEzI,OAAO2I,KAA3F;AACL,uBAAO3I,MAAP;AACH;;;wCACWyD,E,EAAI;AACZ,qBAAKc,aAAL,GAAqBd,EAArB;AACA,uBAAO,IAAP;AACH;;;;;;AAGLhN,kBAAc+H,IAAd,GAAqB;AACjBW,eAAOyJ,QADU;AAEjBnK,kBAAUmK;AAFO,KAArB;;AAKAC,WAAOC,OAAP,GAAiBrS,aAAjB","file":"timeline-chart.js","sourcesContent":["/*\nProvided timeline data should match the following grammar/rules:\n\n    <timeline_data> : \n    [\n        <series_data>,\n        <series_data>,\n        ...\n    ]\n\n    <series_data> :\n    [\n        label: <label-expression>,\n        data: \n        [\n            <series_item>\n        ]\n    ]\n\n    <series_item> : <series_interval> OR <series_point>\n\n    <series_interval> : \n    {\n        type: TimelineChart.TYPE.INTERVAL,\n        label: <label-expression>,\n        from: <Date>,\n        to: <Date>,\n        customClass: <css-class>,\n        onClick: <function>,\n        ids: [ (unique ID strings) ]\n    }\n\n    <series_point> :\n    {\n        type: TimelineChart.TYPE.INTERVAL,\n        label: <label>,\n        at: <Date>,\n        customClass: <css-class>,\n        onClick: <function>,\n        ids: [ (unique ID strings) ]\n    }\n\n    <label-expression> : <string>\n\n    <css-class> : <string>\n\n*/\n\nclass TimelineChart {\n    constructor(element, timelineData, opts) {\n        if (!timelineData || timelineData.constructor != [].constructor || !timelineData.length) return null;\n\n        let self = this;\n\n        element.classList.add('timeline-chart-component');\n\n        let options = this.extendOptions(opts);\n\n        timelineData.forEach(series => {\n            // Normalize data with respect to at/from/to temporal properties\n            series.data.forEach(item => {\n                item.at = self.getItemAvgDate(item);\n                item.from = self.getItemMinDate(item);\n                item.to = self.getItemMaxDate(item);\n            });\n            // Sort items within the series\n            var sortedItems = series.data.sort((a,b) => a.at < b.at ? -1 : a.at > b.at ? 1 : 0);\n            // On each item, set references to previous and next items\n            sortedItems.forEach((o,i) => {\n                o.prevItem = i == 0 ? null : sortedItems[i-1];\n                o.nextItem = i == sortedItems.length-1 ? null : sortedItems[i+1];\n            });\n        })\n\n        // flatten grouped data elements into a single array\n        let allElements = timelineData.reduce((agg, e) => agg.concat(e.data), []);\n\n        let minDt = d3.min(allElements, self.getItemMinDate);\n        let maxDt = d3.max(allElements, self.getItemMaxDate);\n        // zoom out just slightly, to allow for a little space on either end of the timeline\n        let dateDelta = maxDt.getTime() - minDt.getTime();\n        let zoomOutPct = .02;  // 2%\n        minDt = new Date(minDt.getTime() - (dateDelta * zoomOutPct));\n        maxDt = new Date(maxDt.getTime() + (dateDelta * zoomOutPct));\n\n        let timelineContainer = d3.select(element)\n            .append('div')\n            .classed('timeline-chart', true);\n        let timelineContainerElement = timelineContainer.node();\n\n        let elementWidth = options.width || timelineContainerElement.clientWidth || 600;\n        let elementHeight = options.height || timelineContainerElement.clientHeight || 200;\n\n        let margin = {\n            top: 20,\n            right: 0,\n            bottom: 0,  // set to about 20 for a bottom-aligned axis\n            left: 0\n        };\n\n        let dataIdClassPrefix = \"_id_\";\n\n        let width = elementWidth - margin.left - margin.right;\n        let height = elementHeight - margin.top - margin.bottom;\n\n        // Width of the series label area\n        let groupWidth = options.groupWidth || 400;  // options.hideGroupLabels ? 0 : 400;\n\n        // Height of each section containing a horizontal series.  By default, fit each series into the available vertical space.\n        let groupHeight = height / timelineData.length;\n        // Otherwise, if the groupHeight option is set, then use its value for the height of each series, and set the total height accordingly.\n        if (!!options.groupHeight)\n        {\n            groupHeight = options.groupHeight;\n            height = groupHeight * timelineData.length;\n        }\n\n        let xTimeScaleOriginal = d3.scaleTime()\n            .domain([minDt, maxDt])\n            .range([groupWidth, width]);\n        let xTimeScaleForContent = xTimeScaleOriginal;\n\n        // X axis ticks\n        let xAxis = d3.axisTop(xTimeScaleForContent)\n            //.orient('top') // set to 'bottom' for a bottom-aligned axis and to 'top' for a top-aligned axis\n            .tickSize(height); // set to height for a bottom-aligned axis and to -height for a top-aligned axis\n        let xAxisScaled = xAxis;\n\n        // In order to upgrade from v3 to v4, this needs to change.\n        // See here:  https://coderwall.com/p/psogia/simplest-way-to-add-zoom-pan-on-d3-js\n        let zoom = d3.zoom()\n            .on('zoom', zoomed)\n            .scaleExtent([1, Infinity])\n            .extent([[groupWidth,0], [width, height]])\n            .translateExtent([[groupWidth,0], [width, height]])\n\n        let svg = self.svgElement = timelineContainer\n            .append('svg')\n            .attr('width', width + margin.left + margin.right)\n            .attr('height', height + margin.top + margin.bottom);\n\n        // All elements affected by the zooming behavior are created in the zoom() fn.\n        let svg_g = svg\n            .append('g')\n            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n        svg_g.call(zoom); //.transform);\n\n        // let selectionFilter = svg_g.append(\"defs\")\n        //     .append(\"filter\")\n        //     .attr(\"id\",'blurred')\n        //     .attr({\"x\":\"-50%\", \"y\":\"-50%\", \"width\":\"200%\", \"height\":\"200%\"})\n        //     .append(\"feGaussianBlur\").attr(\"stdDeviation\", 12);\n\n        function uuidv4() {\n            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n            )\n        }\n          \n        let chartContentClipPathId = \"chart-content-clip-path-\"+uuidv4();\n        let clipPathRect = svg_g.append('defs')\n            .append('clipPath')\n            .attr('id', chartContentClipPathId)\n            .append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        // Invisible rect covering chart bounds, ensuring that all interactions intended for the chart will be raised as events on SVG elements\n        let interactionRect = svg_g.append('rect')\n            .attr('class', 'chart-bounds')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth);\n\n        //interactionRect.call(zoom);\n\n        if (options.enableLiveTimer) {\n            self.now = svg_g.append('line')\n                .attr('clip-path', `url(#${chartContentClipPathId})`)\n                .attr('class', 'vertical-marker now')\n                .attr(\"y1\", 0)\n                .attr(\"y2\", height);\n        }\n\n        let seriesBackground = svg_g.selectAll('.series-background')\n            .data(timelineData)\n            .enter()\n            .append('rect')\n            .attr('class', 'series-background')\n            .attr('x', 0)\n            .attr('y', (d, i) => { return groupHeight * i; })\n            .attr('width', width)\n            .attr('height', groupHeight)\n            .style('fill', (d, i) => {\n                // For numeric values of grouping key, use them.  Otherwise, use the supplied index (i).\n                var index = Math.abs(Math.floor((d.groupingKey == d.groupingKey*1 ? d.groupingKey : i)%10)*2-1);\n                return d3.schemeCategory20[index];\n            });\n\n        // horizontal lines between groups.  (This used to use the 'group-section' class, but is now using the 'series' terminology.)\n        let seriesDividers = svg_g.selectAll('.series-divider')\n            .data(timelineData)\n            .enter()\n            .append('line')\n            .attr('class', 'series-divider')\n            .attr('x1', 0)\n            .attr('x2', width)\n            .attr('y1', (d, i) => {\n                return groupHeight * (i + 1);\n            })\n            .attr('y2', (d, i) => {\n                return groupHeight * (i + 1);\n            });\n\n        let translucentOverlay = svg_g.append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('width', width - groupWidth)\n            .attr('height', height)\n            .style('fill', \"#fff\")\n            .style('fill-opacity', '.25');\n\n        let boundingRect = svg_g.append('rect')\n            .attr('x', 0)\n            .attr('y', 0)\n            .attr('width', width)\n            .attr('height', height)\n            .style('stroke', \"#000\");\n\n        // Axis with labels and ticks\n        let gX = svg_g.append('g')\n            .attr('class', 'x axis')\n            .attr('transform', 'translate(0,' + height + ')')\n            .call(xAxis);\n\n        // Monitor for change in size of containing element\n        setInterval(handleWidthChange, 1000);\n\n        function handleWidthChange() {\n            var newWidth = timelineContainerElement.clientWidth - margin.left - margin.right - 2;\n\n            if (newWidth > 0 && newWidth != width)\n            {\n                width = newWidth;\n                svg.attr(\"width\", width) ;\n                seriesDividers.attr('x2', width);\n                seriesBackground.attr('width', width);\n                boundingRect.attr('width', width);\n\n                var interactionWidth = width - groupWidth;\n                translucentOverlay.attr('width', interactionWidth);\n                clipPathRect.attr(\"width\", interactionWidth);\n                interactionRect.attr(\"width\", interactionWidth);\n                \n                xTimeScaleOriginal.range([groupWidth, width]);\n                xTimeScaleForContent.range([groupWidth, width]);\n                xAxisScaled = xAxis.scale(xTimeScaleForContent);\n                zoom\n                    .extent([[groupWidth,0], [width, height]])\n                    .translateExtent([[groupWidth,0], [width, height]]);\n                zoomed();\n                console.log(\"Width changed.  New total width: \", width, \"New interactive width: \", interactionWidth);\n            }\n        }\n\n        // heading / label text (for each series)\n        if (options.groupWidth > 0) {\n            let groupLabels = svg_g.selectAll('.series-label')\n                .data(timelineData)\n                .enter()\n                .append('text')\n                .attr('class', 'series-label')\n                .attr('x', '0.5em') //0)\n                .attr('y', (d, i) => {\n                    return (groupHeight * i) + (groupHeight / 2) ; //+ 5.5;\n                })\n                .attr('dx', '0.5em')\n                .attr('dy', '.4em')  //'-.1em')  //'0.5em')\n                .text(d => d.label)\n                .call(wrap, groupWidth);\n\n            let lineSection = svg_g.append('line').attr('x1', groupWidth).attr('x2', groupWidth).attr('y1', 0).attr('y2', height).attr('stroke', 'orange');\n        }\n\n        let groupIntervalItems = svg_g.selectAll('.series-interval-item')\n            .data(timelineData)\n            .enter()\n            .append('g')\n            .attr('clip-path', `url(#${chartContentClipPathId})`)\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.INTERVAL))\n            .enter();\n\n        let intervalBarHeight = 0.8 * groupHeight;\n        let intervalBarMargin = (groupHeight - intervalBarHeight) / 2;\n        let intervals = groupIntervalItems\n            .append('rect')\n            .attr('class', curry(addClasses, 'interval'))\n            .attr('width', (d) => Math.max(options.intervalMinWidth, xTimeScaleForContent(d.to) - xTimeScaleForContent(d.from)))\n            .attr('height', intervalBarHeight)\n            .attr('y', intervalBarMargin)\n            .attr('x', (d) => xTimeScaleForContent(d.from))\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        // interval text\n        let intervalTexts = groupIntervalItems\n            .append('text')\n            .text(d => d.label || '')  //  (typeof(d.label) === 'function' ? d.label(d) : d.label) || '')\n            .attr('class', curry(addClasses, 'interval-text'))\n            .attr('y', (groupHeight / 2) + 5)\n            .attr('x', (d) => xTimeScaleForContent(d.from));\n\n        let groupDotItems = svg_g.selectAll('.series-dot-item')\n            .data(timelineData)\n            .enter()\n            .append('g')\n            .attr('clip-path', `url(#${chartContentClipPathId})`)\n            .attr('class', 'item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => {\n                return d.data.filter(_ => _.type === TimelineChart.TYPE.POINT);\n            })\n            .enter();\n\n        let dots = groupDotItems\n            .append('circle')\n            .attr('class', curry(addClasses, 'dot'))\n            .attr('cx', d => xTimeScaleForContent(d.at))\n            .attr('cy', groupHeight / 2)\n            .attr('r', 7)\n            .on('click', (d) => { !d.onClick || d.onClick(d); });\n\n        // If set, options.tipContentGenerator should have the following form: function(timelineObjectForWhichToRenderTipContent)\n        if (window.Popper && window.Tooltip && options.tipContentGenerator) {\n            let tip = function() {\n                // The container element will hold the placeholder element and the tooltip element\n                // The reason we need this is because of how tooltip.js resolves the tooltip-inner element when updating the tooltip \"title\".\n                var container = document.createElement('div');\n                document.body.appendChild(container);\n\n                // The placeholder element will be used to position the tooltip by representing the\n                // area of the target element which is capable of being viewed.\n                var placeholderEl = d3.select(document.createElement('div'));\n                placeholderEl\n                    .style('position', 'absolute').style('top', 0)\n                    .style('opacity', 0)\n                    .style('pointer-events', 'none').style('box-sizing', 'border-box');\n                container.appendChild(placeholderEl.node());\n\n                function result() {\n                    console.log('calling tip fn');\n                }\n\n                var _tooltip = null;\n                function getToolTip() {\n                    if (window.Popper && window.Tooltip && _tooltip == null)\n                    {\n                        _tooltip = new Tooltip(placeholderEl.node(), {\n                            placement: 'top', \n                            title: 'initial value', \n                            html: true,\n                            popperOptions: {\n                                onCreate: function(p) { p.instance.popper.classList.add('show'); },\n                                modifiers: {\n                                    flip: {\n                                        behavior: ['top', 'bottom', 'left', 'right']\n                                    }\n                                }\n                            }\n                        });\n                        // Showing and hiding the tooltip will cause the tooltip node to be created\n                        _tooltip.show();\n                        _tooltip.hide();\n                        d3.select(_tooltip._tooltipNode).on('mouseenter', result.onMouseEnter);\n                        d3.select(_tooltip._tooltipNode).on('mouseleave', result.onMouseLeave);\n                    }\n                    return _tooltip;\n                }\n\n                var tipContentGenerator;\n\n                result.html = function(val) {\n                    tipContentGenerator = val;\n                };\n\n                var tipIsShowing = false;\n                var tipHideDelayTimeoutToken = null;\n                var targetElement = null;\n\n                result.onMouseEnter = function() {\n                    result.cancelHide();\n                };\n\n                result.onMouseLeave = function() {\n                    result.hideWithDelay();\n                };\n\n                // Cancel the delayed hide operation\n                result.cancelHide = function() {\n                    if (!tipHideDelayTimeoutToken) return;\n\n                    clearTimeout(tipHideDelayTimeoutToken);\n                    tipHideDelayTimeoutToken = null;\n                };\n\n                result.hideNow = function() {\n                    if (!tipIsShowing) return;\n\n                    // If this method was called before the hide delay timeout expired, then cancel the pending operation\n                    result.cancelHide();\n\n                    tipHideDelayTimeoutToken = null;\n                    getToolTip().hide();\n                    tipIsShowing = false;\n                    targetElement = null;\n                };\n\n                result.hideWithDelay = function() {\n                    tipHideDelayTimeoutToken = setTimeout(() => {\n                        result.hideNow();\n                    }, 250);\n                };\n\n                result.show = function(d) {\n                    if (tipIsShowing && this == targetElement)\n                        result.cancelHide();\n                    else\n                        result.hideNow();\n\n                    // Update the position and dimensions of the placeholder element to match that of the target element.\n                    var rect = this.getBoundingClientRect();  // bounding client rect of target element\n                    var cliprect = interactionRect.node().getBoundingClientRect();  // bounding client rect of element to clip the target element's coords to\n\n                    var top = rect.top + window.scrollY;\n                    var left = Math.max(rect.left,cliprect.left) + window.scrollX;\n                    var right = Math.min(rect.right,cliprect.right) + window.scrollX;\n                    var bottom = rect.bottom + window.scrollY;\n                    var height = Math.min(bottom-top, rect.height);\n                    var width = Math.min(right-left, rect.width);\n\n                    placeholderEl\n                        .style('top', top+'px')\n                        .style('left', left+'px')\n                        .style('height', height+'px')\n                        .style('width', width+'px');\n                    // Update the content of the tooltip by regenerating it to match the current data.\n                    var html = tipContentGenerator(d);\n                    var tt = getToolTip();\n                    tt.updateTitleContent(html);\n                    // show\n                    tt.show();\n                    tipIsShowing = true;\n                    targetElement = this;\n                };\n\n                return result;\n            }();\n\n\n            // Set fn for generating tip content\n            tip.html(options.tipContentGenerator);\n            dots.on('mouseover', tip.show).on('mouseout', tip.hideWithDelay);\n            intervals.on('mouseover', tip.show).on('mouseout', tip.hideWithDelay);\n        }\n\n        zoomed();\n\n        if (options.enableLiveTimer) {\n            setInterval(updateNowMarker, options.timerTickInterval);\n        }\n\n\n        function wrap(text, width, anchorPosition) \n        {\n            text.each(function() {\n                var text = d3.select(this),\n                words = text.text().split(/\\s+/).reverse(),\n                word,\n                line = [],\n                lineNumber = 0,\n                lineHeight = 1.2, // ems\n                y = text.attr(\"y\"),\n                dx = parseFloat(text.attr(\"dx\")),\n                dy = parseFloat(text.attr(\"dy\"));\n                //lines = [];\n                var tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dx\", dx + \"em\").attr(\"dy\", dy + \"em\");\n                while (word = words.pop()) \n                {\n                    line.push(word);\n                    tspan.text(line.join(\" \"));\n                    // create line break\n                    if (tspan.node().getComputedTextLength() > width) \n                    {\n                        line.pop();\n                        tspan.text(line.join(\" \"));\n                        line = [word];\n                        //lines.push(line);\n                        tspan = text.append(\"tspan\")\n                            .attr(\"x\", 0)\n                            //.attr(\"y\", y)\n                            .attr(\"dx\", dx + \"em\")\n                            .attr(\"dy\", lineHeight + \"em\")  //++lineNumber * lineHeight + dy + \"em\")\n                            .text(word);\n                        var tspanFirst = text.select('tspan');\n                        dy = parseFloat(tspanFirst.attr(\"dy\"));\n                        tspanFirst.attr('dy', dy-(lineHeight*.5)+\"em\");\n                    }\n                }\n            });\n        }\n      \n        function updateNowMarker() {\n            let nowX = xTimeScaleForContent(new Date());\n\n            self.now.attr('x1', nowX).attr('x2', nowX);\n        }\n\n        function curry(fn) {\n            var args = Array.prototype.slice.call(arguments, 1);  // capture all but the 1st arg\n            return function() {\n                return fn.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n            }\n        }\n        \n        // Add to (this) selection the provided defaultClass and any customClass specified within the data.\n        function addClasses(defaultClass, data) {\n            //console.log('this: ', this, ' arguments: ', arguments);\n            var classes = [ defaultClass ];\n            if (!!data.customClass) classes.push(data.customClass);\n            var idClasses = (data.ids || []).map(id => dataIdClassPrefix+id);\n            return classes.concat(idClasses).join(' ');\n        }\n\n        function zoomed() {\n            if (self.onVizChangeFn && d3.event) {\n                self.onVizChangeFn.call(self, {\n                    scale: d3.event.scale,\n                    translate: d3.event.translate,\n                    domain: xTimeScaleForContent.domain()\n                });\n            }\n\n            if (options.enableLiveTimer) {\n                updateNowMarker();\n            }\n\n            var ___dummy___ = [ zoom ];  // include in closure\n            \n            if (d3.event && d3.event.transform) {\n            //console.log(d3.event.transform);  // includes k(scale), x, and y\n                // create new scale ojects based on event\n                xTimeScaleForContent = d3.event.transform.rescaleX(xTimeScaleOriginal);\n            }\n            else console.log('d3.event.transform is empty');\n\n            // update axes\n            xAxisScaled = xAxis.scale(xTimeScaleForContent);\n\n            // redraw axis\n            gX.call(xAxisScaled);\n            // redraw points and intervals\n            svg_g.selectAll('circle.dot').attr('cx', d => xTimeScaleForContent(d.at));\n            svg_g.selectAll('rect.interval').attr('x', d => xTimeScaleForContent(d.from)).attr('width', d => Math.max(options.intervalMinWidth, xTimeScaleForContent(d.to) - xTimeScaleForContent(d.from)));\n            svg_g.selectAll('.interval-text').attr('x', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return positionData.upToPosition;\n                    } else if (positionData.xPosition < groupWidth && positionData.upToPosition > groupWidth) {\n                        return groupWidth;\n                    }\n                    return positionData.xPosition;\n                }).attr('text-anchor', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return 'end';\n                    }\n                    return 'start';\n                })\n                .attr('dx', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return '-0.5em';\n                    }\n                    return '0.5em';\n                }).text(function(d) {\n                    var positionData = getTextPositionData.call(this, d);\n                    var percent = (positionData.width - options.textTruncateThreshold) / positionData.textWidth;\n                    var labelText = d.label || ''; //typeof(d.label)===\"string\" ? d.label : typeof(d.label)===\"function\" ? d.label(d) : '';\n                    if (percent < 1) {\n                        if (positionData.width > options.textTruncateThreshold) {\n                            return labelText.substr(0, Math.floor(labelText.length * percent)) + '...';\n                        } else {\n                            return '';\n                        }\n                    }\n\n                    return labelText;\n                });\n\n            function getTextPositionData(d) {\n                this.textSizeInPx = this.textSizeInPx || this.getComputedTextLength();\n                var from = xTimeScaleForContent(d.from);\n                var to = xTimeScaleForContent(d.to);\n                return {\n                    xPosition: from,\n                    upToPosition: to,\n                    width: to - from,\n                    textWidth: this.textSizeInPx\n                }\n            }\n        }\n\n        var getItemMinDate = self.getItemMinDate = function(pointOrInterval) {\n            var p = pointOrInterval;\n            return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n        };\n        var getItemMaxDate = self.getItemMaxDate = function(pointOrInterval) {\n            var p = pointOrInterval;\n            return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n        };\n    \n        // whether transitions should be animated by default\n        var animateTransitions = true;\n        self.animateTransitions = function(value) {\n            if (value === undefined)\n                return animateTransitions;\n            animateTransitions = !!value;\n        }\n\n        self.refresh = function() { zoomed(); }\n        \n        self.resetTransform = function(animate) {\n            if (animate === undefined ? animateTransitions : animate)\n                svg_g.transition().duration(500).call(zoom.transform, d3.zoomIdentity);\n            else\n                svg_g.call(zoom.transform, d3.zoomIdentity);\n        };\n\n        // translate the timeline so that the specified range value is centered within the view.  Extent constraints will be respected.\n        function translateToRangeValue(x, animate) {\n            if (animate === undefined ? animateTransitions : animate)\n                svg_g.transition().duration(500).call(zoom.translateTo, x, 0);\n            else\n                svg_g.call(zoom.translateTo, x, 0);\n        }\n        //self.translateToRangeValue = translateToRangeValue;\n\n        // set zoom scale\n        function setZoomScale(k, animate) {\n            if (animate === undefined ? animateTransitions : animate)\n                svg_g.transition().duration(500).call(zoom.scaleTo, k);\n            else\n                svg_g.call(zoom.scaleTo, k);\n        }\n\n        // translate to a position that is the given percentage between the min and max values\n        function translateToPercent(normalizedPercentage) {\n            var range = xTimeScaleForContent.range();\n            var delta = range[1] - range[0];\n            var x = delta * normalizedPercentage + range[0];\n            translateToRangeValue(x);\n        }\n        self.translateToPercent = translateToPercent;\n        \n        function translateToDate(date, animate) {\n            var rangeValue = xTimeScaleOriginal(date);\n            translateToRangeValue(rangeValue, animate);\n        }\n        self.translateToDate = translateToDate;\n\n        // Given one or more [string] ids, do one or both of the following:\n        //  - move the elements into view (via zooming and panning)\n        //  - apply the specified CSS class to the elements\n        self.highlightNodeByIds = function(idOrIdArray, moveIntoView, highlightCssClassName) {\n            var ___dummy___ = [zoom, xTimeScaleForContent];  // include zoom in closure\n            var idArray = typeof(idOrIdArray) === \"string\" ?  [idOrIdArray] : idOrIdArray;\n            if (idArray.constructor !== [].constructor) return { data: [] };\n\n            // Clear highlight in case one is set\n            d3.selectAll('.'+highlightCssClassName).classed(highlightCssClassName, false);\n\n            var selector = idArray.map(id => \".\"+dataIdClassPrefix+id).join(',');\n\n            // Bail out if no selector is available\n            if (!selector) return { data: [] };\n\n            var sel = d3.selectAll(selector);\n\n            // Bail out if selector doesn't match an element\n            if (sel.nodes().length == 0) return { data: [] };\n\n            // Highlight new node\n            sel.classed(highlightCssClassName, true);\n\n            var items = sel.data();\n            var itemToUse = items.find(item => item.type == TimelineChart.TYPE.POINT) || items[0];\n            // optionally scroll the node into view\n            if (!!moveIntoView) {\n                // TODO:  when an interval spans the entire view, using the itemTime returned for it will likely change the view considerably. \n                // Instead, find a better way to deal witht this, possibly using the time associated with the point clicked.  \n                // To do this, consider allowing an optional time to be provided to this method which will serve as the itemToUse/itemTime around which the view will be centered.\n                var itemTime = self.getItemAvgDate(itemToUse);\n                var rangeValue = xTimeScaleOriginal(itemTime);\n                var currentTransform = d3.zoomTransform(svg_g.node());\n\n                // leave log statements in here for now, for troubleshooting purposes\n                //console.log('target range value: ', rangeValue);\n                //console.log('current transform: ', currentTransform);\n                //console.log('original scale:  range: ', xTimeScaleOriginal.range(), 'domain: ', xTimeScaleOriginal.domain())\n                //console.log('current scale:  range: ', xTimeScaleForContent.range(), 'domain: ', xTimeScaleForContent.domain())\n\n                var neighborInfo = self.getSeriesNeighbors(itemToUse);\n                if (neighborInfo.nearest != null) {\n                    var timeCoord = xTimeScaleForContent(itemTime);\n                    var nearestTimeCoord = xTimeScaleForContent(neighborInfo.nearest.time);\n                    var timeDeltaInMs = Math.abs(timeCoord - nearestTimeCoord);\n                    var kNew = (20 / timeDeltaInMs) * currentTransform.k;\n                    //console.log('time delta (ms): ', timeDeltaInMs, 'new k: ', kNew);\n                    if (kNew > currentTransform.k) {\n                        //console.log('date: ', itemTime, 'x: ', timeCoord);\n                        //console.log('nearestDate: ', itemTime, 'x: ', nearestTimeCoord);\n                        //console.log('k current: ', currentTransform.k, 'new: ', kNew);\n                        // Perform scale transformation instantly\n                        setZoomScale(kNew, false);\n                    }\n                }\n\n                // Perform translation transformation with animation\n                translateToDate(itemTime, false);\n            }\n\n            return {\n                data: items\n            };\n        };\n\n        self.scaleTo = function(k) {\n            svg_g.call(zoom.scaleTo, k);\n        }\n\n        console.log(\"timeline data successfully bound to chart: \", timelineData);\n        console.log(\"timeline data flattened: \", allElements);\n    }\n    extendOptions(ext = {}) {\n        let defaultOptions = {\n            intervalMinWidth: 8, // px\n            tipContentGenerator: undefined,\n            textTruncateThreshold: 30,\n            enableLiveTimer: false,\n            timerTickInterval: 1000,\n            groupHeight: 40, // px\n            groupWidth: 300 // px\n        };\n        Object.keys(ext).map(k => defaultOptions[k] = ext[k]);\n        return defaultOptions;\n    }\n    getItemMinDate(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n    }\n    getItemMaxDate(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n    }\n    getItemAvgDate(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : new Date(p.from * 1 + (p.to - p.from)/2);\n    }\n    // get the previous and next dates in the series (that are not identical to the starting/ending dates of the current item)\n    getSeriesNeighbors(item) {\n        // Find an earlier item that ends before this item begins\n        var earlierEndingItem = item;\n        while(earlierEndingItem != null && earlierEndingItem.to >= item.from)\n            earlierEndingItem = earlierEndingItem.prevItem;\n    \n        // Find a later item that starts after this item ends\n        var laterStartingItem = item;\n        while(laterStartingItem != null && laterStartingItem.from <= item.to)\n            laterStartingItem = laterStartingItem.nextItem;\n\n        var result = {\n            earlier: earlierEndingItem == null ? null : {\n                item: earlierEndingItem,\n                time: earlierEndingItem.to,\n                interval:  item.from - earlierEndingItem.to\n            },\n            later: laterStartingItem == null ? null : {\n                item: laterStartingItem,\n                time: laterStartingItem.from,\n                interval: laterStartingItem.from - item.to\n            }\n        };\n        if (earlierEndingItem == null) result.nearest = result.later;\n        else if (laterStartingItem == null) result.nearest = result.earlier;\n        else result.nearest = result.earlier.interval < result.later.interval ? result.earlier : result.later;\n        return result;\n    }\n    onVizChange(fn) {\n        this.onVizChangeFn = fn;\n        return this;\n    }\n}\n\nTimelineChart.TYPE = {\n    POINT: Symbol(),\n    INTERVAL: Symbol()\n};\n\nmodule.exports = TimelineChart;\n "]}