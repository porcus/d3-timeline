{"version":3,"sources":["case-timer-event-viewer.js"],"names":["CaseTimerEventViewer","element","initialCaseData","opts","self","Array","prototype","selectMany","memberArraySelectorFn","length","map","reduce","a","b","concat","d3","selection","appendHTML","HTMLString","select","appendChild","document","importNode","DOMParser","parseFromString","body","childNodes","hide","style","show","visible","value","undefined","loadScriptFile","src","createElement","loadCssFile","rel","type","href","head","executeFunctionWhenPredicateIsSatisfied","boolPredicate","fn","initialWaitInMs","subsequentWaitInMs","task","setTimeout","window","Popper","initializeTableFeatures","Tablesaw","init","selectAll","each","d","i","o","toggleEl","toggle","targetElementId","attr","target","targetElement","node","toggleFn","isVisible","property","html","on","submitForm","newurl","location","origin","pathname","event","keyCode","isValidDate","Date","isNaN","isoDateTimeRegex","ymdhmsfTimeParser","utcParse","ymdhmslTimeParser","ymdhmsTimeParser","parseDateTime","dateString","test","isoParse","ymdhmsfTimeFormatter","utcFormat","ymdhmsTimeFormatter","hmslTimeFormatter","toString","toISOString","latestCaseDetailsContainer","getElementById","latestSlaDetailsContainer","latestCaseTimerDetailsContainer","timelineContainer","selectedCaseTimerLabel","caseTimerEventDetailsContainer","caseTimerSnapshotDetailsContainer","historicalSnapshotDetailsContainer","historicalCaseDetailsContainer","historicalSlaDetailsContainer","historicalCaseTimerDetailsContainer","shouldShowSnapshotJsonForSelectedItems","Tooltip","placement","title","popperOptions","onCreate","p","instance","popper","classList","add","casePropertyConfigs","propertyLabel","propertyValueSelector","x","Identifier","onClick","Id","Owner","FirstName","LastName","Site","Name","Employee","PrimarySite","caseTimerPropertyConfigs","priority","OrdinalId","Events","renderEventDetailsTableAndSnapshotDetailsTableFromEvents","ct","CaseTimerType","separateWordsInCamelCaseStringWithSpaces","CurrentEffectiveClockState","CurrentNonWorkingTimePeriodTypes","DisplayOnCase","NonWorkingEventSource","RespectNonWorkingSchedule","RespectSlaClock","RespectWorkCalendar","filter","r","join","ElapsedTime","Offset","RunTime","LastCalculated","Started","Stopped","ErrorTime","slaPropertyConfigs","RespectSlaPauses","SlaReplacementElapsedTimeAllocationPolicy","Status","Condition","SlaColor","IsPaused","IsActive","TargetInitialResponseDuration","IsTargetInitialResponseDefined","TimeUntilInitialResponse","ActualInitialResponseDate","ExpectedInitialResponseDate","InitialResponseBreachedDate","HasInitialResponseBreached","HasInitialResponseOccurred","TargetResolutionDuration","TimeRemaining","TargetResolutionBreachedDate","EstimatedTargetResolutionDate","HasTargetResolutionBreached","TimeUntilNextControlPoint","EstimatedNextControlPointDate","caseTimerEventPropertyConfigs","CaseTimerSnapshot","renderEventDetails","cte","EventTime","EventIdentifierString","AppIdentifier","IsDerived","IsInherited","IsCaseTimerCreationEvent","displaySnapshotAsJson","EventData","displayEventDataAsJson","caseTimerSnapshotPropertyConfigs","renderSnapshotDetails","cts","SnapshotTime","SnapshotData","caseDataModel","getCaseDataModel","renderCaseData","timeline","caseDataToRender","console","log","caseTimerTimelineData","transformCaseDataToTimelineData","error","alert","renderLatestCaseProperties","renderLatestCaseTimersTable","Timers","renderTimeline","emptyContainer","caseTimerEvent","createJsonViewerPopup","caseTimerSnapshot","beforeSnapshotDataSerialized","ssCopy","UniqueId","LastModified","formatDateTime","CaseTimer","afterSnapshotDataSerialized","timerIsUsedBySlaInSnapshotData","ssd","Sla","CaseTimerId","Case","afterSnapshotDataDeserialized","shareSnapshotDataReferences","container","timelineData","TimelineChart","tipContentGenerator","generateTipHtmlContent","groupHeight","groupWidth","resetTransform","str","replace","trim","date","formatDuration","later","earlier","rem_ms","ms","rem_s","Math","floor","s","rem_m","m","rem_h","h","rem_d","y","parts","durationString","tipHeading","label","formatLabelForTipHtml","tipDetails","details","temporalDescription","TYPE","POINT","at","from","to","result","escapeQuotes","objToView","heading","objJson","JSON","stringify","createPopupWindowFromHtml","targetId","windowFeatures","windowTitle","popup","open","doc","write","close","isUUID","match","index","firstChild","removeChild","renderProperties","allCaseTimers","selectedTimers","renderTableOfObjects","allEvents","selectedEvents","caseTimer","snapshotsForSelectedEvents","evt","latestSnapshot","maxBy","highlightNodesInTimeline","renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData","Snapshots","renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots","snapshots","selectedSnapshots","caseTimerId","CaseTimerMap","get","EventsBySnapshotIdLookup","ss","firstOrDefault","primaryItemsToHighlight","secondaryItemsToHighlight","primaryIds","accumulator","currentValue","secondaryIds","highlightNodeByIds","events","snapshotToUseForHistoricalData","sortBy","renderHistoricalDataFromSnapshot","snapshotsForTimer","snapshot","eligibleSnapshots","snapshotsGroupedByTimerId","nest","key","entries","latestSnapshotsByDistinctTimerId","g","values","_","caseTimersToDisplay","arr","ps","ascendingOrder","sort","distinctBy","withFirst","first","call","maxValue","maxi","minBy","minValue","mini","tableContainer","propertyConfigs","itemsToRender","itemsToHighlight","table","append","classed","headerRow","forEach","pc","tbody","tr","findIndex","obj","data","enter","renderPropertyValue","sel","highlightedElements","nodes","scrollIntoView","block","d3SelectionBoundToPropertyConfig","objectWithProperties","getHtmlContentForPropertyValue","parentElement","renderPropertyLabelAndValue","propertyWrapper","labelElement","valueElement","propertyConfig","propertyValue","constructor","restoreReferencesInCaseTimerObjectGraph","caseTimerArray","snapshotsById","e","normalizeDatesRecursively","input","eachRecursive","val","caseDataToTransform","ordinalId","t","allSnapshots","SnapshotMap","allTimelineSeriesForAllTimers","caseTimerEventPoints","timeOfEvents","eventsAtTime","pointObj","ids","point","timerEventsSeries","groupingKey","caseTimerSnapshotPoints","snapshotTime","snapshotsAtTime","generateSnapshotTipHtmlDetails","find","ndss","SubsequentNonDerivedSnapshot","timer","timerInfo","sla","slaInfo","timerSnapshotsSeries","now","intervalConfigs","intervalSeriesEventGroupingKeyFn","groupLabelFn","intervalLabelFn","startEventId","endEventId","intervalType","customClass","TemporalEventArgs","NonWorkingPeriod","SourceId","SourceName","SourceNameName","eventIntervalGroupingKeyFn","matchingIntervalConfig","includes","ic","timerIntervalSeriesArray","intervalConfigKey","intervalGroup","split","intervalConfig","eventsOfInterest","intervals","curEvt","nextEvt","intervalObj","INTERVAL","Object","assign","interval","push","subsequentNonDerivedSnapshot","snapshotsReversed","slice","reverse","priorNonDerivedSnapshot","PriorNonDerivedSnapshot","calculationIntervalsSeries","curSD","nextSD","getIntervalPointAvgDate","aAvgDate","bAvgDate","allSeriesForTimer","newGroupNumber","lastGroupKey","newCaseData","module","exports"],"mappings":"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","file":"case-timer-event-viewer.js","sourcesContent":["class CaseTimerEventViewer {\r\n    constructor(element, initialCaseData, opts) {\r\n        let self = this;\r\n\r\n        // We'll use this several times hereafter\r\n        Array.prototype.selectMany = function(memberArraySelectorFn){ return !this.length ? [] : this.map(memberArraySelectorFn).reduce((a,b) => a.concat(b)); };\r\n\r\n        // Extend the d3 selection prototype to include some additional functions\r\n\r\n        // Note:  This function will ONLY append the first element in the HTML string literal provided.\r\n        if (!d3.selection.prototype.appendHTML) {\r\n            d3.selection.prototype.appendHTML =\r\n            //d3.selection.enter.prototype.appendHTML = \r\n            function(HTMLString) {\r\n                return this.select(function() {\r\n                    return this.appendChild(document.importNode(new DOMParser().parseFromString(HTMLString, 'text/html').body.childNodes[0], true));\r\n                });\r\n            };\r\n        }\r\n        d3.selection.prototype.hide = \r\n            //d3.selection.enter.prototype.hide = \r\n            function() { this.style('display', 'none') };\r\n        d3.selection.prototype.show = \r\n            //d3.selection.enter.prototype.show = \r\n            function() { this.style('display', null) };\r\n        d3.selection.prototype.visible = \r\n            //d3.selection.enter.prototype.visible = \r\n            function(value) { if (value === undefined) return this.style('display') !== 'none'; this.style('display', !!value ? null : 'none'); };\r\n\r\n\r\n        function loadScriptFile(src) {\r\n            var element = document.createElement(\"script\");\r\n            element.src = src;\r\n            document.body.appendChild(element);\r\n        }\r\n        function loadCssFile(src) {\r\n            var element = document.createElement(\"link\");\r\n            element.rel = \"stylesheet\";\r\n            element.type = \"text/css\";\r\n            element.href = src;\r\n            document.head.appendChild(element);\r\n        }\r\n        function executeFunctionWhenPredicateIsSatisfied(boolPredicate, fn, initialWaitInMs, subsequentWaitInMs) {\r\n            initialWaitInMs = initialWaitInMs || 100;\r\n            subsequentWaitInMs = subsequentWaitInMs || 100;\r\n            var task = function() {\r\n                if (!!boolPredicate()) fn();\r\n                else setTimeout(task, subsequentWaitInMs);\r\n            };\r\n            setTimeout(task, initialWaitInMs);\r\n        }\r\n\r\n        // Popper\r\n        loadScriptFile(\"https://unpkg.com/popper.js\");\r\n        //loadScriptFile(\"https://unpkg.com/popper.js/dist/umd/popper.min.js\");\r\n        //\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\");\r\n\r\n        // Tooltip (by Popper)\r\n        executeFunctionWhenPredicateIsSatisfied(() => window.Popper, () => {\r\n            loadScriptFile(\"https://unpkg.com/tooltip.js\");\r\n        });\r\n        //loadScriptFile(\"https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js\");\r\n\r\n        // JSONEditor\r\n        loadScriptFile(\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor-minimalist.js\");\r\n        loadCssFile(\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor.css\");\r\n\r\n        // Tablesaw\r\n        // Until this issue https://github.com/filamentgroup/tablesaw/issues/342) is fixed, tablesaw needs to be loaded before the page has finished loading.\r\n        // Once that issue is fixed, we can load it here:\r\n        //loadScriptFile(\"https://cdn.jsdelivr.net/npm/tablesaw@3.0.9/dist/tablesaw.min.js\");\r\n        loadCssFile(\"https://cdn.jsdelivr.net/npm/tablesaw@3.0.9/dist/tablesaw.min.css\");\r\n\r\n\r\n        // setTimeout(function(){ \r\n        //     // Until this issue https://github.com/filamentgroup/tablesaw/issues/342) is fixed, loading tablesaw at this point will mean that we have to manually trigger the\r\n        //     //   DOMContentLoaded event on the document after dynamically loading the script in order for Tablesaw to be aware that it can be safely initialized.\r\n        //     // This is a bit of a hack, so we'll have to see how this works.\r\n        //     var DOMContentLoaded_event = document.createEvent(\"Event\");\r\n        //     DOMContentLoaded_event.initEvent(\"DOMContentLoaded\", true, true);\r\n        //     window.document.dispatchEvent(DOMContentLoaded_event);\r\n        // }, 500);\r\n\r\n        function initializeTableFeatures() {\r\n            if (window.Tablesaw === undefined) {\r\n                setTimeout(initializeTableFeatures, 500);\r\n                return;\r\n            }\r\n\r\n            Tablesaw.init();\r\n        }\r\n\r\n        d3.select(element).appendHTML(`\r\n            <div id=\"case-timer-event-viewer-container\" class=\"container-fluid font-scale-pct-80\">\r\n\r\n                <div class=\"row mt-3 mb-3\">\r\n                    <div class=\"col-10\">\r\n                        <div id=\"case-timer-event-viewer-input\">\r\n                            <div class=\"h4 bottom-border\">Input</div>\r\n\r\n                            <div id=\"case-timer-event-viewer-error\" class=\"alert alert-warning mt-3\" role=\"alert\">\r\n                                <div class=\"alert-heading\"> To view case timer data for a given case, please enter a valid entity Id for a case, SLA, case timer, case timer event, or case timer snapshot.</div>\r\n                            </div>\r\n                \r\n                            <div class=\"input-group\">\r\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Enter a valid entity Id to load data for the related case\" id=\"entity-id\" />\r\n                                <div class=\"input-group-append\">\r\n                                    <button id=\"load-entity-button\" class=\"btn btn-primary\">Load</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"col-2\">\r\n                        <div class=\"h4 bottom-border\">Options</div>\r\n\r\n                        <input type=\"checkbox\" id=\"should-show-snapshot-json-for-selected-items\"> Show snapshot JSON for each selected item.\r\n                    </div>\r\n                </div>\r\n\r\n                <div id=\"case-timer-event-viewer-content\">\r\n\r\n                    <div class=\"mb-3\">\r\n                        <div class=\"h4 bottom-border\">\r\n                            <label for=\"case-timer-data-latest-toggle\">Latest Data</label>\r\n                            <input type=\"checkbox\" id=\"case-timer-data-latest-toggle\" data-toggle-target-element-id=\"case-timer-data-latest\" />\r\n                        </div>\r\n                        <div id=\"case-timer-data-latest\" class=\"indent\">\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"h6\">Case</div>\r\n                                    <div id=\"case-details-latest\" class=\"property-card-flex-layout\" ></div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"h6\">SLA</div>\r\n                                    <div id=\"sla-details-latest\" class=\"property-card-flex-layout\" ></div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"h6\">Case Timers</div>\r\n                                    <div id=\"case-timer-details-latest\" class=\"scrollable-container\" ></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    <!-- Timeline -->\r\n                    <div class=\"row mb-3\">\r\n                        <div class=\"col-12\">\r\n                            <div class=\"h4 bottom-border\">Case Timer Events Timeline\r\n                                <button id=\"reset-timeline-view\" type=\"button\" class=\"btn btn-info btn-sm ml-4 m-1\">Reset View</button>\r\n                            </div>\r\n                            <div id=\"timeline-chart\" class=\"chart-container\" ></div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    <div class=\"mb-3\">\r\n                        <div id=\"selected-case-timer-label\" class=\"h4 bottom-border\">Selected Case Timer</div>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-8\">\r\n                                <div class=\"h6\">Events</div>\r\n                                <div id=\"case-timer-event-details\" class=\"scrollable-container\" ></div>\r\n                            </div>\r\n                            <div class=\"col-4\">\r\n                                <div class=\"h6\">Snapshots\r\n                                    <span id=\"snapshot-reminder\" class=\"badge badge-warning\">Remember...</button>\r\n                                </div>\r\n                                <div id=\"case-timer-snapshot-details\" class=\"scrollable-container\" ></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    <div class=\"h4 bottom-border\">\r\n                        <label for=\"case-timer-data-historical-contextual-toggle\">Historical Data Contemporary with Selected Snapshot</label>\r\n                        <input type=\"checkbox\" id=\"case-timer-data-historical-contextual-toggle\" data-toggle-target-element-id=\"case-timer-data-historical-contextual\" />\r\n                    </div>\r\n                    <div id=\"case-timer-data-historical-contextual\" class=\"indent\">\r\n                        <div class=\"row mb-3\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h6\">Selected Snapshot</div>\r\n                                <div id=\"snapshot-details-historical\" class=\"property-card-flex-layout\" ></div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"row mb-3\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h6\">Case</div>\r\n                                <div id=\"case-details-historical\" class=\"property-card-flex-layout\" ></div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"row mb-3\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h6\">SLA</div>\r\n                                <div id=\"sla-details-historical\" class=\"property-card-flex-layout\" ></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"row\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h5\">Case Timers</div>\r\n                                <div id=\"case-timer-details-historical\" class=\"scrollable-container\" ></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n            </div>`);\r\n\r\n        // set up \r\n        d3.selectAll('[data-toggle-target-element-id]').each(function(d, i, o) {\r\n            var toggleEl = this;\r\n            var toggle = d3.select(toggleEl);\r\n\r\n            var targetElementId = toggle.attr('data-toggle-target-element-id');\r\n            if (!targetElementId) return;\r\n\r\n            var target = d3.select('#'+targetElementId);\r\n            var targetElement = target.node();\r\n            if (!targetElement) return;\r\n\r\n            var toggleFn = function() {\r\n                var isVisible = toggle.property('checked');\r\n                toggle.html(isVisible ? 'hide' : 'show');\r\n                target.style('display', isVisible ? '' : 'none');\r\n            };\r\n            toggle.on('click', toggleFn);\r\n            toggleFn();\r\n         });\r\n\r\n        function submitForm() {\r\n            var newurl = `${window.location.origin + window.location.pathname}?id=${d3.select('#entity-id').property('value')}`;\r\n            window.location.href = newurl;\r\n        }\r\n\r\n        d3.select('#load-entity-button')\r\n            .on('click', submitForm);\r\n        d3.select('#entity-id')\r\n            .on(\"keypress\", function() { if(d3.event.keyCode === 13) submitForm(); });\r\n\r\n        function isValidDate(d) {\r\n            return d instanceof Date && !isNaN(d);\r\n        }\r\n        \r\n        const isoDateTimeRegex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{1,7})?\\Z$/;\r\n        const ymdhmsfTimeParser = d3.utcParse(\"%Y-%m-%dT%H:%M:%S.%fZ\"); // microsecond precision parser\r\n        const ymdhmslTimeParser = d3.utcParse(\"%Y-%m-%dT%H:%M:%S.%LZ\"); // millisecond precision parser\r\n        const ymdhmsTimeParser = d3.utcParse(\"%Y-%m-%dT%H:%M:%SZ\");\r\n        function parseDateTime(dateString) {\r\n            if (isoDateTimeRegex.test(dateString))\r\n                return d3.isoParse(dateString) || dateString;\r\n            return dateString;\r\n        }\r\n        const ymdhmsfTimeFormatter = d3.utcFormat(\"%Y-%m-%d %I:%M:%S.%L %p\");\r\n        const ymdhmsTimeFormatter = d3.utcFormat(\"%Y-%m-%d %H:%M:%S\");\r\n        const hmslTimeFormatter = d3.utcFormat(\"%H:%M:%S.%L\");\r\n\r\n        // Cause toString'ed Date values to be rendered as ISO strings\r\n        Date.prototype.toString = Date.prototype.toISOString\r\n    \r\n        const latestCaseDetailsContainer = document.getElementById('case-details-latest');\r\n        const latestSlaDetailsContainer = document.getElementById('sla-details-latest');\r\n        const latestCaseTimerDetailsContainer = document.getElementById('case-timer-details-latest');\r\n        const timelineContainer = document.getElementById('timeline-chart');\r\n        const selectedCaseTimerLabel = document.getElementById('selected-case-timer-label');\r\n        const caseTimerEventDetailsContainer = document.getElementById('case-timer-event-details');\r\n        const caseTimerSnapshotDetailsContainer = document.getElementById('case-timer-snapshot-details');\r\n        const historicalSnapshotDetailsContainer = document.getElementById('snapshot-details-historical');\r\n        const historicalCaseDetailsContainer = document.getElementById('case-details-historical');\r\n        const historicalSlaDetailsContainer = document.getElementById('sla-details-historical');\r\n        const historicalCaseTimerDetailsContainer = document.getElementById('case-timer-details-historical');\r\n        \r\n        function shouldShowSnapshotJsonForSelectedItems() {\r\n            return d3.select('#should-show-snapshot-json-for-selected-items').property('checked');\r\n        }\r\n\r\n        executeFunctionWhenPredicateIsSatisfied(\r\n            () => window.Tooltip, \r\n            () => {\r\n                new Tooltip(document.getElementById('snapshot-reminder'), {\r\n                    placement: 'top', \r\n                    title: `Snapshot data represents the state of the case timer, SLA, etc. at the time of a snapshot. \r\n                        Live snapshots are captured <em>BEFORE</em> resolving case timer events and updating timer-related values (e.g. CaseTimer.ElapsedTime, SLA.TimeRemaining, etc.).  \r\n                        Derived snapshots are captured <em>during</em> case timer event resolution and represent intermediate states. \r\n                        This means that time-related values of each snapshot reflect the state of affairs as of the prior live snapshot.\r\n                        `, \r\n                    html: false,\r\n                    // This fixes a conflict with Bootstrap's usage of popper  (i.e. it sets the opacity to 0 by default in _tooltip.scss)\r\n                    popperOptions: {\r\n                        onCreate: function(p) {\r\n                            p.instance.popper.classList.add('show');\r\n                        }\r\n                    }\r\n                });\r\n            }, 1000, 100);\r\n\r\n\r\n        // =======================================================================================================================================================================\r\n        // Property Config fields:\r\n        //  priority (optional) - The priority of the field which indicates how important it is to show the field.  Range: 0(most important/always show) -> 6(least important)\r\n        //  propertyLabel - The label to display for the column header / field\r\n        //  propertyValueSelector - A function that returns the HTML content to be displayed, given the object\r\n        //  onClick - (optional) A click event handler which will be registered on the content.\r\n        // =======================================================================================================================================================================\r\n\r\n        // Case property configs\r\n        const casePropertyConfigs = [\r\n            { propertyLabel: \"Identifier\", propertyValueSelector: x => x.Identifier, onClick: null },\r\n            { propertyLabel: \"Id\", propertyValueSelector: x => x.Id, onClick: null },\r\n            //{ propertyLabel: \"Last Modified\", propertyValueSelector: x => x.LastModified, onClick: null },\r\n            \r\n            { propertyLabel: \"Owner\", propertyValueSelector: x => `${x.Owner.FirstName} ${x.Owner.LastName} (${x.Owner.Id})`, onClick: null },\r\n            { propertyLabel: \"Owner's Site\", propertyValueSelector: x => `${x.Owner.Site.Identifier} - ${x.Owner.Site.Name} (${x.Owner.Site.Id})`, onClick: null },\r\n            \r\n            { propertyLabel: \"Employee\", propertyValueSelector: x => `${x.Employee.FirstName} ${x.Employee.LastName} (${x.Employee.Id})`, onClick: null },\r\n            { propertyLabel: \"Owner's Primary Site\", propertyValueSelector: x => !x.Employee.PrimarySite ? '(none set)' : `${x.Employee.PrimarySite.Identifier} - ${x.Employee.PrimarySite.Name} (${x.Employee.PrimarySite.Id})`, onClick: null },\r\n        ];\r\n\r\n        // CaseTimer property configs\r\n        const caseTimerPropertyConfigs = [\r\n            { priority: 0, propertyLabel: \"#\", propertyValueSelector: x => x.OrdinalId, onClick: null },\r\n            { priority: 1, propertyLabel: \"Events\", propertyValueSelector: x => x.Events, onClick: ct => renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, []) },\r\n            { priority: 0, propertyLabel: \"Type\", propertyValueSelector: x => x.CaseTimerType, onClick: null },\r\n            { priority: 1, propertyLabel: \"Name\", propertyValueSelector: x => x.Name, onClick: null },\r\n            { priority: 2, propertyLabel: \"Current Effective Clock State\", propertyValueSelector: x => separateWordsInCamelCaseStringWithSpaces(x.CurrentEffectiveClockState), onClick: null },\r\n            { priority: 3, propertyLabel: \"Current NonWorking Time Period Types\", propertyValueSelector: x => x.CurrentNonWorkingTimePeriodTypes, onClick: null },\r\n            { priority: 5, propertyLabel: \"Show On Case\", propertyValueSelector: x => x.DisplayOnCase, onClick: null },\r\n            { priority: 4, propertyLabel: \"NonWorking Event Source\", propertyValueSelector: x => x.NonWorkingEventSource, onClick: null },\r\n            { priority: 5, propertyLabel: \"Respects\", propertyValueSelector: x => \r\n                [x.RespectNonWorkingSchedule ? \"<nobr>Non-Working Schedule</nobr>\" : null, \r\n                 x.RespectSlaClock ? \"<nobr>SLA Clock</nobr>\" : null, \r\n                 x.RespectWorkCalendar ? \"<nobr>Work Calendar</nobr>\" : null].filter(r => !!r).join(', '), onClick: null },\r\n            { priority: 2, propertyLabel: \"Elapsed Time (Offset + Run Time)\", propertyValueSelector: x => `${x.ElapsedTime} (${x.Offset} + ${x.RunTime})`, onClick: null },\r\n                // { propertyLabel: \"Offset\", propertyValueSelector: x => x.Offset, onClick: null },\r\n                // { propertyLabel: \"Run Time\", propertyValueSelector: x => x.RunTime, onClick: null },\r\n                // { propertyLabel: \"Elapsed Time\", propertyValueSelector: x => x.ElapsedTime, onClick: null },\r\n            { priority: 3, propertyLabel: \"Last Calculated\", propertyValueSelector: x => x.LastCalculated, onClick: null },\r\n            //{ propertyLabel: \"Last Modified\", propertyValueSelector: x => x.LastModified, onClick: null },\r\n            //{ propertyLabel: \"Is Active\", propertyValueSelector: x => x.IsActive, onClick: null },\r\n            { priority: 4, propertyLabel: \"Started Time\", propertyValueSelector: x => x.Started, onClick: null },\r\n            { priority: 4, propertyLabel: \"Stopped Time\", propertyValueSelector: x => x.Stopped, onClick: null },\r\n            { priority: 4, propertyLabel: \"Error Time\", propertyValueSelector: x => x.ErrorTime, onClick: null },\r\n            { priority: 6, propertyLabel: \"Id\", propertyValueSelector: x => x.Id, onClick: null },\r\n        ];\r\n\r\n        // SLA property configs\r\n        const slaPropertyConfigs = [\r\n            { priority: 1, propertyLabel: \"Respect SLA Pauses\", propertyValueSelector: x => x.RespectSlaPauses, onClick: null },\r\n            { priority: 1, propertyLabel: \"Sla Replacement Elapsed Time Allocation Policy\", propertyValueSelector: x => x.SlaReplacementElapsedTimeAllocationPolicy, onClick: null },\r\n            { priority: 1, propertyLabel: \"Status\", propertyValueSelector: x => x.Status, onClick: null },\r\n            { priority: 1, propertyLabel: \"Condition\", propertyValueSelector: x => x.Condition, onClick: null },\r\n            { priority: 1, propertyLabel: \"Color\", propertyValueSelector: x => x.SlaColor, onClick: null },\r\n            { priority: 1, propertyLabel: \"Paused\", propertyValueSelector: x => x.IsPaused, onClick: null },\r\n            { priority: 1, propertyLabel: \"Active\", propertyValueSelector: x => x.IsActive, onClick: null },\r\n\r\n            { priority: 1, propertyLabel: \"Target IR Duration\", propertyValueSelector: x => x.TargetInitialResponseDuration, onClick: null },\r\n            { priority: 1, propertyLabel: \"Is Target IR Defined\", propertyValueSelector: x => x.IsTargetInitialResponseDefined, onClick: null },\r\n            { priority: 1, propertyLabel: \"Time Until IR\", propertyValueSelector: x => x.TimeUntilInitialResponse, onClick: null },\r\n            { priority: 1, propertyLabel: \"Actual IR Time\", propertyValueSelector: x => x.ActualInitialResponseDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Expected IR Time\", propertyValueSelector: x => x.ExpectedInitialResponseDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"IR Breached Time\", propertyValueSelector: x => x.InitialResponseBreachedDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Has IR Target Breached\", propertyValueSelector: x => x.HasInitialResponseBreached, onClick: null },\r\n            { priority: 1, propertyLabel: \"Has IR Occurred\", propertyValueSelector: x => x.HasInitialResponseOccurred, onClick: null },\r\n\r\n            { priority: 1, propertyLabel: \"TR Duration\", propertyValueSelector: x => x.TargetResolutionDuration, onClick: null },\r\n            { priority: 1, propertyLabel: \"TR Time Remaining\", propertyValueSelector: x => x.TimeRemaining, onClick: null },\r\n            { priority: 1, propertyLabel: \"TR BreachedDate\", propertyValueSelector: x => x.TargetResolutionBreachedDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Estimated TR Time\", propertyValueSelector: x => x.EstimatedTargetResolutionDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Has TR Breached\", propertyValueSelector: x => x.HasTargetResolutionBreached, onClick: null },\r\n\r\n            { priority: 1, propertyLabel: \"Time Until Next CP\", propertyValueSelector: x => x.TimeUntilNextControlPoint, onClick: null },\r\n            { priority: 1, propertyLabel: \"Estimated Next CP Time\", propertyValueSelector: x => x.EstimatedNextControlPointDate, onClick: null },\r\n        ];\r\n\r\n        // Case Timer Event property configs\r\n        const caseTimerEventPropertyConfigs = [\r\n            { priority: 0, propertyLabel: \"#\", propertyValueSelector: x => x.OrdinalId, onClick: null },\r\n            { priority: 1, propertyLabel: \"Snapshot<br>(details)\", propertyValueSelector: d => d.CaseTimerSnapshot, onClick: cte => renderEventDetails(cte) },\r\n            { priority: 1, propertyLabel: \"Event Time\", propertyValueSelector: d => d.EventTime, onClick: null },\r\n            { priority: 1, propertyLabel: \"Event Identifier\", propertyValueSelector: d => d.EventIdentifierString, onClick: null },\r\n            { priority: 1, propertyLabel: \"App Id\", propertyValueSelector: d => d.AppIdentifier, onClick: null },\r\n            { priority: 4, propertyLabel: \"Is Derived\", propertyValueSelector: d => d.IsDerived, onClick: null },\r\n            { priority: 4, propertyLabel: \"Is Inherited\", propertyValueSelector: d => d.IsInherited, onClick: null },\r\n            { priority: 4, propertyLabel: \"Is Creation\", propertyValueSelector: d => d.IsCaseTimerCreationEvent, onClick: null },\r\n            { priority: 6, propertyLabel: \"Id\", propertyValueSelector: d => d.Id, onClick: null },\r\n            { priority: 5, propertyLabel: \"Snapshot<br>(JSON)\", propertyValueSelector: d => d.CaseTimerSnapshot, onClick: cte => displaySnapshotAsJson(cte.CaseTimerSnapshot) },\r\n            { priority: 5, propertyLabel: \"EventData<br>(JSON)\", propertyValueSelector: d => d.EventData, onClick: cte => displayEventDataAsJson(cte) },\r\n        ];\r\n\r\n        // Case Timer Snapshot property configs\r\n        const caseTimerSnapshotPropertyConfigs = [\r\n            { priority: 0, propertyLabel: \"#\", propertyValueSelector: x => x.OrdinalId, onClick: null },\r\n            { priority: 0, propertyLabel: \"Snapshot<br>(details)\", propertyValueSelector: d => d, onClick: cts => renderSnapshotDetails(cts) },\r\n            { priority: 0, propertyLabel: \"Snapshot Time\", propertyValueSelector: d => d.SnapshotTime, onClick: null },\r\n            { priority: 1, propertyLabel: \"Id\", propertyValueSelector: d => d.Id, onClick: null },\r\n            { priority: 6, propertyLabel: \"Is Derived\", propertyValueSelector: d => d.IsDerived, onClick: null },\r\n            { priority: 6, propertyLabel: \"Snapshot<br>(JSON)\", propertyValueSelector: d => d.SnapshotData, onClick: cts => displaySnapshotAsJson(cts) },\r\n        ];\r\n\r\n        var caseDataModel;\r\n        function getCaseDataModel() {\r\n            return caseDataModel;\r\n        }\r\n        self.getCaseDataModel = getCaseDataModel;\r\n\r\n        self.renderCaseData = renderCaseData;\r\n        self.renderCaseData(initialCaseData);\r\n\r\n        var timeline;\r\n\r\n\r\n\r\n        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n        // Other functions below\r\n\r\n        function renderCaseData(caseDataToRender) {\r\n            console.log(\"Unparsed case data to be rendered: \", caseDataToRender);\r\n\r\n            // Update visibility of sections\r\n            d3.select('#case-timer-event-viewer-error').visible(caseDataToRender === null);\r\n\r\n            // Validate input\r\n            if (!caseDataToRender) { /*alert('case data was not provided.');*/ return; }\r\n\r\n            let caseTimerTimelineData = null;\r\n            try {\r\n                caseTimerTimelineData = transformCaseDataToTimelineData(caseDataToRender);\r\n            } catch (error) {\r\n                d3.select('#case-timer-event-viewer-content').visible(caseTimerTimelineData !== null);\r\n                alert(\"Input data failed to be processed correctly.  See JS console for possible errors.\");\r\n                return;\r\n            }\r\n\r\n            d3.select('#case-timer-event-viewer-content').visible(caseTimerTimelineData !== null);\r\n\r\n            console.log(\"Case data: \", caseDataToRender);\r\n            console.log(\"Timeline data: \", caseTimerTimelineData);\r\n\r\n            // Render stuff\r\n            renderLatestCaseProperties(caseDataToRender);\r\n            renderLatestCaseTimersTable(caseDataToRender.Timers);\r\n            timeline = self.timeline = renderTimeline(timelineContainer, caseTimerTimelineData);\r\n\r\n            d3.select(selectedCaseTimerLabel).html('(no timer selected)');\r\n            emptyContainer(caseTimerEventDetailsContainer);\r\n            emptyContainer(caseTimerSnapshotDetailsContainer);\r\n            emptyContainer(historicalSnapshotDetailsContainer);\r\n            emptyContainer(historicalCaseDetailsContainer);\r\n            emptyContainer(historicalSlaDetailsContainer);\r\n            emptyContainer(historicalCaseTimerDetailsContainer);\r\n\r\n            caseDataModel = caseDataToRender;\r\n        }\r\n\r\n        function displayEventDataAsJson(caseTimerEvent)\r\n        {\r\n            createJsonViewerPopup( caseTimerEvent.EventData, `Data for Case Timer Event: ${caseTimerEvent.EventIdentifierString}`  );\r\n        }\r\n\r\n        function displaySnapshotAsJson(caseTimerSnapshot)\r\n        {\r\n            var cts = caseTimerSnapshot;\r\n\r\n            // Save and clear properties that are redundant or which would cause problems.\r\n            beforeSnapshotDataSerialized(cts.SnapshotData);\r\n\r\n            // These are the only fields we want to preserve for the visualization\r\n            var ssCopy = {\r\n                \"SnapshotTime\": cts.SnapshotTime,\r\n                \"OrdinalId\": cts.OrdinalId,\r\n                \"IsDerived\": cts.IsDerived,\r\n                \"SnapshotData\":  cts.SnapshotData,\r\n                \"UniqueId\": cts.UniqueId,\r\n                \"Id\": cts.Id,\r\n                \"LastModified\": cts.LastModified,\r\n            };\r\n            createJsonViewerPopup(ssCopy, `Case Timer Snapshot taken at ${formatDateTime(cts.SnapshotTime)} for timer '${cts.SnapshotData.CaseTimer.Name}'`);\r\n\r\n            // Restore values\r\n            afterSnapshotDataSerialized(cts.SnapshotData);\r\n        }\r\n\r\n        function displayEventDataAsJson(caseTimerEvent)\r\n        {\r\n            createJsonViewerPopup( caseTimerEvent.EventData, `Data for Case Timer Event: ${caseTimerEvent.EventIdentifierString}`  );\r\n        }\r\n\r\n        // The following 5 methods are adapted from CaseTimerSnapshotData.cs :\r\n        // - timerIsUsedBySlaInSnapshotData\r\n        // - beforeSnapshotDataSerialized\r\n        // - afterSnapshotDataDeserialized\r\n        // - afterSnapshotDataSerialized\r\n        // - shareSnapshotDataReferences\r\n\r\n        function timerIsUsedBySlaInSnapshotData(ssd) {\r\n            return ssd.Sla != null && ssd.CaseTimer.CaseTimerType === 'Sla' && (ssd.Sla.CaseTimerId == ssd.CaseTimer.Id || ssd.Sla.CaseTimerId == \"00000000-0000-0000-0000-000000000000\");\r\n        }\r\n\r\n        function beforeSnapshotDataSerialized(ssd) {\r\n            if (ssd.Sla != null)\r\n            {\r\n                if (!timerIsUsedBySlaInSnapshotData(ssd))\r\n                    console.log(\"Don't clear Sla.CaseTimer.\");\r\n\r\n                // If the CaseTimer is used by an SLA, and if that SLA is the SLA on this snapshot, then don't include redundant CaseTimer data on the SLA.\r\n                // If CaseTimer is not used by an SLA, but if there is an SLA on the case, then include the SLA's CaseTimer data, but don't include the Sla's CaseTimer's Case data.\r\n                if (timerIsUsedBySlaInSnapshotData(ssd))\r\n                {\r\n                    ssd.Sla.CaseTimer = \"(see SnapshotData.CaseTimer)\";\r\n                }\r\n                else\r\n                {\r\n                    ssd.Sla.CaseTimer.Case = \"(see SnapshotData.CaseTimer.Case)\";\r\n                }\r\n            }\r\n        }\r\n\r\n        function afterSnapshotDataDeserialized(ssd) {\r\n            shareSnapshotDataReferences(ssd);\r\n        }\r\n\r\n        function afterSnapshotDataSerialized(ssd) {\r\n            shareSnapshotDataReferences(ssd);\r\n        }\r\n\r\n        function shareSnapshotDataReferences(ssd) {\r\n            if (ssd.Sla != null)\r\n            {\r\n                if (!timerIsUsedBySlaInSnapshotData(ssd))\r\n                    console.log(\"Don't restore the CaseTimer to the Sla, because it doesn't belong.\");\r\n\r\n                // If the CaseTimer is used by an SLA, and if that SLA is the SLA on this snapshot, then share the CaseTimer data with the SLA.\r\n                // Otherwise, share the CaseTimer's Case reference with the Sla's CaseTimer.\r\n                if (timerIsUsedBySlaInSnapshotData(ssd))\r\n                {\r\n                    ssd.Sla.CaseTimer = ssd.CaseTimer;\r\n                }\r\n                else\r\n                {\r\n                    ssd.Sla.CaseTimer.Case = ssd.CaseTimer.Case;\r\n                }\r\n\r\n                // If CaseTimer is not used by an SLA, but if there is an SLA on the case, then share the Sla reference with the Sla's CaseTimer's Case.\r\n                if (ssd.Sla.CaseTimer.Case.Sla != ssd.Sla)\r\n                {\r\n                    ssd.Sla.CaseTimer.Case.Sla = ssd.Sla;\r\n                }\r\n            }\r\n        }\r\n\r\n        function renderTimeline(container, timelineData) {\r\n            emptyContainer(container);\r\n\r\n            var timeline = new TimelineChart(container, timelineData, {\r\n                //enableLiveTimer: true, \r\n                tipContentGenerator: generateTipHtmlContent,\r\n                groupHeight: 36,\r\n                groupWidth: 400\r\n            }); //.onVizChange(e => console.log(e));\r\n            d3.select('#reset-timeline-view').on('click', () => timeline.resetTransform())\r\n\r\n            // Resize container vertically to fit timeline\r\n            //d3.select(container).style(\"height\", null);\r\n            //var timelineHeight = d3.select(container).node().clientHeight;\r\n            //d3.select(container).style(\"height\", (timelineHeight)+\"px\");\r\n            return timeline;\r\n        }\r\n\r\n        function separateWordsInCamelCaseStringWithSpaces(str) {\r\n            return (str || '').replace(/([A-Z])/g, \" $1\").trim();\r\n        }\r\n\r\n        function formatDateTime(date) {\r\n            if (!date) return '';\r\n            // We will only display fractional seconds to ms precision, because JS's date doesn't support any greater precision than that.\r\n            return ymdhmsfTimeFormatter(date);\r\n        }\r\n\r\n        function formatDuration(later, earlier) {\r\n            var rem_ms = later - earlier;  // remaining ms\r\n            var ms = rem_ms % 1000;\r\n            var rem_s = Math.floor(rem_ms / 1000);  // seconds remaining\r\n            var s = rem_s % 60;  // integral seconds part\r\n            var rem_m = Math.floor(rem_s / 60);  // minutes remaining\r\n            var m = rem_m % 60;  // integral minutes part\r\n            var rem_h = Math.floor(rem_m / 60);  // hours remaining\r\n            var h = rem_h % 24;  // integral hours part\r\n            var rem_d = Math.floor(rem_h / 24);  // days remaining\r\n            var d = rem_d % 365;  // integral days part\r\n            var y = Math.floor(d / 365);  // integral years part\r\n\r\n            var parts = [\r\n                y ? `${y} year${y>1?'s':''}` : null,\r\n                d ? `${d} day${d>1?'s':''}` : null,\r\n                h ? `${h} hour${h>1?'s':''}` : null,\r\n                m ? `${m} minute${m>1?'s':''}` : null,\r\n                s ? `${s} second${s>1?'s':''}` : null\r\n            ].filter(x => x != null);\r\n            var durationString = parts.join(' ');\r\n            return durationString || ms+' ms';\r\n        }\r\n\r\n        /* Generate the HTML content of the tip for each timeline object from the following properties of each:\r\n            type:  Symbol - Should be either TimelineChart.TYPE.POINT or TimelineChart.TYPE.INTERVAL.\r\n            label:  string | function - HTML content (or function to generate the same) which BRIEFLY names/identifies the object.\r\n            details:  string | function - HTML content (or function to generate the same) which provides details about the object.\r\n        */\r\n        function generateTipHtmlContent(d) {\r\n            // if d.label is a fn, call it to generate tip label content.\r\n            var tipHeading = typeof(d.label) == 'function' ? formatLabelForTipHtml(d.label(d)+'') : typeof(d.label)=='string' ? formatLabelForTipHtml(d.label) : '(no label)';\r\n\r\n            var tipDetails = typeof(d.details) == 'function' ? d.details(d)+'' : typeof(d.details) == 'string' ? d.details : '';\r\n\r\n            // Auto-generate temporal description.  Include \"at\" time for points or from/to time range for intervals with label.\r\n            var temporalDescription = d.type == TimelineChart.TYPE.POINT ? 'Time: '+formatDateTime(d.at) : \r\n                'From: '+formatDateTime(d.from)+\r\n                '<br>To: '+formatDateTime(d.to)+\r\n                '<br>Duration: '+formatDuration(d.to, d.from);\r\n            var result = `\r\n                <div class=\"tip-heading h5\">${tipHeading}</div>\r\n                <div class=\"tip-body\">\r\n                <div>${temporalDescription}</div>\r\n                <div>${tipDetails}</div>\r\n                </div>`;\r\n            return result;\r\n        };\r\n\r\n        function formatLabelForTipHtml(label) {\r\n            return (label || '').replace(/ /g, '&nbsp;').replace(/\\\\n/g, '<br>');\r\n        };\r\n\r\n        // Returns a new string with all single and double quotes escaped, in order to ensure that it can be embedded into another string expression without causing problems.\r\n        // NOTE:  This won't detect if single or double quotes have already been escaped, so it could potentially double-escape them, which would defeat the purpose of this method.\r\n        function escapeQuotes(str) {\r\n            return str.replace(/'/g,\"\\\\'\").replace(/\"/g,'\\\\\"');\r\n        }\r\n\r\n        // Create a separate window to view the formatted JSON content of CaseTimerSnapshotData and CaseTimerEventData\r\n        function createJsonViewerPopup(objToView, heading) {\r\n            var objJson = JSON.stringify(objToView);\r\n            var html = `\r\n            <html>\r\n                <head>\r\n                    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor.css\" rel=\"stylesheet\" type=\"text/css\">\r\n                </head>\r\n                <body>\r\n                    <div id=\"jsoneditor\" style=\"width: 100%; height: 100%;\"></div>\r\n                    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor-minimalist.js\"><\\/script>\r\n                    <script>\r\n                        var editor = new JSONEditor(document.getElementById(\"jsoneditor\"), { mode: 'view', name: '${escapeQuotes(heading)}' }, ${objJson}); editor.expandAll();\r\n                    <\\/script>\r\n                </body>\r\n            </html>`;\r\n            createPopupWindowFromHtml(html, 'json-viewer-popup', 'width=800,height=1200');\r\n        }\r\n    \r\n        function createPopupWindowFromHtml(html, targetId, windowFeatures, windowTitle) {\r\n            var popup = window.open(\"\", targetId, windowFeatures, false);\r\n            var doc = popup.document;\r\n            doc.open();\r\n            doc.write(html);\r\n            doc.close();\r\n            doc.title = windowTitle;\r\n        }\r\n\r\n        function isUUID(value) {\r\n            var result = value.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n            return !!result && result.index === 0;\r\n        }\r\n\r\n\r\n        function emptyContainer(container)\r\n        {\r\n            // remove all child elements of the specified container\r\n            while (container.firstChild) {\r\n                container.removeChild(container.firstChild);\r\n            }\r\n        }\r\n\r\n        function renderLatestCaseProperties(caseDataToRender)\r\n        {\r\n            // Case properties\r\n            emptyContainer(latestCaseDetailsContainer);\r\n            renderProperties(latestCaseDetailsContainer, casePropertyConfigs, caseDataToRender);\r\n\r\n            // Sla properties\r\n            emptyContainer(latestSlaDetailsContainer);\r\n            renderProperties(latestSlaDetailsContainer, slaPropertyConfigs, caseDataToRender.Sla);\r\n        }\r\n\r\n        function renderLatestCaseTimersTable(allCaseTimers, selectedTimers)\r\n        {\r\n            emptyContainer(latestCaseTimerDetailsContainer);\r\n            renderTableOfObjects(latestCaseTimerDetailsContainer, caseTimerPropertyConfigs, allCaseTimers, selectedTimers);\r\n        }\r\n\r\n        // Both event and snapshot data details are treated as immutable, so we don't need to differentiate between latest/historical\r\n        function renderEventDetailsTableAndSnapshotDetailsTableFromEvents(allEvents, selectedEvents)\r\n        {\r\n            if (!allEvents || !allEvents.length) return;  // don't continue to display invalid data\r\n\r\n            var caseTimer = allEvents[0].CaseTimer;\r\n\r\n            // Identify snapshots corresponding to selected events\r\n            var snapshotsForSelectedEvents = selectedEvents.map(evt => evt.CaseTimerSnapshot);\r\n            var latestSnapshot = maxBy(selectedEvents.map(x => x.CaseTimerSnapshot), x => x.SnapshotTime);\r\n            \r\n            highlightNodesInTimeline(selectedEvents, snapshotsForSelectedEvents);\r\n\r\n            renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData(\r\n                allEvents, selectedEvents, caseTimer.Snapshots, snapshotsForSelectedEvents, latestSnapshot);\r\n        }\r\n\r\n        // Both event and snapshot objects are treated as immutable, so we don't need to differentiate between latest/historical\r\n        function renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots(snapshots, selectedSnapshots)\r\n        {\r\n            var caseTimerId = snapshots[0].SnapshotData.CaseTimer.Id;\r\n            var caseTimer = caseDataModel.CaseTimerMap.get(caseTimerId);\r\n\r\n            // Identify events corresponding to selected snapshots\r\n            // It's possible that no events are resolved for one of the given snapshot Id's.\r\n            var selectedEvents = selectedSnapshots.selectMany(ss => caseDataModel.EventsBySnapshotIdLookup.get(ss.Id) || []) || [];\r\n\r\n            highlightNodesInTimeline(selectedSnapshots, selectedEvents);\r\n\r\n            renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData(\r\n                caseTimer.Events, selectedEvents, snapshots, selectedSnapshots, firstOrDefault(selectedSnapshots));\r\n        }\r\n\r\n        function highlightNodesInTimeline(primaryItemsToHighlight, secondaryItemsToHighlight)\r\n        {\r\n            // generate array of primary point and interval ID's\r\n            var primaryIds = primaryItemsToHighlight\r\n                .map(x => ['p'+x.Id, 'i'+x.Id])\r\n                .reduce((accumulator, currentValue) => accumulator.concat(currentValue), []);\r\n            // generate array of secondary point and interval ID's\r\n            var secondaryIds = secondaryItemsToHighlight\r\n                .map(x => ['p'+x.Id, 'i'+x.Id])\r\n                .reduce((accumulator, currentValue) => accumulator.concat(currentValue), []);\r\n\r\n            // In the timeline, highlight the related point based on this snapshot\r\n            timeline.highlightNodeByIds(secondaryIds, false, 'chart-node-highlight-secondary');\r\n            timeline.highlightNodeByIds(primaryIds, true, 'chart-node-highlight-primary');\r\n        }\r\n\r\n        // Both event and snapshot objects are treated as immutable, so we don't need to differentiate between latest/historical\r\n        function renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData(events, selectedEvents, snapshots, selectedSnapshots, snapshotToUseForHistoricalData)\r\n        {\r\n            if (events && events.length) {\r\n                var ct = events[0].CaseTimer;\r\n                d3.select(selectedCaseTimerLabel).html(`Selected Timer #${ct.OrdinalId} for ${ct.CaseTimerType === 'CaseTimer' ? 'Case' : 'Sla'}: \"${ct.Name}\"`);\r\n            }\r\n            if (!snapshotToUseForHistoricalData && firstOrDefault(selectedSnapshots) != null)\r\n                snapshotToUseForHistoricalData = firstOrDefault(selectedSnapshots);\r\n            emptyContainer(caseTimerEventDetailsContainer);\r\n            emptyContainer(caseTimerSnapshotDetailsContainer);\r\n            sortBy(events, cte => cte.OrdinalId, true);\r\n            sortBy(snapshots, ss => ss.OrdinalId, true);\r\n            renderTableOfObjects(caseTimerEventDetailsContainer, caseTimerEventPropertyConfigs, events, selectedEvents);\r\n            renderTableOfObjects(caseTimerSnapshotDetailsContainer, caseTimerSnapshotPropertyConfigs, snapshots, selectedSnapshots);\r\n            renderHistoricalDataFromSnapshot(snapshotToUseForHistoricalData);\r\n\r\n            if (selectedSnapshots && selectedSnapshots.length > 0 && shouldShowSnapshotJsonForSelectedItems())\r\n            {\r\n                displaySnapshotAsJson(selectedSnapshots[0]);\r\n            }\r\n        }\r\n        \r\n        function renderEventDetails(caseTimerEvent)\r\n        {\r\n            // In the timeline, highlight the related point (and interval) based on this event\r\n            //timeline.highlightNodeByIds(['p'+caseTimerEvent.Id, 'i'+caseTimerEvent.Id], true, 'chart-node-highlight');\r\n\r\n            // Render any historical data associated with this event's snapshot\r\n            renderHistoricalDataFromSnapshot(caseTimerEvent.CaseTimerSnapshot);\r\n\r\n            // Refresh events/snapshots tables\r\n            renderEventDetailsTableAndSnapshotDetailsTableFromEvents(caseTimerEvent.CaseTimer.Events, [caseTimerEvent]);\r\n        }\r\n\r\n        function renderSnapshotDetails(caseTimerSnapshot)\r\n        {\r\n            var caseTimerId = caseTimerSnapshot.SnapshotData.CaseTimer.Id;\r\n            var snapshotsForTimer = caseDataModel.CaseTimerMap.get(caseTimerId).Snapshots;\r\n            \r\n            // In the timeline, highlight the related point based on this snapshot\r\n            //timeline.highlightNodeByIds('p'+caseTimerSnapshot.Id, true, 'chart-node-highlight');\r\n\r\n            // Render any historical data associated with this snapshot\r\n            renderHistoricalDataFromSnapshot(caseTimerSnapshot);\r\n\r\n            // Refresh events/snapshots tables\r\n            renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots(snapshotsForTimer, [caseTimerSnapshot]); \r\n        }\r\n\r\n        function renderHistoricalDataFromSnapshot(snapshot)\r\n        {\r\n            emptyContainer(historicalSnapshotDetailsContainer);\r\n            emptyContainer(historicalCaseDetailsContainer);\r\n            emptyContainer(historicalSlaDetailsContainer);\r\n            emptyContainer(historicalCaseTimerDetailsContainer);\r\n\r\n            if (!snapshot) return;\r\n\r\n            renderProperties(historicalSnapshotDetailsContainer, caseTimerSnapshotPropertyConfigs, snapshot);\r\n            renderProperties(historicalCaseDetailsContainer, casePropertyConfigs, snapshot.SnapshotData.CaseTimer.Case);\r\n            renderProperties(historicalSlaDetailsContainer, slaPropertyConfigs, snapshot.SnapshotData.CaseTimer.Case.Sla);\r\n\r\n            // For each case timer in effect, resolve the latest snapshot whose snapshot time is <= the current snapshot \r\n            var eligibleSnapshots = getCaseDataModel().Snapshots.filter(x => x.SnapshotTime <= snapshot.SnapshotTime);\r\n            var snapshotsGroupedByTimerId = d3.nest()\r\n                .key(d => d.SnapshotData.CaseTimer.Id)\r\n                .entries(eligibleSnapshots);\r\n            var latestSnapshotsByDistinctTimerId = snapshotsGroupedByTimerId\r\n                .map(g => ({ \r\n                    \"CaseTimerId\": g.key, \r\n                    \"CaseTimerSnapshot\": maxBy(g.values, _ => _.SnapshotTime*1) \r\n                }));\r\n            var caseTimersToDisplay = latestSnapshotsByDistinctTimerId.map(x => x.CaseTimerSnapshot.SnapshotData.CaseTimer);\r\n            renderTableOfObjects(historicalCaseTimerDetailsContainer, caseTimerPropertyConfigs, caseTimersToDisplay, []);\r\n        }\r\n\r\n        // Perform an in-place sort of array elements according to the \"value\" of the property returned by the specified selector.  Then, return the sorted array.\r\n        function sortBy(arr, ps, ascendingOrder) {\r\n            if (!arr) return [];\r\n            return arr.sort((a,b) => ps(a) < ps(b) ? -1 : ps(a) == ps(b) ? 0 : 1);\r\n        }\r\n\r\n        function distinctBy(arr, ps) {\r\n\r\n        }\r\n\r\n        function firstOrDefault(arr) {\r\n            if (!arr || arr.length == 0) return null;\r\n            return arr[0];\r\n        }\r\n\r\n        function withFirst(arr, fn) {\r\n            var first = firstOrDefault(arr);\r\n            if (first === null) return;\r\n            fn.call(this, first);\r\n        }\r\n\r\n        // Return the element of the specified array whose property selector produces the maximum value.\r\n        function maxBy(arr, ps) {\r\n            if (!arr || arr.length == 0) return null;\r\n            if (arr.length == 1) return arr[0];\r\n            var maxValue = ps(arr[0]);\r\n            var maxi = 0;\r\n            for (var i = 1; i < arr.length; i++)\r\n            {\r\n                var value = ps(arr[i]);\r\n                if (value > maxValue) { maxValue = value; maxi = i; }\r\n            }\r\n            return arr[maxi];\r\n        }\r\n\r\n        // Return the element of the specified array whose property selector produces the minimum value.\r\n        function minBy(arr, ps) {\r\n            if (!arr || arr.length == 0) return null;\r\n            if (arr.length == 1) return arr[0];\r\n            var minValue = ps(arr[0]);\r\n            var mini = 0;\r\n            for (var i = 1; i < arr.length; i++)\r\n            {\r\n                var value = ps(arr[i]);\r\n                if (value < minValue) { minValue = value; mini = i; }\r\n            }\r\n            return arr[mini];\r\n        }\r\n           \r\n        function renderTableOfObjects(tableContainer, propertyConfigs, itemsToRender, itemsToHighlight)\r\n        {\r\n            // itemsToRender is required and must contain data\r\n            if (!itemsToRender)\r\n            {\r\n                alert('renderTableOfObjects called with no data');\r\n                return;\r\n            }\r\n\r\n            itemsToHighlight = itemsToHighlight || [];\r\n\r\n            var table = d3.select(tableContainer).append('table')\r\n                //.classed('table', true);\r\n                .classed('tablesaw', true)\r\n                //.attr( 'data-tablesaw-mode', 'stack')\r\n                .attr('data-tablesaw-sortable', '')\r\n                .attr('data-tablesaw-sortable-switch', '')\r\n                .attr('data-tablesaw-minimap', '')\r\n                .attr('data-tablesaw-mode', 'columntoggle')\r\n                ;\r\n            var headerRow = table.append('thead').append('tr');\r\n            // render table header\r\n            propertyConfigs.forEach(pc => headerRow\r\n                .append('th')\r\n                .attr('data-tablesaw-sortable-col', '')\r\n                .attr('data-tablesaw-priority', pc.priority === 0 ? 'persist' : pc.priority)\r\n                .html(pc.propertyLabel));\r\n\r\n            var tbody = table.append('tbody');\r\n\r\n            itemsToRender.forEach(obj => {\r\n                var tr = tbody.append('tr')\r\n                    .classed('row-highlight', itemsToHighlight.findIndex(o => o == obj) != -1)\r\n                    .selectAll('td').data(propertyConfigs);\r\n                tr.enter().append('td')\r\n                    .call(sel => renderPropertyValue(sel, obj));\r\n            });\r\n\r\n            // Apply tablesaw features to table\r\n            initializeTableFeatures();\r\n\r\n            // attempt to scroll all highlighted items into view\r\n            var highlightedElements = table.selectAll('.row-highlight').nodes();\r\n            if (highlightedElements && highlightedElements[0] && highlightedElements[0].scrollIntoView)\r\n            {\r\n                // scroll the last highlighted element into view\r\n                highlightedElements[highlightedElements.length-1].scrollIntoView({ block: \"nearest\" });\r\n                // if more than 1 is highlighted, then scroll the first highlighted element into view\r\n                if (highlightedElements.length > 1)\r\n                    highlightedElements[0].scrollIntoView({ block: \"nearest\" });\r\n            }\r\n        }\r\n\r\n        function renderPropertyValue(d3SelectionBoundToPropertyConfig, objectWithProperties) {\r\n            var obj = objectWithProperties;\r\n            d3SelectionBoundToPropertyConfig\r\n                .attr('data-title', d => d.propertyLabel)\r\n                .html(d => getHtmlContentForPropertyValue(d, obj))\r\n                .on('click', d => { \r\n                    if (typeof(d.onClick) == 'function') d.onClick(obj);\r\n                });\r\n        }\r\n\r\n        function renderProperties(parentElement, propertyConfigs, obj)\r\n        {\r\n            if (!obj)\r\n                d3.select(parentElement).appendHTML('<div> No data exists. </div>');\r\n            else\r\n                d3.select(parentElement)\r\n                    .selectAll('div').data(propertyConfigs)\r\n                    .enter().append('div')\r\n                    .call(pc => renderPropertyLabelAndValue(pc, obj));\r\n        }\r\n\r\n        function renderPropertyLabelAndValue(d3SelectionBoundToPropertyConfig, objectWithProperties)\r\n        {\r\n            let propertyWrapper = d3SelectionBoundToPropertyConfig\r\n                .append('div')\r\n                .attr('class', 'property-label-and-value');\r\n            let labelElement = propertyWrapper\r\n                .append('div')\r\n                .attr('class', 'property-label')\r\n                .html(pc => pc.propertyLabel)\r\n            let valueElement = propertyWrapper\r\n                .append('div')\r\n                .attr('class', 'property-value')\r\n                .call(pc => renderPropertyValue(pc, objectWithProperties));\r\n        }\r\n\r\n        function getHtmlContentForPropertyValue(propertyConfig, obj)\r\n        {\r\n            var propertyValue = propertyConfig.propertyValueSelector(obj);\r\n\r\n            if (propertyValue === undefined)\r\n            {\r\n                return \"\";\r\n            }\r\n            else if (propertyValue === null)\r\n            {\r\n                return \"(null)\";\r\n            }\r\n            else if (typeof propertyValue == 'number')\r\n            {\r\n                return propertyValue;\r\n            }\r\n            else if (typeof propertyValue == 'string')\r\n            {\r\n                //if (isUUID(propertyValue))\r\n                //    return \"<span title='\"+propertyValue+\"'>\"+propertyValue.substring(0, 7)+\"...</span>\";\r\n                return propertyValue;\r\n            }\r\n            else if (typeof propertyValue == 'boolean')\r\n            {\r\n                return \"<input type='checkbox' \"+(!!propertyValue ? \"checked\" : \"\")+\" onclick='return false;' />\";\r\n            }\r\n            else if (propertyValue.constructor == (new Date()).constructor)\r\n            {\r\n                return formatDateTime(propertyValue);\r\n            }\r\n            else if(!!propertyConfig.onClick)\r\n            {\r\n                return `<button class=\"btn btn-sm btn-${propertyConfig.priority < 3 ? 'primary' : 'secondary'}\">View</button>`;\r\n            }\r\n            return '<em>(no value resolver defined for this type)</em>'\r\n        }\r\n\r\n        function restoreReferencesInCaseTimerObjectGraph(caseTimerArray)\r\n        {\r\n            // normalize data\r\n            caseTimerArray.forEach(ct => \r\n            {\r\n                ct.Snapshots.forEach(ss => {\r\n                    afterSnapshotDataDeserialized(ss.SnapshotData);\r\n                });\r\n                var snapshotsById = d3.map(ct.Snapshots, ss => ss.Id);\r\n\r\n                ct.Events.forEach(e => \r\n                {\r\n                    // link the case timer events to the case timer that it belongs to\r\n                    e.CaseTimer = ct;\r\n                    e.CaseTimerSnapshot = snapshotsById.get(e.CaseTimerSnapshot.Id);\r\n\r\n                    //afterSnapshotDataDeserialized(e.CaseTimerSnapshot.SnapshotData);\r\n                });\r\n            });\r\n        }\r\n\r\n        // Convert date strings to date objects\r\n        function normalizeDatesRecursively(input) {\r\n            var eachRecursive = function(obj)\r\n            {\r\n                d3.map(obj).each((val, key) => {\r\n                    if (!!val)\r\n                    {\r\n                        if (typeof val === \"object\") eachRecursive(val);\r\n                        // Parse string into a Date object, or leave the string unchanged.\r\n                        if (typeof val === \"string\") obj[key] = parseDateTime(val);\r\n                    }\r\n                });\r\n            }\r\n            eachRecursive(input);\r\n        }\r\n\r\n        function transformCaseDataToTimelineData(caseDataToTransform)\r\n        {\r\n            if (!caseDataToTransform.Timers.length) return [];\r\n            \r\n            // Ensure that timers are ordered by when they were started\r\n            let caseTimerArray = sortBy(caseDataToTransform.Timers, _ => _.Started);\r\n\r\n            // Iterate over timers to set an ordinal ID and to sort events on each\r\n            var ordinalId = 1;\r\n            caseTimerArray.forEach(ct => {\r\n                ct.OrdinalId = ordinalId++;\r\n                sortBy(ct.Events, _ => _.EventTime);\r\n            });\r\n\r\n            normalizeDatesRecursively(caseDataToTransform);\r\n\r\n            //restoreReferencesInCaseTimerObjectGraph(caseTimerArray);\r\n\r\n            // Flatten the events.  This will be a list of all events for the case.\r\n            var allEvents = caseTimerArray.selectMany(t => t.Events);\r\n            // Flatten the events.  This will be a list of all snapshots for the case.\r\n            var allSnapshots = caseTimerArray.selectMany(t => t.Snapshots);\r\n\r\n            // Create a D3 map of case timer Id to case timer (distinct values only)\r\n            caseDataToTransform.CaseTimerMap = d3.map(caseDataToTransform.Timers, ct => ct.Id);\r\n            // Create a D3 map of snapshot Id to snapshot (distinct values only).\r\n            caseDataToTransform.SnapshotMap = d3.map(allSnapshots, cts => cts.Id);\r\n\r\n            // Fix links within each snapshot data\r\n            allSnapshots.forEach(ss => {\r\n                afterSnapshotDataDeserialized(ss.SnapshotData);\r\n            });\r\n\r\n            // Link each case timer event to the case timer that it belongs to\r\n            caseTimerArray.forEach(ct => {\r\n                ct.Events.forEach(e => e.CaseTimer = ct);\r\n            });\r\n\r\n            // Convert CaseTimerSnapshot shallow references to references to objects\r\n            allEvents.forEach(cte => {\r\n                cte.CaseTimerSnapshot = caseDataToTransform.SnapshotMap.get(cte.CaseTimerSnapshot.Id)\r\n            });\r\n            // Make array of snapshots accessible from case data.\r\n            caseDataToTransform.Snapshots = sortBy(caseDataToTransform.SnapshotMap.values(), ss => ss.SnapshotTime, true);\r\n            // Set snapshots array on each case timer object (to facilitate access later)\r\n            caseTimerArray.forEach(ct => ct.Snapshots = sortBy(ct.Snapshots, ss => ss.SnapshotTime, true));\r\n            // Create a D3 nested map from case timer snapshot Id to events\r\n            caseDataToTransform.EventsBySnapshotIdLookup = d3.nest().key(cte => cte.CaseTimerSnapshot.Id).map(allEvents);\r\n\r\n\r\n\r\n            var allTimelineSeriesForAllTimers = caseTimerArray.map(ct => \r\n            {\r\n                // for each case timer, this returns an array of data series, each of which can be plotted on the timeline\r\n\r\n                // Create timeline point data from case timer events, grouped by event time.\r\n                // As we group these events by EventTime into points, we have to treat the EventTime as an integral number of milliseconds.\r\n                // Otherwise, the milliseconds will be lost if we just use the EventTime (Date), because the d3.nest.key resolver will convert the returned object into a string.\r\n                var caseTimerEventPoints = (d3.nest().key(cte => cte.EventTime*1).entries(ct.Events))\r\n                    // map d3 groupings (of { key: \"\", values: [] }) into an array of points for the timeline\r\n                    .map(d => {\r\n                        var timeOfEvents = new Date(d.key*1);\r\n                        var eventsAtTime = d.values;\r\n                        // Create point data structure\r\n                        var pointObj = {\r\n                            type: TimelineChart.TYPE.POINT,\r\n                            //customClass: 'point-white',\r\n                            label: function(){ \r\n                                return `${eventsAtTime.length} Event${eventsAtTime.length == 1 ? '' : 's'}` + \r\n                                    eventsAtTime.map(e => `<br>📅 ${e.EventIdentifierString}`).join('');\r\n                            },\r\n                            at: timeOfEvents,\r\n                            data: d.values,\r\n                            ids: d.values.map(p => 'p'+p.Id),  // event guids will serve as the ids\r\n                            onClick: function(){\r\n                                //timeline.highlightNodeByIds('p'+d.values[0].Id, true, 'chart-node-highlight');\r\n                                renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, eventsAtTime); \r\n                            }\r\n                        };\r\n                        // Set the point reference on each event object.  (NOTE: each event should belong to 1 and only 1 point.)\r\n                        d.values.forEach(evt => evt.point = pointObj);\r\n                        return pointObj;\r\n                    });\r\n\r\n                // Create initial series for timer which will contain points for all case timer events\r\n                var timerEventsSeries = {\r\n                    label: `${ct.OrdinalId}. Events for ${ct.CaseTimerType}: [${ct.Name}]`,\r\n                    groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                    data: caseTimerEventPoints\r\n                };\r\n\r\n                // Create timeline point data from case timer snapshots, grouped by snapshot time.\r\n                // As we group these events by SnapshotTime into points, we have to treat the SnapshotTime as an integral number of milliseconds.\r\n                // Otherwise, the milliseconds will be lost if we just use the SnapshotTime (Date), because the d3.nest.key resolver will convert the returned object into a string.\r\n                var caseTimerSnapshotPoints = (d3.nest().key(cts => cts.SnapshotTime*1).entries(ct.Snapshots))\r\n                    // Map d3 groupings (of { key: \"\", values: [] }) into an array of points for the timeline\r\n                    .map(d => {\r\n                        var snapshotTime = new Date(d.key*1); // convert key from string to a number to a date\r\n                        var snapshotsAtTime = d.values;\r\n\r\n                        function generateSnapshotTipHtmlDetails(snapshots) {\r\n                            // the current snapshot to use for this point\r\n                            var ss = snapshots.find(ss => !ss.IsDerived) || snapshots[0];\r\n                            // resolve a non-derived snapshot from the current snapshot or a subsequent snapshot\r\n                            var ndss = !ss.IsDerived ? ss : ss.SubsequentNonDerivedSnapshot;\r\n                            if (!ndss) return '';\r\n                            var timer = ndss.SnapshotData.CaseTimer;\r\n                            var timerInfo = !timer ? '' : `\r\n                                <div class=\"h6 mt-1 mb-0\"> Timer <span class=\"badge badge-secondary\">${timer.Id}</span> </div>\r\n                                State: ${timer.CurrentEffectiveClockState}<br>\r\n                                Current NWTP Types: ${timer.CurrentNonWorkingTimePeriodTypes}<br>\r\n                                Elapsed Time: ${timer.ElapsedTime} (${timer.Offset} + ${timer.RunTime})<br>\r\n                                Last Calculated: ${formatDateTime(timer.LastCalculated)}<br>\r\n                            `;\r\n                            var sla = ndss.SnapshotData.Sla;\r\n                            // Don't generate content for the SLA section if the SLA's timer doesn't match the timer above. This only \r\n                            // happens when an SLA is replaced with a new one. \r\n                            var slaInfo = !sla || (sla.CaseTimerId != \"00000000-0000-0000-0000-000000000000\" && sla.CaseTimerId != timer.Id) ? '' : `\r\n                                <div class=\"h6 mt-1 mb-0\"> SLA <span class=\"badge badge-secondary\">${sla.Id}</span> </div>\r\n                                Status: ${sla.Status}<br>\r\n                                If replaced, remaining time allocation policy:  ${sla.SlaReplacementElapsedTimeAllocationPolicy}<br>\r\n                                <table class=\"table table-sm\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th scope=\"col\"></th>\r\n                                            <th scope=\"col\">Target Duration</th>\r\n                                            <th scope=\"col\">Duration Remaining</th>\r\n                                            <th scope=\"col\">Estimated DateTime</th>\r\n                                            <th scope=\"col\">Breached?</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr>\r\n                                            <th scope=\"row\">SLA Initial Response</th>\r\n                                            <td>${sla.TargetInitialResponseDuration}</td>\r\n                                            <td>${sla.TimeUntilInitialResponse || ''}</td>\r\n                                            <td>${formatDateTime(sla.ExpectedInitialResponseDate)}</td>\r\n                                            <td>${sla.HasInitialResponseBreached}</td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <th scope=\"row\">SLA Target Resolution</th>\r\n                                            <td>${sla.TargetResolutionDuration}</td>\r\n                                            <td>${sla.TimeRemaining || ''}</td>\r\n                                            <td>${formatDateTime(sla.EstimatedTargetResolutionDate)}</td>\r\n                                            <td>${sla.HasTargetResolutionBreached}</td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <th scope=\"row\">Next Control Point</th>\r\n                                            <td></td>\r\n                                            <td>${sla.TimeUntilNextControlPoint || 'n/a'}</td>\r\n                                            <td>${formatDateTime(sla.EstimatedNextControlPointDate)}</td>\r\n                                            <td></td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n                                `;\r\n                            return `<div class=\"h6 mt-1 mb-0\"> Snapshot <span class=\"badge badge-secondary\">${ss.Id}</span> </div>\r\n                                    <div><em>The following data comes from ${ss == ndss ? 'the state of this non-derived snapshot' : `subsequent non-derived snapshot ${ndss.Id}`}.</em></div>\r\n                                    ${timerInfo}\r\n                                    ${slaInfo}\r\n                                    ${ss.IsDerived ? '<div><strong><em>NOTE: Because this snapshot is derived, the times above are probably inaccurate.  They actually describe the state of affairs as of the subsequent non-derived snapshot.</em></strong></div>' : ''}\r\n                                    `;\r\n                        }\r\n                        // Create point data structure\r\n                        var pointObj = {\r\n                            type: TimelineChart.TYPE.POINT,\r\n                            //customClass: 'point-white',\r\n                            label: function() {\r\n                                // resolve first snapshot that is not derived (or just use the first one of the group)\r\n                                // NOTE:  This assumes that we won't have > 1 snapshot for a given point in time.\r\n                                var ss = snapshotsAtTime.find(ss => !ss.IsDerived) || snapshotsAtTime[0];\r\n                                return `📷 ${ss.IsDerived ? 'Derived' : 'Live'} Snapshot ${ss.OrdinalId}`;\r\n                            },\r\n                            details : function() { return generateSnapshotTipHtmlDetails(snapshotsAtTime); },\r\n                            at: snapshotTime,\r\n                            data: d.values,\r\n                            ids: d.values.map(p => 'p'+p.Id),  // snapshot guids will serve as the ids\r\n                            onClick: function(){ \r\n                                //timeline.highlightNodeByIds('p'+d.values[0].Id, true, 'chart-node-highlight');\r\n                                renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots(ct.Snapshots, snapshotsAtTime); \r\n                            }\r\n                        };\r\n                        // Set the point reference on each event object.  (NOTE: each event should belong to 1 and only 1 point.)\r\n                        d.values.forEach(evt => evt.point = pointObj);\r\n                        return pointObj;\r\n                    });\r\n\r\n                var timerSnapshotsSeries = {\r\n                    label: `Case Timer Snapshots`,\r\n                    groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                    data: caseTimerSnapshotPoints\r\n                };\r\n\r\n                var now = new Date();\r\n                var intervalConfigs = [\r\n                    {\r\n                        key: \"TimeAccrualIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"TimeAccrualInterval\",\r\n                        groupLabelFn: evt => \"Time Accrued\",\r\n                        intervalLabelFn: evt => \"Clock Running\",\r\n                        startEventId: \"TimerStartedAccruingTime\",\r\n                        endEventId: \"TimerStoppedAccruingTime\",\r\n                        intervalType: \"TimeAccrualInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"FollowingSlaIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"FollowingSlaInterval\",\r\n                        groupLabelFn: evt => \"Following SLA\",\r\n                        intervalLabelFn: evt => \"Following SLA\",\r\n                        startEventId: \"CaseTimerStartedFollowingSla\",\r\n                        endEventId: \"CaseTimerStoppedFollowingSla\",\r\n                        intervalType: \"FollowingSlaInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"NonworkingScheduledTimePeriodIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"NonworkingScheduledTimePeriodInterval-\"+evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceId,\r\n                        groupLabelFn: evt => \"Non-working Scheduled Time Period: \"+evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        intervalLabelFn: evt => \"Non-working Scheduled Time Period: \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        startEventId: \"Temporal:NonworkingScheduledTimePeriodBegan\",\r\n                        endEventId: \"Temporal:NonworkingScheduledTimePeriodEnded\",\r\n                        intervalType: \"NonworkingScheduledTimePeriodInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"SlaPauseIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"SlaPauseInterval-\"+evt.EventData.TemporalEventArgs.SourceId,\r\n                        groupLabelFn: evt => \"SLA Pause for \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        intervalLabelFn: evt => \"SLA Pause for \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        startEventId: \"Temporal:SlaPauseBegan\",\r\n                        endEventId: \"Temporal:SlaPauseEnded\",\r\n                        intervalType: \"SlaPauseInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"OffWorkTimePeriodIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"OffWorkTimePeriodInterval-\"+evt.EventData.TemporalEventArgs.SourceId,\r\n                        groupLabelFn: evt => \"Off-work time period for \"+evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceNameName,\r\n                        intervalLabelFn: evt => \"Off-work time period for \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        startEventId: \"Temporal:WorkPeriodEnded\",\r\n                        endEventId: \"Temporal:WorkPeriodBegan\",\r\n                        intervalType: \"OffWorkTimePeriodInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                ];\r\n\r\n                // Define a function to create a grouping key from an event.  Each event will end up in at most 1 group.\r\n                let eventIntervalGroupingKeyFn = evt => {\r\n                    // find the first interval config that matches, cand call it's fn to generate the grouping key.\r\n                    var matchingIntervalConfig = intervalConfigs.find(ic => evt.EventIdentifierString.includes(ic.startEventId) || evt.EventIdentifierString.includes(ic.endEventId));\r\n                    if (!matchingIntervalConfig)\r\n                        return \"REMOVE\";\r\n                    //evt.intervalConfig = matchingIntervalConfig;  // attach this to the event here, so we don't have to resolve it again later\r\n                    return matchingIntervalConfig.key+\"::\"+matchingIntervalConfig.intervalSeriesEventGroupingKeyFn(evt);\r\n                };\r\n\r\n                // Create an array of interval groups\r\n                // Using D3.nest and the event interval grouping fn, create a series of time intervals for each distinct group of data for this timer\r\n                let timerIntervalSeriesArray = d3.nest()\r\n                    .key(eventIntervalGroupingKeyFn).entries(ct.Events)\r\n                    .filter(o => o.key != \"REMOVE\") // exclude all interval groups that yield a key of \"REMOVE\"\r\n                    .map(intervalGroup => {\r\n\r\n                        // extract the interval config key from the first part of the key\r\n                        var intervalConfigKey = intervalGroup.key.split('::')[0];\r\n                        // resolve the associated interval config using its key\r\n                        var intervalConfig = intervalConfigs.find(ic => ic.key == intervalConfigKey);\r\n\r\n                        // Ensure that the events of interest are sorted, so that intervals start and stop when appropriate.\r\n                        var eventsOfInterest = intervalGroup.values.sort((a,b) => a.EventTime*1 - b.EventTime*1);\r\n\r\n                        // Create intervals for this group from the events\r\n                        let intervals = [];\r\n                        for(var i = 0; i < eventsOfInterest.length; i += 2)\r\n                        {\r\n                            let curEvt = eventsOfInterest[i];\r\n                            let nextEvt = eventsOfInterest.length > i + 1 ? eventsOfInterest[i + 1] : null;\r\n                            let ic = intervalConfig;\r\n\r\n                            // Create and add interval object\r\n                            var intervalObj = {\r\n                                type: TimelineChart.TYPE.INTERVAL,\r\n                                intervalType: ic.intervalType,\r\n                                customClass: ic.customClass,\r\n                                label: ic.intervalLabelFn(curEvt),\r\n                                from: parseDateTime(curEvt.EventTime)\r\n                            };\r\n                            if (nextEvt != null)\r\n                            {\r\n                                // if both endpoints of interval are known\r\n                                intervalObj = Object.assign({\r\n                                    to: parseDateTime(nextEvt.EventTime),\r\n                                    data: [curEvt, nextEvt],\r\n                                    ids: ['i'+curEvt.Id, 'i'+nextEvt.Id],  // starting/ending event guids will serve as the ids\r\n                                    onClick: function(){ \r\n                                        //timeline.highlightNodeByIds('i'+curEvt.Id, true, 'chart-node-highlight');\r\n                                        renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                        renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, [curEvt, nextEvt]);\r\n                                    } \r\n                                }, intervalObj);\r\n                                nextEvt.interval = intervalObj;\r\n                            }\r\n                            else\r\n                            {\r\n                                // if only the starting time is known, the end time will be \"now\"\r\n                                intervalObj = Object.assign({\r\n                                    to: now,\r\n                                    data: [curEvt],\r\n                                    ids: ['i'+curEvt.Id ],  // starting event guid will serve as the id\r\n                                    onClick: function(){\r\n                                        //timeline.highlightNodeByIds('i'+curEvt.Id, true, 'chart-node-highlight');\r\n                                        renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                        renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, [curEvt]);\r\n                                    } \r\n                                }, intervalObj);\r\n                            }\r\n                            curEvt.interval = intervalObj; // Set the interval reference on the event object.  (NOTE: no event should be a member of > 1 interval.)\r\n                            intervals.push(intervalObj);\r\n                        }\r\n\r\n                        // return a new interval series\r\n                        return {\r\n                            label: intervalConfig.groupLabelFn(intervalGroup.values[0]),\r\n                            groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                            data: intervals\r\n                        };\r\n                    });\r\n                //console.log(\"timerIntervalSeriesArray: \", timerIntervalSeriesArray);\r\n                // End grouping of intervals\r\n\r\n\r\n                // Order and assign OrdinalId to Snapshots\r\n                ct.Snapshots.sort((a,b) => {\r\n                    // primary sort key is the snapshot time\r\n                    if (a.SnapshotTime < b.SnapshotTime) return -2;\r\n                    if (a.SnapshotTime > b.SnapshotTime) return 2;\r\n\r\n                    // secondary sort key is the modified time\r\n                    if (a.LastModified < b.LastModified) return -1;\r\n                    if (a.LastModified > b.LastModified) return 1;\r\n\r\n                    return 0;\r\n                });\r\n                // Number the snapshots\r\n                ct.Snapshots.forEach((ss, i) => { ss.OrdinalId = i+1; });\r\n\r\n                // This will represent the final non-derived state of the timer, for the purposes of displaying calculated times for each snapshot.\r\n                var subsequentNonDerivedSnapshot = {\r\n                    SnapshotTime: new Date(),\r\n                    OrdinalId: ct.Snapshots.length + 1,\r\n                    IsDerived: false,\r\n                    LastModified: new Date(),\r\n                    Id: null,\r\n                    SnapshotData: {\r\n                        CaseTimer: {\r\n                            CurrentEffectiveClockState: ct.CurrentEffectiveClockState,\r\n                            CurrentNonWorkingTimePeriodTypes: ct.CurrentNonWorkingTimePeriodTypes,\r\n                            ElapsedTime: ct.ElapsedTime,\r\n                            Offset: ct.Offset,\r\n                            RunTime: ct.RunTime,\r\n                            LastCalculated: ct.LastCalculated\r\n                        }\r\n                    }\r\n                };\r\n                // For each snapshot, add a reference to the subsequent non-deried snapshot.\r\n                var snapshotsReversed = ct.Snapshots.slice(0).reverse();\r\n                snapshotsReversed.forEach(ss => {\r\n                    ss.SubsequentNonDerivedSnapshot = subsequentNonDerivedSnapshot;\r\n                    if (!ss.IsDerived) subsequentNonDerivedSnapshot = ss;\r\n                });\r\n                // For each snapshot, add a reference to the prior non-deried snapshot.\r\n                var priorNonDerivedSnapshot = {};\r\n                ct.Snapshots.forEach(ss => {\r\n                    ss.PriorNonDerivedSnapshot = priorNonDerivedSnapshot;\r\n                    if (!ss.IsDerived) priorNonDerivedSnapshot = ss;\r\n                });\r\n\r\n\r\n                // TODO:  Fix overlapping calculation intervals below\r\n                // Create series for calculation intervals\r\n                var calculationIntervalsSeries = {\r\n                    label: `Calculation Intervals`,\r\n                    groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                    data: []\r\n                };\r\n                ct.Snapshots.filter(x => !x.IsDerived)\r\n                    .forEach(ss => {\r\n                        var curSD = ss.SnapshotData;\r\n                        var nextSD = ss.SubsequentNonDerivedSnapshot.SnapshotData;\r\n                        var intervalObj = {\r\n                            type: TimelineChart.TYPE.INTERVAL,\r\n                            intervalType: 'CalculationInterval',\r\n                            customClass: '', //ic.customClass,\r\n                            label: '', //ic.intervalLabelFn(curEvt),\r\n                            from: curSD.CaseTimer.LastCalculated || curSD.CaseTimer.Started,\r\n                            to: nextSD.CaseTimer.LastCalculated,\r\n                            data: [curSD, nextSD],\r\n                            ids: [],\r\n                            onClick: null\r\n                        };\r\n                        // If interval is valid\r\n                        if (!!intervalObj.from && !!intervalObj.to)\r\n                            calculationIntervalsSeries.data.push(intervalObj);\r\n                    });\r\n\r\n                \r\n                // Order and assign OrdinalId to Events\r\n                // Getting events sorted in an intuitive way is more complex than one might suppose.\r\n                // Here, we sort by the following things, in this particular order:\r\n                //  1. event date\r\n                //  2. intervals that each event is a part of\r\n                //  3. related snapshot time\r\n                var getIntervalPointAvgDate = p => p.type === TimelineChart.TYPE.POINT ? p.at : new Date(p.from * 1 + (p.to - p.from)/2);\r\n                ct.Events.sort((a,b) => {\r\n                    // primary sort key is the event time\r\n                    if (a.EventTime < b.EventTime) return -3;\r\n                    if (a.EventTime > b.EventTime) return 3;\r\n                    \r\n                    // tertiary sort key is the related snapshot time\r\n                    if (a.CaseTimerSnapshot.SnapshotTime*1 < b.CaseTimerSnapshot.SnapshotTime*1) return -2;\r\n                    if (a.CaseTimerSnapshot.SnapshotTime*1 > b.CaseTimerSnapshot.SnapshotTime*1) return 2;\r\n\r\n                    // secondary sort key is the related interval time\r\n                    var aAvgDate = getIntervalPointAvgDate(a.interval || a.point);\r\n                    var bAvgDate = getIntervalPointAvgDate(b.interval || b.point);\r\n                    if (aAvgDate < bAvgDate) return -1;\r\n                    if (aAvgDate > bAvgDate) return 1;\r\n\r\n                    return 0;\r\n                });\r\n                // Number the events\r\n                ct.Events.forEach((evt, i) => { evt.OrdinalId = i+1; });\r\n\r\n                var allSeriesForTimer = [ timerEventsSeries, timerSnapshotsSeries, calculationIntervalsSeries].concat(timerIntervalSeriesArray);\r\n\r\n                return allSeriesForTimer;\r\n            })\r\n            // Now flatten the array of timeline data series arrays into a single array of TDS.\r\n            .reduce((accumulator, currentValue) => accumulator.concat(currentValue));\r\n\r\n            // At this point, there will be multiple series associated with each timer.\r\n            // We want to provide some sort of visual grouping mechanism so that all series associated with the same case timer can be visually grouped.\r\n            // Transform the group key to a 0-based index.\r\n            var newGroupNumber = 0;\r\n            var lastGroupKey = \"----------------\";\r\n            allTimelineSeriesForAllTimers.forEach((x) => {\r\n                if (lastGroupKey != x.groupingKey)\r\n                {\r\n                    lastGroupKey = x.groupingKey;\r\n                    newGroupNumber++;\r\n                }\r\n                x.groupingKey = newGroupNumber;\r\n            });\r\n\r\n            //console.log(\"TimelineSeries: \", allTimelineSeriesForAllTimers);\r\n            return allTimelineSeriesForAllTimers;\r\n        }\r\n\r\n    }\r\n\r\n    updateTimelineData(newCaseData) {\r\n        this.renderCaseData(newCaseData);\r\n    }\r\n\r\n}\r\n\r\n\r\nmodule.exports = CaseTimerEventViewer;\r\n\r\n"]}