{"version":3,"sources":["case-timer-event-viewer.js"],"names":["CaseTimerEventViewer","element","initialCaseData","opts","self","Array","prototype","selectMany","memberArraySelectorFn","length","map","reduce","a","b","concat","d3","selection","appendHTML","HTMLString","select","appendChild","document","importNode","DOMParser","parseFromString","body","childNodes","hide","style","show","visible","value","undefined","loadScriptFile","src","createElement","loadCssFile","rel","type","href","head","executeFunctionWhenPredicateIsSatisfied","boolPredicate","fn","initialWaitInMs","subsequentWaitInMs","task","setTimeout","window","Popper","initializeTableFeatures","Tablesaw","init","selectAll","each","d","i","o","toggleEl","toggle","targetElementId","attr","target","targetElement","node","toggleFn","isVisible","property","html","on","submitForm","newurl","location","origin","pathname","event","keyCode","ymdhmsfTimeParser","utcParse","ymdhmsTimeParser","parseDateTime","dateString","isoParse","ymdhmsfTimeFormatter","utcFormat","ymdhmsTimeFormatter","hmslTimeFormatter","Date","toString","toISOString","latestCaseDetailsContainer","getElementById","latestSlaDetailsContainer","latestCaseTimerDetailsContainer","timelineContainer","selectedCaseTimerLabel","caseTimerEventDetailsContainer","caseTimerSnapshotDetailsContainer","historicalSnapshotDetailsContainer","historicalCaseDetailsContainer","historicalSlaDetailsContainer","historicalCaseTimerDetailsContainer","shouldShowSnapshotJsonForSelectedItems","Tooltip","placement","title","popperOptions","onCreate","p","instance","popper","classList","add","casePropertyConfigs","propertyLabel","propertyValueSelector","x","Identifier","onClick","Id","Owner","FirstName","LastName","Site","Name","Employee","PrimarySite","caseTimerPropertyConfigs","priority","OrdinalId","Events","renderEventDetailsTableAndSnapshotDetailsTableFromEvents","ct","CaseTimerType","separateWordsInCamelCaseStringWithSpaces","CurrentEffectiveClockState","CurrentNonWorkingTimePeriodTypes","DisplayOnCase","NonWorkingEventSource","RespectNonWorkingSchedule","RespectSlaClock","RespectWorkCalendar","filter","r","join","ElapsedTime","Offset","RunTime","LastCalculated","Started","Stopped","ErrorTime","slaPropertyConfigs","RespectSlaPauses","SlaReplacementElapsedTimeAllocationPolicy","Status","Condition","SlaColor","IsPaused","IsActive","TargetInitialResponseDuration","IsTargetInitialResponseDefined","TimeUntilInitialResponse","ActualInitialResponseDate","ExpectedInitialResponseDate","InitialResponseBreachedDate","HasInitialResponseBreached","HasInitialResponseOccurred","TargetResolutionDuration","TimeRemaining","TargetResolutionBreachedDate","EstimatedTargetResolutionDate","HasTargetResolutionBreached","TimeUntilNextControlPoint","EstimatedNextControlPointDate","caseTimerEventPropertyConfigs","CaseTimerSnapshot","renderEventDetails","cte","EventTime","EventIdentifierString","AppIdentifier","IsDerived","IsInherited","IsCaseTimerCreationEvent","displaySnapshotAsJson","EventData","displayEventDataAsJson","caseTimerSnapshotPropertyConfigs","renderSnapshotDetails","cts","SnapshotTime","SnapshotData","caseDataModel","getCaseDataModel","renderCaseData","timeline","caseDataToRender","console","log","caseTimerTimelineData","transformCaseDataToTimelineData","renderLatestCaseProperties","renderLatestCaseTimersTable","Timers","renderTimeline","emptyContainer","caseTimerEvent","createJsonViewerPopup","caseTimerSnapshot","beforeSnapshotDataSerialized","ssCopy","UniqueId","LastModified","formatDateTime","CaseTimer","afterSnapshotDataSerialized","ssd","Sla","Case","afterSnapshotDataDeserialized","shareSnapshotDataReferences","container","timelineData","TimelineChart","tipContentGenerator","generateTipHtmlContent","groupHeight","groupWidth","resetTransform","str","replace","trim","date","formatDuration","later","earlier","rem_ms","ms","rem_s","Math","floor","s","rem_m","m","rem_h","h","rem_d","y","parts","durationString","tipHeading","label","formatLabelForTipHtml","tipDetails","details","temporalDescription","TYPE","POINT","at","from","to","result","escapeQuotes","objToView","heading","objJson","JSON","stringify","createPopupWindowFromHtml","targetId","windowFeatures","windowTitle","popup","open","doc","write","close","isUUID","match","index","firstChild","removeChild","renderProperties","allCaseTimers","selectedTimers","renderTableOfObjects","allEvents","selectedEvents","caseTimer","snapshotsForSelectedEvents","evt","latestSnapshot","maxBy","highlightNodesInTimeline","renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData","Snapshots","renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots","snapshots","selectedSnapshots","caseTimerId","CaseTimerMap","get","EventsBySnapshotIdLookup","ss","firstOrDefault","primaryItemsToHighlight","secondaryItemsToHighlight","primaryIds","accumulator","currentValue","secondaryIds","highlightNodeByIds","events","snapshotToUseForHistoricalData","sortBy","renderHistoricalDataFromSnapshot","snapshotsForTimer","snapshot","eligibleSnapshots","snapshotsGroupedByTimerId","nest","key","entries","latestSnapshotsByDistinctTimerId","g","values","_","caseTimersToDisplay","arr","ps","ascendingOrder","sort","distinctBy","withFirst","first","call","maxValue","maxi","minBy","minValue","mini","tableContainer","propertyConfigs","itemsToRender","itemsToHighlight","alert","table","append","classed","headerRow","forEach","pc","tbody","tr","findIndex","obj","data","enter","renderPropertyValue","sel","highlightedElements","nodes","scrollIntoView","block","d3SelectionBoundToPropertyConfig","objectWithProperties","getHtmlContentForPropertyValue","parentElement","renderPropertyLabelAndValue","propertyWrapper","labelElement","valueElement","propertyConfig","propertyValue","constructor","restoreReferencesInCaseTimerObjectGraph","caseTimerArray","snapshotsById","e","normalizeDatesRecursively","input","eachRecursive","val","caseDataToTransform","ordinalId","t","caseTimerSnapshotsMap","SnapshotMap","allTimelineSeriesForAllTimers","caseTimerEventPoints","timeOfEvents","eventsAtTime","pointObj","ids","point","timerEventsSeries","groupingKey","caseTimerSnapshotPoints","snapshotTime","snapshotsAtTime","generateSnapshotTipHtmlDetails","find","sndss","SubsequentNonDerivedSnapshot","timer","timerInfo","sla","slaInfo","timerSnapshotsSeries","now","intervalConfigs","intervalSeriesEventGroupingKeyFn","groupLabelFn","intervalLabelFn","startEventId","endEventId","intervalType","customClass","TemporalEventArgs","NonWorkingPeriod","SourceId","SourceName","SourceNameName","eventIntervalGroupingKeyFn","matchingIntervalConfig","includes","ic","timerIntervalSeriesArray","intervalConfigKey","intervalGroup","split","intervalConfig","eventsOfInterest","intervals","curEvt","nextEvt","intervalObj","INTERVAL","Object","assign","interval","push","subsequentNonDerivedSnapshot","snapshotsReversed","slice","reverse","calculationIntervalsSeries","curSD","nextSD","getIntervalPointAvgDate","aAvgDate","bAvgDate","allSeriesForTimer","newGroupNumber","lastGroupKey","newCaseData","module","exports"],"mappings":"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","file":"case-timer-event-viewer.js","sourcesContent":["class CaseTimerEventViewer {\r\n    constructor(element, initialCaseData, opts) {\r\n        let self = this;\r\n\r\n        // We'll use this several times hereafter\r\n        Array.prototype.selectMany = function(memberArraySelectorFn){ return !this.length ? [] : this.map(memberArraySelectorFn).reduce((a,b) => a.concat(b)); };\r\n\r\n        // Extend the d3 selection prototype to include some additional functions\r\n\r\n        // Note:  This function will ONLY append the first element in the HTML string literal provided.\r\n        if (!d3.selection.prototype.appendHTML) {\r\n            d3.selection.prototype.appendHTML =\r\n            //d3.selection.enter.prototype.appendHTML = \r\n            function(HTMLString) {\r\n                return this.select(function() {\r\n                    return this.appendChild(document.importNode(new DOMParser().parseFromString(HTMLString, 'text/html').body.childNodes[0], true));\r\n                });\r\n            };\r\n        }\r\n        d3.selection.prototype.hide = \r\n            //d3.selection.enter.prototype.hide = \r\n            function() { this.style('display', 'none') };\r\n        d3.selection.prototype.show = \r\n            //d3.selection.enter.prototype.show = \r\n            function() { this.style('display', null) };\r\n        d3.selection.prototype.visible = \r\n            //d3.selection.enter.prototype.visible = \r\n            function(value) { if (value === undefined) return this.style('display') !== 'none'; this.style('display', !!value ? null : 'none'); };\r\n\r\n\r\n        function loadScriptFile(src) {\r\n            var element = document.createElement(\"script\");\r\n            element.src = src;\r\n            document.body.appendChild(element);\r\n        }\r\n        function loadCssFile(src) {\r\n            var element = document.createElement(\"link\");\r\n            element.rel = \"stylesheet\";\r\n            element.type = \"text/css\";\r\n            element.href = src;\r\n            document.head.appendChild(element);\r\n        }\r\n        function executeFunctionWhenPredicateIsSatisfied(boolPredicate, fn, initialWaitInMs, subsequentWaitInMs) {\r\n            initialWaitInMs = initialWaitInMs || 100;\r\n            subsequentWaitInMs = subsequentWaitInMs || 100;\r\n            var task = function() {\r\n                if (!!boolPredicate()) fn();\r\n                else setTimeout(task, subsequentWaitInMs);\r\n            };\r\n            setTimeout(task, initialWaitInMs);\r\n        }\r\n\r\n        // Popper\r\n        loadScriptFile(\"https://unpkg.com/popper.js\");\r\n        //loadScriptFile(\"https://unpkg.com/popper.js/dist/umd/popper.min.js\");\r\n        //\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\");\r\n\r\n        // Tooltip (by Popper)\r\n        executeFunctionWhenPredicateIsSatisfied(() => window.Popper, () => {\r\n            loadScriptFile(\"https://unpkg.com/tooltip.js\");\r\n        });\r\n        //loadScriptFile(\"https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js\");\r\n\r\n        // JSONEditor\r\n        loadScriptFile(\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor-minimalist.js\");\r\n        loadCssFile(\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor.css\");\r\n\r\n        // Tablesaw\r\n        // Until this issue https://github.com/filamentgroup/tablesaw/issues/342) is fixed, tablesaw needs to be loaded before the page has finished loading.\r\n        // Once that issue is fixed, we can load it here:\r\n        //loadScriptFile(\"https://cdn.jsdelivr.net/npm/tablesaw@3.0.9/dist/tablesaw.min.js\");\r\n        loadCssFile(\"https://cdn.jsdelivr.net/npm/tablesaw@3.0.9/dist/tablesaw.min.css\");\r\n\r\n\r\n        // setTimeout(function(){ \r\n        //     // Until this issue https://github.com/filamentgroup/tablesaw/issues/342) is fixed, loading tablesaw at this point will mean that we have to manually trigger the\r\n        //     //   DOMContentLoaded event on the document after dynamically loading the script in order for Tablesaw to be aware that it can be safely initialized.\r\n        //     // This is a bit of a hack, so we'll have to see how this works.\r\n        //     var DOMContentLoaded_event = document.createEvent(\"Event\");\r\n        //     DOMContentLoaded_event.initEvent(\"DOMContentLoaded\", true, true);\r\n        //     window.document.dispatchEvent(DOMContentLoaded_event);\r\n        // }, 500);\r\n\r\n        function initializeTableFeatures() {\r\n            if (window.Tablesaw === undefined) {\r\n                setTimeout(initializeTableFeatures, 500);\r\n                return;\r\n            }\r\n\r\n            Tablesaw.init();\r\n        }\r\n\r\n        d3.select(element).appendHTML(`\r\n            <div id=\"case-timer-event-viewer-container\" class=\"container-fluid font-scale-pct-80\">\r\n\r\n                <div class=\"row mt-3 mb-3\">\r\n                    <div class=\"col-10\">\r\n                        <div id=\"case-timer-event-viewer-input\">\r\n                            <div class=\"h4 bottom-border\">Input</div>\r\n\r\n                            <div id=\"case-timer-event-viewer-error\" class=\"alert alert-warning mt-3\" role=\"alert\">\r\n                                <div class=\"alert-heading\"> To view case timer data for a given case, please enter a valid entity Id for a case, SLA, case timer, case timer event, or case timer snapshot.</div>\r\n                            </div>\r\n                \r\n                            <div class=\"input-group\">\r\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Enter a valid entity Id to load data for the related case\" id=\"entity-id\" />\r\n                                <div class=\"input-group-append\">\r\n                                    <button id=\"load-entity-button\" class=\"btn btn-primary\">Load</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"col-2\">\r\n                        <div class=\"h4 bottom-border\">Options</div>\r\n\r\n                        <input type=\"checkbox\" id=\"should-show-snapshot-json-for-selected-items\"> Show snapshot JSON for each selected item.\r\n                    </div>\r\n                </div>\r\n\r\n                <div id=\"case-timer-event-viewer-content\">\r\n\r\n                    <div class=\"mb-3\">\r\n                        <div class=\"h4 bottom-border\">\r\n                            <label for=\"case-timer-data-latest-toggle\">Latest Data</label>\r\n                            <input type=\"checkbox\" id=\"case-timer-data-latest-toggle\" data-toggle-target-element-id=\"case-timer-data-latest\" />\r\n                        </div>\r\n                        <div id=\"case-timer-data-latest\" class=\"indent\">\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"h6\">Case</div>\r\n                                    <div id=\"case-details-latest\" class=\"property-card-flex-layout\" ></div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"h6\">SLA</div>\r\n                                    <div id=\"sla-details-latest\" class=\"property-card-flex-layout\" ></div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"row mb-3\">\r\n                                <div class=\"col-12\">\r\n                                    <div class=\"h6\">Case Timers</div>\r\n                                    <div id=\"case-timer-details-latest\" class=\"scrollable-container\" ></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    <!-- Timeline -->\r\n                    <div class=\"row mb-3\">\r\n                        <div class=\"col-12\">\r\n                            <div class=\"h4 bottom-border\">Case Timer Events Timeline\r\n                                <button id=\"reset-timeline-view\" type=\"button\" class=\"btn btn-info btn-sm ml-4 m-1\">Reset View</button>\r\n                            </div>\r\n                            <div id=\"timeline-chart\" class=\"chart-container\" ></div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    <div class=\"mb-3\">\r\n                        <div id=\"selected-case-timer-label\" class=\"h4 bottom-border\">Selected Case Timer</div>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-8\">\r\n                                <div class=\"h6\">Events</div>\r\n                                <div id=\"case-timer-event-details\" class=\"scrollable-container\" ></div>\r\n                            </div>\r\n                            <div class=\"col-4\">\r\n                                <div class=\"h6\">Snapshots\r\n                                    <span id=\"snapshot-reminder\" class=\"badge badge-warning\">Remember...</button>\r\n                                </div>\r\n                                <div id=\"case-timer-snapshot-details\" class=\"scrollable-container\" ></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n\r\n                    <div class=\"h4 bottom-border\">\r\n                        <label for=\"case-timer-data-historical-contextual-toggle\">Historical Data Contemporary with Selected Snapshot</label>\r\n                        <input type=\"checkbox\" id=\"case-timer-data-historical-contextual-toggle\" data-toggle-target-element-id=\"case-timer-data-historical-contextual\" />\r\n                    </div>\r\n                    <div id=\"case-timer-data-historical-contextual\" class=\"indent\">\r\n                        <div class=\"row mb-3\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h6\">Selected Snapshot</div>\r\n                                <div id=\"snapshot-details-historical\" class=\"property-card-flex-layout\" ></div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"row mb-3\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h6\">Case</div>\r\n                                <div id=\"case-details-historical\" class=\"property-card-flex-layout\" ></div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"row mb-3\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h6\">SLA</div>\r\n                                <div id=\"sla-details-historical\" class=\"property-card-flex-layout\" ></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"row\">\r\n                            <div class=\"col-12\">\r\n                                <div class=\"h5\">Case Timers</div>\r\n                                <div id=\"case-timer-details-historical\" class=\"scrollable-container\" ></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n            </div>`);\r\n\r\n        // set up \r\n        d3.selectAll('[data-toggle-target-element-id]').each(function(d, i, o) {\r\n            var toggleEl = this;\r\n            var toggle = d3.select(toggleEl);\r\n\r\n            var targetElementId = toggle.attr('data-toggle-target-element-id');\r\n            if (!targetElementId) return;\r\n\r\n            var target = d3.select('#'+targetElementId);\r\n            var targetElement = target.node();\r\n            if (!targetElement) return;\r\n\r\n            var toggleFn = function() {\r\n                var isVisible = toggle.property('checked');\r\n                toggle.html(isVisible ? 'hide' : 'show');\r\n                target.style('display', isVisible ? '' : 'none');\r\n            };\r\n            toggle.on('click', toggleFn);\r\n            toggleFn();\r\n         });\r\n\r\n        function submitForm() {\r\n            var newurl = `${window.location.origin + window.location.pathname}?id=${d3.select('#entity-id').property('value')}`;\r\n            window.location.href = newurl;\r\n        }\r\n\r\n        d3.select('#load-entity-button')\r\n            .on('click', submitForm);\r\n        d3.select('#entity-id')\r\n            .on(\"keypress\", function() { if(d3.event.keyCode === 13) submitForm(); });\r\n\r\n        \r\n        const ymdhmsfTimeParser = d3.utcParse(\"%Y-%m-%dT%H:%M:%S.%LZ\");\r\n        const ymdhmsTimeParser = d3.utcParse(\"%Y-%m-%dT%H:%M:%SZ\");\r\n        function parseDateTime(dateString) {\r\n            return d3.isoParse(dateString) || dateString;\r\n            //return ymdhmsfTimeParser(dateString) || ymdhmsTimeParser(dateString) || dateString;\r\n        }\r\n        const ymdhmsfTimeFormatter = d3.utcFormat(\"%Y-%m-%d %I:%M:%S.%L %p\");\r\n        const ymdhmsTimeFormatter = d3.utcFormat(\"%Y-%m-%d %H:%M:%S\");\r\n        const hmslTimeFormatter = d3.utcFormat(\"%H:%M:%S.%L\");\r\n\r\n        // Cause toString'ed Date values to be rendered as ISO strings\r\n        Date.prototype.toString = Date.prototype.toISOString\r\n    \r\n        const latestCaseDetailsContainer = document.getElementById('case-details-latest');\r\n        const latestSlaDetailsContainer = document.getElementById('sla-details-latest');\r\n        const latestCaseTimerDetailsContainer = document.getElementById('case-timer-details-latest');\r\n        const timelineContainer = document.getElementById('timeline-chart');\r\n        const selectedCaseTimerLabel = document.getElementById('selected-case-timer-label');\r\n        const caseTimerEventDetailsContainer = document.getElementById('case-timer-event-details');\r\n        const caseTimerSnapshotDetailsContainer = document.getElementById('case-timer-snapshot-details');\r\n        const historicalSnapshotDetailsContainer = document.getElementById('snapshot-details-historical');\r\n        const historicalCaseDetailsContainer = document.getElementById('case-details-historical');\r\n        const historicalSlaDetailsContainer = document.getElementById('sla-details-historical');\r\n        const historicalCaseTimerDetailsContainer = document.getElementById('case-timer-details-historical');\r\n        \r\n        function shouldShowSnapshotJsonForSelectedItems() {\r\n            return d3.select('#should-show-snapshot-json-for-selected-items').property('checked');\r\n        }\r\n\r\n        executeFunctionWhenPredicateIsSatisfied(\r\n            () => window.Tooltip, \r\n            () => {\r\n                new Tooltip(document.getElementById('snapshot-reminder'), {\r\n                    placement: 'top', \r\n                    title: `The data of each snapshot represents the state of the case timer, SLA, etc. at the time of the snapshot. \r\n                        And timer-related values (e.g. CaseTimer.ElapsedTime, SLA.TimeRemaining, etc.) are updated after each non-derived snapshot is taken.\r\n                        This means that the timer-related values shown on each snapshot actually represent the state of affairs as of the SnapshotTime of the prior non-derived snapshot.\r\n                        `, \r\n                    html: false,\r\n                    // This fixes a conflict with Bootstrap's usage of popper  (i.e. it sets the opacity to 0 by default in _tooltip.scss)\r\n                    popperOptions: {\r\n                        onCreate: function(p) {\r\n                            p.instance.popper.classList.add('show');\r\n                        }\r\n                    }\r\n                });\r\n            }, 1000, 100);\r\n\r\n\r\n        // =======================================================================================================================================================================\r\n        // Property Config fields:\r\n        //  priority (optional) - The priority of the field which indicates how important it is to show the field.  Range: 0(most important/always show) -> 6(least important)\r\n        //  propertyLabel - The label to display for the column header / field\r\n        //  propertyValueSelector - A function that returns the HTML content to be displayed, given the object\r\n        //  onClick - (optional) A click event handler which will be registered on the content.\r\n        // =======================================================================================================================================================================\r\n\r\n        // Case property configs\r\n        const casePropertyConfigs = [\r\n            { propertyLabel: \"Identifier\", propertyValueSelector: x => x.Identifier, onClick: null },\r\n            { propertyLabel: \"Id\", propertyValueSelector: x => x.Id, onClick: null },\r\n            //{ propertyLabel: \"Last Modified\", propertyValueSelector: x => x.LastModified, onClick: null },\r\n            \r\n            { propertyLabel: \"Owner\", propertyValueSelector: x => `${x.Owner.FirstName} ${x.Owner.LastName} (${x.Owner.Id})`, onClick: null },\r\n            { propertyLabel: \"Owner's Site\", propertyValueSelector: x => `${x.Owner.Site.Identifier} - ${x.Owner.Site.Name} (${x.Owner.Site.Id})`, onClick: null },\r\n            \r\n            { propertyLabel: \"Employee\", propertyValueSelector: x => `${x.Employee.FirstName} ${x.Employee.LastName} (${x.Employee.Id})`, onClick: null },\r\n            { propertyLabel: \"Owner's Primary Site\", propertyValueSelector: x => !x.Employee.PrimarySite ? '(none set)' : `${x.Employee.PrimarySite.Identifier} - ${x.Employee.PrimarySite.Name} (${x.Employee.PrimarySite.Id})`, onClick: null },\r\n        ];\r\n\r\n        // CaseTimer property configs\r\n        const caseTimerPropertyConfigs = [\r\n            { priority: 0, propertyLabel: \"#\", propertyValueSelector: x => x.OrdinalId, onClick: null },\r\n            { priority: 1, propertyLabel: \"Events\", propertyValueSelector: x => x.Events, onClick: ct => renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, []) },\r\n            { priority: 0, propertyLabel: \"Type\", propertyValueSelector: x => x.CaseTimerType, onClick: null },\r\n            { priority: 1, propertyLabel: \"Name\", propertyValueSelector: x => x.Name, onClick: null },\r\n            { priority: 2, propertyLabel: \"Current Effective Clock State\", propertyValueSelector: x => separateWordsInCamelCaseStringWithSpaces(x.CurrentEffectiveClockState), onClick: null },\r\n            { priority: 3, propertyLabel: \"Current NonWorking Time Period Types\", propertyValueSelector: x => x.CurrentNonWorkingTimePeriodTypes, onClick: null },\r\n            { priority: 5, propertyLabel: \"Show On Case\", propertyValueSelector: x => x.DisplayOnCase, onClick: null },\r\n            { priority: 4, propertyLabel: \"NonWorking Event Source\", propertyValueSelector: x => x.NonWorkingEventSource, onClick: null },\r\n            { priority: 5, propertyLabel: \"Respects\", propertyValueSelector: x => \r\n                [x.RespectNonWorkingSchedule ? \"<nobr>Non-Working Schedule</nobr>\" : null, \r\n                 x.RespectSlaClock ? \"<nobr>SLA Clock</nobr>\" : null, \r\n                 x.RespectWorkCalendar ? \"<nobr>Work Calendar</nobr>\" : null].filter(r => !!r).join(', '), onClick: null },\r\n            { priority: 2, propertyLabel: \"Elapsed Time (Offset + Run Time)\", propertyValueSelector: x => `${x.ElapsedTime} (${x.Offset} + ${x.RunTime})`, onClick: null },\r\n                // { propertyLabel: \"Offset\", propertyValueSelector: x => x.Offset, onClick: null },\r\n                // { propertyLabel: \"Run Time\", propertyValueSelector: x => x.RunTime, onClick: null },\r\n                // { propertyLabel: \"Elapsed Time\", propertyValueSelector: x => x.ElapsedTime, onClick: null },\r\n            { priority: 3, propertyLabel: \"Last Calculated\", propertyValueSelector: x => x.LastCalculated, onClick: null },\r\n            //{ propertyLabel: \"Last Modified\", propertyValueSelector: x => x.LastModified, onClick: null },\r\n            //{ propertyLabel: \"Is Active\", propertyValueSelector: x => x.IsActive, onClick: null },\r\n            { priority: 4, propertyLabel: \"Started Time\", propertyValueSelector: x => x.Started, onClick: null },\r\n            { priority: 4, propertyLabel: \"Stopped Time\", propertyValueSelector: x => x.Stopped, onClick: null },\r\n            { priority: 4, propertyLabel: \"Error Time\", propertyValueSelector: x => x.ErrorTime, onClick: null },\r\n            { priority: 6, propertyLabel: \"Id\", propertyValueSelector: x => x.Id, onClick: null },\r\n        ];\r\n\r\n        // SLA property configs\r\n        const slaPropertyConfigs = [\r\n            { priority: 1, propertyLabel: \"Respect SLA Pauses\", propertyValueSelector: x => x.RespectSlaPauses, onClick: null },\r\n            { priority: 1, propertyLabel: \"Sla Replacement Elapsed Time Allocation Policy\", propertyValueSelector: x => x.SlaReplacementElapsedTimeAllocationPolicy, onClick: null },\r\n            { priority: 1, propertyLabel: \"Status\", propertyValueSelector: x => x.Status, onClick: null },\r\n            { priority: 1, propertyLabel: \"Condition\", propertyValueSelector: x => x.Condition, onClick: null },\r\n            { priority: 1, propertyLabel: \"Color\", propertyValueSelector: x => x.SlaColor, onClick: null },\r\n            { priority: 1, propertyLabel: \"Paused\", propertyValueSelector: x => x.IsPaused, onClick: null },\r\n            { priority: 1, propertyLabel: \"Active\", propertyValueSelector: x => x.IsActive, onClick: null },\r\n\r\n            { priority: 1, propertyLabel: \"Target IR Duration\", propertyValueSelector: x => x.TargetInitialResponseDuration, onClick: null },\r\n            { priority: 1, propertyLabel: \"Is Target IR Defined\", propertyValueSelector: x => x.IsTargetInitialResponseDefined, onClick: null },\r\n            { priority: 1, propertyLabel: \"Time Until IR\", propertyValueSelector: x => x.TimeUntilInitialResponse, onClick: null },\r\n            { priority: 1, propertyLabel: \"Actual IR Time\", propertyValueSelector: x => x.ActualInitialResponseDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Expected IR Time\", propertyValueSelector: x => x.ExpectedInitialResponseDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"IR Breached Time\", propertyValueSelector: x => x.InitialResponseBreachedDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Has IR Target Breached\", propertyValueSelector: x => x.HasInitialResponseBreached, onClick: null },\r\n            { priority: 1, propertyLabel: \"Has IR Occurred\", propertyValueSelector: x => x.HasInitialResponseOccurred, onClick: null },\r\n\r\n            { priority: 1, propertyLabel: \"TR Duration\", propertyValueSelector: x => x.TargetResolutionDuration, onClick: null },\r\n            { priority: 1, propertyLabel: \"TR Time Remaining\", propertyValueSelector: x => x.TimeRemaining, onClick: null },\r\n            { priority: 1, propertyLabel: \"TR BreachedDate\", propertyValueSelector: x => x.TargetResolutionBreachedDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Estimated TR Time\", propertyValueSelector: x => x.EstimatedTargetResolutionDate, onClick: null },\r\n            { priority: 1, propertyLabel: \"Has TR Breached\", propertyValueSelector: x => x.HasTargetResolutionBreached, onClick: null },\r\n\r\n            { priority: 1, propertyLabel: \"Time Until Next CP\", propertyValueSelector: x => x.TimeUntilNextControlPoint, onClick: null },\r\n            { priority: 1, propertyLabel: \"Estimated Next CP Time\", propertyValueSelector: x => x.EstimatedNextControlPointDate, onClick: null },\r\n        ];\r\n\r\n        // Case Timer Event property configs\r\n        const caseTimerEventPropertyConfigs = [\r\n            { priority: 0, propertyLabel: \"#\", propertyValueSelector: x => x.OrdinalId, onClick: null },\r\n            { priority: 1, propertyLabel: \"Snapshot<br>(details)\", propertyValueSelector: d => d.CaseTimerSnapshot, onClick: cte => renderEventDetails(cte) },\r\n            { priority: 1, propertyLabel: \"Event Time\", propertyValueSelector: d => d.EventTime, onClick: null },\r\n            { priority: 1, propertyLabel: \"Event Identifier\", propertyValueSelector: d => d.EventIdentifierString, onClick: null },\r\n            { priority: 1, propertyLabel: \"App Id\", propertyValueSelector: d => d.AppIdentifier, onClick: null },\r\n            { priority: 4, propertyLabel: \"Is Derived\", propertyValueSelector: d => d.IsDerived, onClick: null },\r\n            { priority: 4, propertyLabel: \"Is Inherited\", propertyValueSelector: d => d.IsInherited, onClick: null },\r\n            { priority: 4, propertyLabel: \"Is Creation\", propertyValueSelector: d => d.IsCaseTimerCreationEvent, onClick: null },\r\n            { priority: 6, propertyLabel: \"Id\", propertyValueSelector: d => d.Id, onClick: null },\r\n            { priority: 5, propertyLabel: \"Snapshot<br>(JSON)\", propertyValueSelector: d => d.CaseTimerSnapshot, onClick: cte => displaySnapshotAsJson(cte.CaseTimerSnapshot) },\r\n            { priority: 5, propertyLabel: \"EventData<br>(JSON)\", propertyValueSelector: d => d.EventData, onClick: cte => displayEventDataAsJson(cte) },\r\n        ];\r\n\r\n        // Case Timer Snapshot property configs\r\n        const caseTimerSnapshotPropertyConfigs = [\r\n            { priority: 0, propertyLabel: \"#\", propertyValueSelector: x => x.OrdinalId, onClick: null },\r\n            { priority: 0, propertyLabel: \"Snapshot<br>(details)\", propertyValueSelector: d => d, onClick: cts => renderSnapshotDetails(cts) },\r\n            { priority: 0, propertyLabel: \"Snapshot Time\", propertyValueSelector: d => d.SnapshotTime, onClick: null },\r\n            { priority: 1, propertyLabel: \"Id\", propertyValueSelector: d => d.Id, onClick: null },\r\n            { priority: 6, propertyLabel: \"Is Derived\", propertyValueSelector: d => d.IsDerived, onClick: null },\r\n            { priority: 6, propertyLabel: \"Snapshot<br>(JSON)\", propertyValueSelector: d => d.SnapshotData, onClick: cts => displaySnapshotAsJson(cts) },\r\n        ];\r\n\r\n        var caseDataModel;\r\n        function getCaseDataModel() {\r\n            return caseDataModel;\r\n        }\r\n        self.getCaseDataModel = getCaseDataModel;\r\n\r\n        self.renderCaseData = renderCaseData;\r\n        self.renderCaseData(initialCaseData);\r\n\r\n        var timeline;\r\n\r\n\r\n\r\n        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n        // Other functions below\r\n\r\n        function renderCaseData(caseDataToRender) {\r\n            console.log(\"Unparsed case data to be rendered: \", caseDataToRender);\r\n\r\n            // Update visibility of sections\r\n            d3.select('#case-timer-event-viewer-error').visible(caseDataToRender === null);\r\n            d3.select('#case-timer-event-viewer-content').visible(caseDataToRender !== null);\r\n\r\n            // Validate input\r\n            if (!caseDataToRender) { /*alert('case data was not provided.');*/ return; }\r\n    \r\n            let caseTimerTimelineData = transformCaseDataToTimelineData(caseDataToRender);\r\n            console.log(\"Case data: \", caseDataToRender);\r\n            console.log(\"Timeline data: \", caseTimerTimelineData);\r\n\r\n            // Render stuff\r\n            renderLatestCaseProperties(caseDataToRender);\r\n            renderLatestCaseTimersTable(caseDataToRender.Timers);\r\n            timeline = self.timeline = renderTimeline(timelineContainer, caseTimerTimelineData);\r\n\r\n            d3.select(selectedCaseTimerLabel).html('(no timer selected)');\r\n            emptyContainer(caseTimerEventDetailsContainer);\r\n            emptyContainer(caseTimerSnapshotDetailsContainer);\r\n            emptyContainer(historicalSnapshotDetailsContainer);\r\n            emptyContainer(historicalCaseDetailsContainer);\r\n            emptyContainer(historicalSlaDetailsContainer);\r\n            emptyContainer(historicalCaseTimerDetailsContainer);\r\n\r\n            caseDataModel = caseDataToRender;\r\n        }\r\n\r\n        function displayEventDataAsJson(caseTimerEvent)\r\n        {\r\n            createJsonViewerPopup( caseTimerEvent.EventData, `Data for Case Timer Event: ${caseTimerEvent.EventIdentifierString}`  );\r\n        }\r\n\r\n        function displaySnapshotAsJson(caseTimerSnapshot)\r\n        {\r\n            var cts = caseTimerSnapshot;\r\n\r\n            // Save and clear properties that are redundant or which would cause problems.\r\n            beforeSnapshotDataSerialized(cts.SnapshotData);\r\n\r\n            // These are the only fields we want to preserve for the visualization\r\n            var ssCopy = {\r\n                \"SnapshotTime\": cts.SnapshotTime,\r\n                \"OrdinalId\": cts.OrdinalId,\r\n                \"IsDerived\": cts.IsDerived,\r\n                \"SnapshotData\":  cts.SnapshotData,\r\n                \"UniqueId\": cts.UniqueId,\r\n                \"Id\": cts.Id,\r\n                \"LastModified\": cts.LastModified,\r\n            };\r\n            createJsonViewerPopup(ssCopy, `Case Timer Snapshot taken at ${formatDateTime(cts.SnapshotTime)} for timer '${cts.SnapshotData.CaseTimer.Name}'`);\r\n\r\n            // Restore values\r\n            afterSnapshotDataSerialized(cts.SnapshotData);\r\n        }\r\n\r\n        function displayEventDataAsJson(caseTimerEvent)\r\n        {\r\n            createJsonViewerPopup( caseTimerEvent.EventData, `Data for Case Timer Event: ${caseTimerEvent.EventIdentifierString}`  );\r\n        }\r\n\r\n        function beforeSnapshotDataSerialized(ssd) {\r\n            // If CaseTimer is for an SLA, then don't include redundant CaseTimer data.\r\n            // If CaseTimer is not for an SLA but if there is an SLA on the case, then do include its CaseTimer data, but don't include the Sla's CaseTimer's Case data.\r\n            if (ssd.CaseTimer.CaseTimerType === 'Sla')\r\n            {\r\n                // If the SLA hasn't already been removed\r\n                if (ssd.Sla != null)\r\n                {\r\n                    ssd.Sla.CaseTimer = \"(see SnapshotData.CaseTimer)\";\r\n                }\r\n            }\r\n            else if (ssd.Sla != null)\r\n            {\r\n                ssd.Sla.CaseTimer.Case = \"(see SnapshotData.CaseTimer.Case)\";\r\n            }\r\n        }\r\n\r\n        function afterSnapshotDataDeserialized(ssd) {\r\n            shareSnapshotDataReferences(ssd);\r\n        }\r\n\r\n        function afterSnapshotDataSerialized(ssd) {\r\n            shareSnapshotDataReferences(ssd);\r\n        }\r\n\r\n        function shareSnapshotDataReferences(ssd) {\r\n            // Share Case/CaseTimer data, depending upon whether an SLA is present.\r\n            //  - If CaseTimer is for an SLA, then share the CaseTimer data with the SLA.\r\n            //  - If CaseTimer is not for an SLA but if there is an SLA on the case, then share the Case data with the Sla's CaseTimer.\r\n            if (ssd.CaseTimer.CaseTimerType === 'Sla')\r\n            {\r\n                // If SLA hasn't already been removed \r\n                if (ssd.Sla != null)\r\n                {\r\n                    ssd.Sla.CaseTimer = ssd.CaseTimer;\r\n                }\r\n            }\r\n            else if (ssd.Sla != null)\r\n            {\r\n                ssd.Sla.CaseTimer.Case = ssd.CaseTimer.Case;\r\n            }\r\n            // If an SLA is present, then share its data with the Case.\r\n            if (ssd.Sla != null && ssd.Sla.CaseTimer.Case.Sla != ssd.Sla)\r\n            {\r\n                ssd.Sla.CaseTimer.Case.Sla = ssd.Sla;\r\n            }\r\n        }\r\n\r\n        function renderTimeline(container, timelineData) {\r\n            emptyContainer(container);\r\n\r\n            var timeline = new TimelineChart(container, timelineData, {\r\n                //enableLiveTimer: true, \r\n                tipContentGenerator: generateTipHtmlContent,\r\n                groupHeight: 36,\r\n                groupWidth: 400\r\n            }); //.onVizChange(e => console.log(e));\r\n            d3.select('#reset-timeline-view').on('click', () => timeline.resetTransform())\r\n\r\n            // Resize container vertically to fit timeline\r\n            //d3.select(container).style(\"height\", null);\r\n            //var timelineHeight = d3.select(container).node().clientHeight;\r\n            //d3.select(container).style(\"height\", (timelineHeight)+\"px\");\r\n            return timeline;\r\n        }\r\n\r\n        function separateWordsInCamelCaseStringWithSpaces(str) {\r\n            return (str || '').replace(/([A-Z])/g, \" $1\").trim();\r\n        }\r\n\r\n        function formatDateTime(date) {\r\n            if (!date) return '';\r\n            // We will only display fractional seconds to ms precision, because JS's date doesn't support any greater precision than that.\r\n            return ymdhmsfTimeFormatter(date);\r\n        }\r\n\r\n        function formatDuration(later, earlier) {\r\n            var rem_ms = later - earlier;  // remaining ms\r\n            var ms = rem_ms % 1000;\r\n            var rem_s = Math.floor(rem_ms / 1000);  // seconds remaining\r\n            var s = rem_s % 60;  // integral seconds part\r\n            var rem_m = Math.floor(rem_s / 60);  // minutes remaining\r\n            var m = rem_m % 60;  // integral minutes part\r\n            var rem_h = Math.floor(rem_m / 60);  // hours remaining\r\n            var h = rem_h % 24;  // integral hours part\r\n            var rem_d = Math.floor(rem_h / 24);  // days remaining\r\n            var d = rem_d % 365;  // integral days part\r\n            var y = Math.floor(d / 365);  // integral years part\r\n\r\n            var parts = [\r\n                y ? `${y} year${y>1?'s':''}` : null,\r\n                d ? `${d} day${d>1?'s':''}` : null,\r\n                h ? `${h} hour${h>1?'s':''}` : null,\r\n                m ? `${m} minute${m>1?'s':''}` : null,\r\n                s ? `${s} second${s>1?'s':''}` : null\r\n            ].filter(x => x != null);\r\n            var durationString = parts.join(' ');\r\n            return durationString || ms+' ms';\r\n        }\r\n\r\n        /* Generate the HTML content of the tip for each timeline object from the following properties of each:\r\n            type:  Symbol - Should be either TimelineChart.TYPE.POINT or TimelineChart.TYPE.INTERVAL.\r\n            label:  string | function - HTML content (or function to generate the same) which BRIEFLY names/identifies the object.\r\n            details:  string | function - HTML content (or function to generate the same) which provides details about the object.\r\n        */\r\n        function generateTipHtmlContent(d) {\r\n            // if d.label is a fn, call it to generate tip label content.\r\n            var tipHeading = typeof(d.label) == 'function' ? formatLabelForTipHtml(d.label(d)+'') : typeof(d.label)=='string' ? formatLabelForTipHtml(d.label) : '(no label)';\r\n\r\n            var tipDetails = typeof(d.details) == 'function' ? d.details(d)+'' : typeof(d.details) == 'string' ? d.details : '';\r\n\r\n            // Auto-generate temporal description.  Include \"at\" time for points or from/to time range for intervals with label.\r\n            var temporalDescription = d.type == TimelineChart.TYPE.POINT ? 'Time: '+formatDateTime(d.at) : \r\n                'From: '+formatDateTime(d.from)+\r\n                '<br>To: '+formatDateTime(d.to)+\r\n                '<br>Duration: '+formatDuration(d.to, d.from);\r\n            var result = `\r\n                <div class=\"tip-heading h5\">${tipHeading}</div>\r\n                <div class=\"tip-body\">\r\n                <div>${temporalDescription}</div>\r\n                <div>${tipDetails}</div>\r\n                </div>`;\r\n            return result;\r\n        };\r\n\r\n        function formatLabelForTipHtml(label) {\r\n            return (label || '').replace(/ /g, '&nbsp;').replace(/\\\\n/g, '<br>');\r\n        };\r\n\r\n        // Returns a new string with all single and double quotes escaped, in order to ensure that it can be embedded into another string expression without causing problems.\r\n        // NOTE:  This won't detect if single or double quotes have already been escaped, so it could potentially double-escape them, which would defeat the purpose of this method.\r\n        function escapeQuotes(str) {\r\n            return str.replace(/'/g,\"\\\\'\").replace(/\"/g,'\\\\\"');\r\n        }\r\n\r\n        // Create a separate window to view the formatted JSON content of CaseTimerSnapshotData and CaseTimerEventData\r\n        function createJsonViewerPopup(objToView, heading) {\r\n            var objJson = JSON.stringify(objToView);\r\n            var html = `\r\n            <html>\r\n                <head>\r\n                    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor.css\" rel=\"stylesheet\" type=\"text/css\">\r\n                </head>\r\n                <body>\r\n                    <div id=\"jsoneditor\" style=\"width: 100%; height: 100%;\"></div>\r\n                    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.13.3/jsoneditor-minimalist.js\"><\\/script>\r\n                    <script>\r\n                        var editor = new JSONEditor(document.getElementById(\"jsoneditor\"), { mode: 'view', name: '${escapeQuotes(heading)}' }, ${objJson}); editor.expandAll();\r\n                    <\\/script>\r\n                </body>\r\n            </html>`;\r\n            createPopupWindowFromHtml(html, 'json-viewer-popup', 'width=800,height=1200');\r\n        }\r\n    \r\n        function createPopupWindowFromHtml(html, targetId, windowFeatures, windowTitle) {\r\n            var popup = window.open(\"\", targetId, windowFeatures, false);\r\n            var doc = popup.document;\r\n            doc.open();\r\n            doc.write(html);\r\n            doc.close();\r\n            doc.title = windowTitle;\r\n        }\r\n\r\n        function isUUID(value) {\r\n            var result = value.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n            return !!result && result.index === 0;\r\n        }\r\n\r\n\r\n        function emptyContainer(container)\r\n        {\r\n            // remove all child elements of the specified container\r\n            while (container.firstChild) {\r\n                container.removeChild(container.firstChild);\r\n            }\r\n        }\r\n\r\n        function renderLatestCaseProperties(caseDataToRender)\r\n        {\r\n            // Case properties\r\n            emptyContainer(latestCaseDetailsContainer);\r\n            renderProperties(latestCaseDetailsContainer, casePropertyConfigs, caseDataToRender);\r\n\r\n            // Sla properties\r\n            emptyContainer(latestSlaDetailsContainer);\r\n            renderProperties(latestSlaDetailsContainer, slaPropertyConfigs, caseDataToRender.Sla);\r\n        }\r\n\r\n        function renderLatestCaseTimersTable(allCaseTimers, selectedTimers)\r\n        {\r\n            emptyContainer(latestCaseTimerDetailsContainer);\r\n            renderTableOfObjects(latestCaseTimerDetailsContainer, caseTimerPropertyConfigs, allCaseTimers, selectedTimers);\r\n        }\r\n\r\n        // Both event and snapshot data details are treated as immutable, so we don't need to differentiate between latest/historical\r\n        function renderEventDetailsTableAndSnapshotDetailsTableFromEvents(allEvents, selectedEvents)\r\n        {\r\n            if (!allEvents || !allEvents.length) return;  // don't continue to display invalid data\r\n\r\n            var caseTimer = allEvents[0].CaseTimer;\r\n\r\n            // Identify snapshots corresponding to selected events\r\n            var snapshotsForSelectedEvents = selectedEvents.map(evt => evt.CaseTimerSnapshot);\r\n            var latestSnapshot = maxBy(selectedEvents.map(x => x.CaseTimerSnapshot), x => x.SnapshotTime);\r\n            \r\n            highlightNodesInTimeline(selectedEvents, snapshotsForSelectedEvents);\r\n\r\n            renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData(\r\n                allEvents, selectedEvents, caseTimer.Snapshots, snapshotsForSelectedEvents, latestSnapshot);\r\n        }\r\n\r\n        // Both event and snapshot objects are treated as immutable, so we don't need to differentiate between latest/historical\r\n        function renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots(snapshots, selectedSnapshots)\r\n        {\r\n            var caseTimerId = snapshots[0].SnapshotData.CaseTimer.Id;\r\n            var caseTimer = caseDataModel.CaseTimerMap.get(caseTimerId);\r\n\r\n            // Identify events corresponding to selected snapshots\r\n            var selectedEvents = selectedSnapshots.selectMany(ss => caseDataModel.EventsBySnapshotIdLookup.get(ss.Id)) || [];\r\n\r\n            highlightNodesInTimeline(selectedSnapshots, selectedEvents);\r\n\r\n            renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData(\r\n                caseTimer.Events, selectedEvents, snapshots, selectedSnapshots, firstOrDefault(selectedSnapshots));\r\n        }\r\n\r\n        function highlightNodesInTimeline(primaryItemsToHighlight, secondaryItemsToHighlight)\r\n        {\r\n            // generate array of primary point and interval ID's\r\n            var primaryIds = primaryItemsToHighlight\r\n                .map(x => ['p'+x.Id, 'i'+x.Id])\r\n                .reduce((accumulator, currentValue) => accumulator.concat(currentValue), []);\r\n            // generate array of secondary point and interval ID's\r\n            var secondaryIds = secondaryItemsToHighlight\r\n                .map(x => ['p'+x.Id, 'i'+x.Id])\r\n                .reduce((accumulator, currentValue) => accumulator.concat(currentValue), []);\r\n\r\n            // In the timeline, highlight the related point based on this snapshot\r\n            timeline.highlightNodeByIds(secondaryIds, false, 'chart-node-highlight-secondary');\r\n            timeline.highlightNodeByIds(primaryIds, true, 'chart-node-highlight-primary');\r\n        }\r\n\r\n        // Both event and snapshot objects are treated as immutable, so we don't need to differentiate between latest/historical\r\n        function renderEventDetailsTableAndSnapshotDetailsTableAndHistoricalData(events, selectedEvents, snapshots, selectedSnapshots, snapshotToUseForHistoricalData)\r\n        {\r\n            if (events && events.length) {\r\n                var ct = events[0].CaseTimer;\r\n                d3.select(selectedCaseTimerLabel).html(`Selected Timer #${ct.OrdinalId} for ${ct.CaseTimerType === 'CaseTimer' ? 'Case' : 'Sla'}: \"${ct.Name}\"`);\r\n            }\r\n            if (!snapshotToUseForHistoricalData && firstOrDefault(selectedSnapshots) != null)\r\n                snapshotToUseForHistoricalData = firstOrDefault(selectedSnapshots);\r\n            emptyContainer(caseTimerEventDetailsContainer);\r\n            emptyContainer(caseTimerSnapshotDetailsContainer);\r\n            sortBy(events, cte => cte.OrdinalId, true);\r\n            sortBy(snapshots, ss => ss.OrdinalId, true);\r\n            renderTableOfObjects(caseTimerEventDetailsContainer, caseTimerEventPropertyConfigs, events, selectedEvents);\r\n            renderTableOfObjects(caseTimerSnapshotDetailsContainer, caseTimerSnapshotPropertyConfigs, snapshots, selectedSnapshots);\r\n            renderHistoricalDataFromSnapshot(snapshotToUseForHistoricalData);\r\n\r\n            if (selectedSnapshots && selectedSnapshots.length > 0 && shouldShowSnapshotJsonForSelectedItems())\r\n            {\r\n                displaySnapshotAsJson(selectedSnapshots[0]);\r\n            }\r\n        }\r\n        \r\n        function renderEventDetails(caseTimerEvent)\r\n        {\r\n            // In the timeline, highlight the related point (and interval) based on this event\r\n            //timeline.highlightNodeByIds(['p'+caseTimerEvent.Id, 'i'+caseTimerEvent.Id], true, 'chart-node-highlight');\r\n\r\n            // Render any historical data associated with this event's snapshot\r\n            renderHistoricalDataFromSnapshot(caseTimerEvent.CaseTimerSnapshot);\r\n\r\n            // Refresh events/snapshots tables\r\n            renderEventDetailsTableAndSnapshotDetailsTableFromEvents(caseTimerEvent.CaseTimer.Events, [caseTimerEvent]);\r\n        }\r\n\r\n        function renderSnapshotDetails(caseTimerSnapshot)\r\n        {\r\n            var caseTimerId = caseTimerSnapshot.SnapshotData.CaseTimer.Id;\r\n            var snapshotsForTimer = caseDataModel.CaseTimerMap.get(caseTimerId).Snapshots;\r\n            \r\n            // In the timeline, highlight the related point based on this snapshot\r\n            //timeline.highlightNodeByIds('p'+caseTimerSnapshot.Id, true, 'chart-node-highlight');\r\n\r\n            // Render any historical data associated with this snapshot\r\n            renderHistoricalDataFromSnapshot(caseTimerSnapshot);\r\n\r\n            // Refresh events/snapshots tables\r\n            renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots(snapshotsForTimer, [caseTimerSnapshot]); \r\n        }\r\n\r\n        function renderHistoricalDataFromSnapshot(snapshot)\r\n        {\r\n            emptyContainer(historicalSnapshotDetailsContainer);\r\n            emptyContainer(historicalCaseDetailsContainer);\r\n            emptyContainer(historicalSlaDetailsContainer);\r\n            emptyContainer(historicalCaseTimerDetailsContainer);\r\n\r\n            if (!snapshot) return;\r\n\r\n            renderProperties(historicalSnapshotDetailsContainer, caseTimerSnapshotPropertyConfigs, snapshot);\r\n            renderProperties(historicalCaseDetailsContainer, casePropertyConfigs, snapshot.SnapshotData.CaseTimer.Case);\r\n            renderProperties(historicalSlaDetailsContainer, slaPropertyConfigs, snapshot.SnapshotData.CaseTimer.Case.Sla);\r\n\r\n            // For each case timer in effect, resolve the latest snapshot whose snapshot time is <= the current snapshot \r\n            var eligibleSnapshots = getCaseDataModel().Snapshots.filter(x => x.SnapshotTime <= snapshot.SnapshotTime);\r\n            var snapshotsGroupedByTimerId = d3.nest()\r\n                .key(d => d.SnapshotData.CaseTimer.Id)\r\n                .entries(eligibleSnapshots);\r\n            var latestSnapshotsByDistinctTimerId = snapshotsGroupedByTimerId\r\n                .map(g => ({ \r\n                    \"CaseTimerId\": g.key, \r\n                    \"CaseTimerSnapshot\": maxBy(g.values, _ => _.SnapshotTime*1) \r\n                }));\r\n            var caseTimersToDisplay = latestSnapshotsByDistinctTimerId.map(x => x.CaseTimerSnapshot.SnapshotData.CaseTimer);\r\n            renderTableOfObjects(historicalCaseTimerDetailsContainer, caseTimerPropertyConfigs, caseTimersToDisplay, []);\r\n        }\r\n\r\n        // Perform an in-place sort of array elements according to the \"value\" of the property returned by the specified selector.  Then, return the sorted array.\r\n        function sortBy(arr, ps, ascendingOrder) {\r\n            if (!arr) return [];\r\n            return arr.sort((a,b) => ps(a) < ps(b) ? -1 : ps(a) == ps(b) ? 0 : 1);\r\n        }\r\n\r\n        function distinctBy(arr, ps) {\r\n\r\n        }\r\n\r\n        function firstOrDefault(arr) {\r\n            if (!arr || arr.length == 0) return null;\r\n            return arr[0];\r\n        }\r\n\r\n        function withFirst(arr, fn) {\r\n            var first = firstOrDefault(arr);\r\n            if (first === null) return;\r\n            fn.call(this, first);\r\n        }\r\n\r\n        // Return the element of the specified array whose property selector produces the maximum value.\r\n        function maxBy(arr, ps) {\r\n            if (!arr || arr.length == 0) return null;\r\n            if (arr.length == 1) return arr[0];\r\n            var maxValue = ps(arr[0]);\r\n            var maxi = 0;\r\n            for (var i = 1; i < arr.length; i++)\r\n            {\r\n                var value = ps(arr[i]);\r\n                if (value > maxValue) { maxValue = value; maxi = i; }\r\n            }\r\n            return arr[maxi];\r\n        }\r\n\r\n        // Return the element of the specified array whose property selector produces the minimum value.\r\n        function minBy(arr, ps) {\r\n            if (!arr || arr.length == 0) return null;\r\n            if (arr.length == 1) return arr[0];\r\n            var minValue = ps(arr[0]);\r\n            var mini = 0;\r\n            for (var i = 1; i < arr.length; i++)\r\n            {\r\n                var value = ps(arr[i]);\r\n                if (value < minValue) { minValue = value; mini = i; }\r\n            }\r\n            return arr[mini];\r\n        }\r\n           \r\n        function renderTableOfObjects(tableContainer, propertyConfigs, itemsToRender, itemsToHighlight)\r\n        {\r\n            // itemsToRender is required and must contain data\r\n            if (!itemsToRender)\r\n            {\r\n                alert('renderTableOfObjects called with no data');\r\n                return;\r\n            }\r\n\r\n            itemsToHighlight = itemsToHighlight || [];\r\n\r\n            var table = d3.select(tableContainer).append('table')\r\n                //.classed('table', true);\r\n                .classed('tablesaw', true)\r\n                //.attr( 'data-tablesaw-mode', 'stack')\r\n                .attr('data-tablesaw-sortable', '')\r\n                .attr('data-tablesaw-sortable-switch', '')\r\n                .attr('data-tablesaw-minimap', '')\r\n                .attr('data-tablesaw-mode', 'columntoggle')\r\n                ;\r\n            var headerRow = table.append('thead').append('tr');\r\n            // render table header\r\n            propertyConfigs.forEach(pc => headerRow\r\n                .append('th')\r\n                .attr('data-tablesaw-sortable-col', '')\r\n                .attr('data-tablesaw-priority', pc.priority === 0 ? 'persist' : pc.priority)\r\n                .html(pc.propertyLabel));\r\n\r\n            var tbody = table.append('tbody');\r\n\r\n            itemsToRender.forEach(obj => {\r\n                var tr = tbody.append('tr')\r\n                    .classed('row-highlight', itemsToHighlight.findIndex(o => o == obj) != -1)\r\n                    .selectAll('td').data(propertyConfigs);\r\n                tr.enter().append('td')\r\n                    .call(sel => renderPropertyValue(sel, obj));\r\n            });\r\n\r\n            // Apply tablesaw features to table\r\n            initializeTableFeatures();\r\n\r\n            // attempt to scroll all highlighted items into view\r\n            var highlightedElements = table.selectAll('.row-highlight').nodes();\r\n            if (highlightedElements && highlightedElements[0] && highlightedElements[0].scrollIntoView)\r\n            {\r\n                // scroll the last highlighted element into view\r\n                highlightedElements[highlightedElements.length-1].scrollIntoView({ block: \"nearest\" });\r\n                // if more than 1 is highlighted, then scroll the first highlighted element into view\r\n                if (highlightedElements.length > 1)\r\n                    highlightedElements[0].scrollIntoView({ block: \"nearest\" });\r\n            }\r\n        }\r\n\r\n        function renderPropertyValue(d3SelectionBoundToPropertyConfig, objectWithProperties) {\r\n            var obj = objectWithProperties;\r\n            d3SelectionBoundToPropertyConfig\r\n                .attr('data-title', d => d.propertyLabel)\r\n                .html(d => getHtmlContentForPropertyValue(d, obj))\r\n                .on('click', d => { \r\n                    if (typeof(d.onClick) == 'function') d.onClick(obj);\r\n                });\r\n        }\r\n\r\n        function renderProperties(parentElement, propertyConfigs, obj)\r\n        {\r\n            if (!obj)\r\n                d3.select(parentElement).appendHTML('<div> No data exists. </div>');\r\n            else\r\n                d3.select(parentElement)\r\n                    .selectAll('div').data(propertyConfigs)\r\n                    .enter().append('div')\r\n                    .call(pc => renderPropertyLabelAndValue(pc, obj));\r\n        }\r\n\r\n        function renderPropertyLabelAndValue(d3SelectionBoundToPropertyConfig, objectWithProperties)\r\n        {\r\n            let propertyWrapper = d3SelectionBoundToPropertyConfig\r\n                .append('div')\r\n                .attr('class', 'property-label-and-value');\r\n            let labelElement = propertyWrapper\r\n                .append('div')\r\n                .attr('class', 'property-label')\r\n                .html(pc => pc.propertyLabel)\r\n            let valueElement = propertyWrapper\r\n                .append('div')\r\n                .attr('class', 'property-value')\r\n                .call(pc => renderPropertyValue(pc, objectWithProperties));\r\n        }\r\n\r\n        function getHtmlContentForPropertyValue(propertyConfig, obj)\r\n        {\r\n            var propertyValue = propertyConfig.propertyValueSelector(obj);\r\n\r\n            if (propertyValue === undefined)\r\n            {\r\n                return \"\";\r\n            }\r\n            else if (propertyValue === null)\r\n            {\r\n                return \"(null)\";\r\n            }\r\n            else if (typeof propertyValue == 'number')\r\n            {\r\n                return propertyValue;\r\n            }\r\n            else if (typeof propertyValue == 'string')\r\n            {\r\n                //if (isUUID(propertyValue))\r\n                //    return \"<span title='\"+propertyValue+\"'>\"+propertyValue.substring(0, 7)+\"...</span>\";\r\n                return propertyValue;\r\n            }\r\n            else if (typeof propertyValue == 'boolean')\r\n            {\r\n                return \"<input type='checkbox' \"+(!!propertyValue ? \"checked\" : \"\")+\" onclick='return false;' />\";\r\n            }\r\n            else if (propertyValue.constructor == (new Date()).constructor)\r\n            {\r\n                return formatDateTime(propertyValue);\r\n            }\r\n            else if(!!propertyConfig.onClick)\r\n            {\r\n                return `<button class=\"btn btn-sm btn-${propertyConfig.priority < 3 ? 'primary' : 'secondary'}\">View</button>`;\r\n            }\r\n            return '<em>(no value resolver defined for this type)</em>'\r\n        }\r\n\r\n        // function normalizeProperties(caseTimerArray)\r\n        // {\r\n        //     var convertDateProperties = function(obj, propertyNamesArray)\r\n        //     {\r\n        //         if (!obj) return;\r\n        //         propertyNamesArray.forEach(pn => {\r\n        //             var value = obj[pn];\r\n        //             if (value !== null && typeof value === 'string')\r\n        //                 obj[pn] = parseDateTime(value);\r\n        //         });\r\n        //     };\r\n\r\n        //     caseTimerArray.forEach(ct => {\r\n        //         ct.Events.forEach(e => {\r\n        //             convertDateProperties(e, [ \"EventTime\", \"LastModified\" ]);\r\n        //             convertDateProperties(e.CaseTimerSnapshot, [ \"SnapshotTime\", \"LastModified\" ]);\r\n        //             var ssd = e.CaseTimerSnapshot.SnapshotData;\r\n        //             convertDateProperties(ssd, [ \"SnapshotTime\", \"LastModified\" ]);\r\n        //             convertDateProperties(ssd.CaseTimer, [ \"LastCalculated\", \"LastModified\", \"Started\", \"Stopped\" ]);\r\n        //             convertDateProperties(ssd.Sla, [ \"EstimatedNextControlPointDate\", \"EstimatedTargetResolutionDate\", \"LastModified\" ]);\r\n        //         });\r\n        //         convertDateProperties(ct, [ \"LastCalculated\", \"LastModified\", \"Started\", \"Stopped\" ]);\r\n        //     });\r\n        // }\r\n\r\n        function restoreReferencesInCaseTimerObjectGraph(caseTimerArray)\r\n        {\r\n            // normalize data\r\n            caseTimerArray.forEach(ct => \r\n            {\r\n                ct.Snapshots.forEach(ss => {\r\n                    afterSnapshotDataDeserialized(ss.SnapshotData);\r\n                });\r\n                var snapshotsById = d3.map(ct.Snapshots, ss => ss.Id);\r\n\r\n                ct.Events.forEach(e => \r\n                {\r\n                    // link the case timer events to the case timer that it belongs to\r\n                    e.CaseTimer = ct;\r\n                    e.CaseTimerSnapshot = snapshotsById.get(e.CaseTimerSnapshot.Id);\r\n\r\n                    //afterSnapshotDataDeserialized(e.CaseTimerSnapshot.SnapshotData);\r\n                });\r\n            });\r\n        }\r\n\r\n        // Convert date strings to date objects\r\n        function normalizeDatesRecursively(input) {\r\n            var eachRecursive = function(obj)\r\n            {\r\n                d3.map(obj).each((val, key) => {\r\n                    if (!!val)\r\n                    {\r\n                        if (typeof val === \"object\") eachRecursive(val);\r\n                        if (typeof val === \"string\") obj[key] = parseDateTime(val);\r\n                    }\r\n                });\r\n            }\r\n            eachRecursive(input);\r\n        }\r\n\r\n        function transformCaseDataToTimelineData(caseDataToTransform)\r\n        {\r\n            if (!caseDataToTransform.Timers.length) return [];\r\n            \r\n            // create a copy of the data\r\n            //let caseTimerArray = JSON.parse(JSON.stringify(caseDataToTransform.Timers));\r\n\r\n            // Ensure that timers are ordered by when they were started\r\n            let caseTimerArray = sortBy(caseDataToTransform.Timers, _ => _.Started);\r\n\r\n            // Iterate over timers to set an ordinal ID and to sort events on each\r\n            var ordinalId = 1;\r\n            caseTimerArray.forEach(ct => {\r\n                ct.OrdinalId = ordinalId++;\r\n                sortBy(ct.Events, _ => _.EventTime);\r\n            });\r\n\r\n            normalizeDatesRecursively(caseDataToTransform);\r\n            //normalizeProperties(caseTimerArray);\r\n\r\n            restoreReferencesInCaseTimerObjectGraph(caseTimerArray);\r\n\r\n            // Flatten the events\r\n            var allEvents = caseTimerArray.selectMany(t => t.Events);\r\n            // Create a D3 map of case timer Id to case timer\r\n            caseDataToTransform.CaseTimerMap = d3.map(caseDataToTransform.Timers, ct => ct.Id);\r\n            // Create a D3 map of snapshot Id to snapshot (distinct values only).\r\n            var caseTimerSnapshotsMap = d3.map(allEvents.map(cte => cte.CaseTimerSnapshot), cts => cts.Id);\r\n            // Replace snapshot data with distinct snapshot objects (so we won't have different copies of the same snapshot floating around).\r\n            allEvents.forEach(cte => cte.CaseTimerSnapshot = caseTimerSnapshotsMap.get(cte.CaseTimerSnapshot.Id));\r\n            // Make array of snapshots accessible from case data.\r\n            caseDataToTransform.SnapshotMap = caseTimerSnapshotsMap;\r\n            caseDataToTransform.Snapshots = sortBy(caseTimerSnapshotsMap.values(), ss => ss.SnapshotTime, true);\r\n            // Create a D3 map of case timer Id's to snapshots\r\n//            var snapshotsByCaseTimerIds = d3.nest().key(cts => cts.SnapshotData.CaseTimer.Id).map(caseDataToTransform.Snapshots);\r\n            // Set snapshots array on each case timer object (to facilitate access later)\r\n//            caseTimerArray.forEach(ct => ct.Snapshots = sortBy(snapshotsByCaseTimerIds.get(ct.Id), ss => ss.SnapshotTime, true));\r\n            caseTimerArray.forEach(ct => ct.Snapshots = sortBy(ct.Snapshots, ss => ss.SnapshotTime, true));\r\n            // Create a D3 nested map from case timer snapshot Id to events\r\n            caseDataToTransform.EventsBySnapshotIdLookup = d3.nest().key(cte => cte.CaseTimerSnapshot.Id).map(allEvents);\r\n\r\n\r\n\r\n            var allTimelineSeriesForAllTimers = caseTimerArray.map(ct => \r\n            {\r\n                // for each case timer, this returns an array of data series, each of which can be plotted on the timeline\r\n\r\n                // Create timeline point data from case timer events, grouped by event time.\r\n                // As we group these events by EventTime into points, we have to treat the EventTime as an integral number of milliseconds.\r\n                // Otherwise, the milliseconds will be lost if we just use the EventTime (Date), because the d3.nest.key resolver will convert the returned object into a string.\r\n                var caseTimerEventPoints = (d3.nest().key(cte => cte.EventTime*1).entries(ct.Events))\r\n                    // map d3 groupings (of { key: \"\", values: [] }) into an array of points for the timeline\r\n                    .map(d => {\r\n                        var timeOfEvents = new Date(d.key*1);\r\n                        var eventsAtTime = d.values;\r\n                        // Create point data structure\r\n                        var pointObj = {\r\n                            type: TimelineChart.TYPE.POINT,\r\n                            //customClass: 'point-white',\r\n                            label: function(){ \r\n                                return `${eventsAtTime.length} Event${eventsAtTime.length == 1 ? '' : 's'}` + \r\n                                    eventsAtTime.map(e => `<br> ${e.EventIdentifierString}`).join('');\r\n                            },\r\n                            at: timeOfEvents,\r\n                            data: d.values,\r\n                            ids: d.values.map(p => 'p'+p.Id),  // event guids will serve as the ids\r\n                            onClick: function(){\r\n                                //timeline.highlightNodeByIds('p'+d.values[0].Id, true, 'chart-node-highlight');\r\n                                renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, eventsAtTime); \r\n                            }\r\n                        };\r\n                        // Set the point reference on each event object.  (NOTE: each event should belong to 1 and only 1 point.)\r\n                        d.values.forEach(evt => evt.point = pointObj);\r\n                        return pointObj;\r\n                    });\r\n\r\n                // Create initial series for timer which will contain points for all case timer events\r\n                var timerEventsSeries = {\r\n                    label: `${ct.OrdinalId}. Events for ${ct.CaseTimerType}: [${ct.Name}]`,\r\n                    groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                    data: caseTimerEventPoints\r\n                };\r\n\r\n                // Create timeline point data from case timer snapshots, grouped by snapshot time.\r\n                // As we group these events by SnapshotTime into points, we have to treat the SnapshotTime as an integral number of milliseconds.\r\n                // Otherwise, the milliseconds will be lost if we just use the SnapshotTime (Date), because the d3.nest.key resolver will convert the returned object into a string.\r\n                var caseTimerSnapshotPoints = (d3.nest().key(cts => cts.SnapshotTime*1).entries(ct.Snapshots))\r\n                    // map d3 groupings (of { key: \"\", values: [] }) into an array of points for the timeline\r\n                    .map(d => {\r\n                        var snapshotTime = new Date(d.key*1); // convert key from string to a number to a date\r\n                        var snapshotsAtTime = d.values;\r\n\r\n                        function generateSnapshotTipHtmlDetails(snapshots) {\r\n                            // the current snapshot to use for this point\r\n                            var ss = snapshots.find(ss => !ss.IsDerived) || snapshots[0];\r\n                            // resolve the subsequent non-derived snapshot\r\n                            var sndss = ss.SubsequentNonDerivedSnapshot;\r\n                            if (!sndss) return '';\r\n                            var timer = sndss.SnapshotData.CaseTimer;\r\n                            var timerInfo = !timer ? '' : `\r\n                                <h5>Timer</h5> \r\n                                State: ${timer.CurrentEffectiveClockState}<br>\r\n                                Current NWTP Types: ${timer.CurrentNonWorkingTimePeriodTypes}<br>\r\n                                Elapsed Time: ${timer.ElapsedTime} (${timer.Offset} + ${timer.RunTime})<br>\r\n                                Last Calculated: ${formatDateTime(timer.LastCalculated)}<br>\r\n                            `;\r\n                            var sla = sndss.SnapshotData.Sla;\r\n                            var slaInfo = !sla ? '' : `\r\n                                <h5>SLA</h5> \r\n                                Status: ${sla.Status}<br>\r\n                                <table class=\"table table-sm\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th scope=\"col\"></th>\r\n                                            <th scope=\"col\">Target Duration</th>\r\n                                            <th scope=\"col\">Duration Remaining</th>\r\n                                            <th scope=\"col\">Estimated DateTime</th>\r\n                                            <th scope=\"col\">Breached?</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr>\r\n                                            <th scope=\"row\">SLA Initial Response</th>\r\n                                            <td>${sla.TargetInitialResponseDuration}</td>\r\n                                            <td>${sla.TimeUntilInitialResponse || ''}</td>\r\n                                            <td>${formatDateTime(sla.ExpectedInitialResponseDate)}</td>\r\n                                            <td>${sla.HasInitialResponseBreached}</td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <th scope=\"row\">SLA Target Resolution</th>\r\n                                            <td>${sla.TargetResolutionDuration}</td>\r\n                                            <td>${sla.TimeRemaining}</td>\r\n                                            <td>${formatDateTime(sla.EstimatedTargetResolutionDate)}</td>\r\n                                            <td>${sla.HasTargetResolutionBreached}</td>\r\n                                        </tr>\r\n                                        <tr>\r\n                                            <th scope=\"row\">Next Control Point</th>\r\n                                            <td></td>\r\n                                            <td>${sla.TimeUntilNextControlPoint}</td>\r\n                                            <td>${formatDateTime(sla.EstimatedNextControlPointDate)}</td>\r\n                                            <td></td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n                                `;\r\n                            return `<div><em>The following comes from ${!sndss.Id ? 'the current state of this case timer' : `subsequent non-derived snapshot ${sndss.Id}`}.</em></div>\r\n                                    ${timerInfo}\r\n                                    ${slaInfo}\r\n                                    ${ss.IsDerived ? '<div><strong><em>NOTE: Because this snapshot is derived, the times above may not be accurate.  They actually describe the state of affairs as of the prior non-derived snapshot.</em></strong></div>' : ''}\r\n                                    `;\r\n                        }\r\n                        // Create point data structure\r\n                        var pointObj = {\r\n                            type: TimelineChart.TYPE.POINT,\r\n                            //customClass: 'point-white',\r\n                            label: function() {\r\n                                var ss = snapshotsAtTime.find(ss => !ss.IsDerived) || snapshotsAtTime[0];\r\n                                return ` ${ss.IsDerived ? 'Derived' : 'Live'} Snapshot ${ss.OrdinalId}: ${ss.Id}`;\r\n                                // return `${snapshotsAtTime.length} Snapshot${snapshotsAtTime.length == 1 ? '' : 's'}`+\r\n                                //     snapshotsAtTime.map(e => `<br> ${e.OrdinalId}: ${e.IsDerived ? 'Derived' : 'Live'}: ${e.Id}`).join('');\r\n                            },\r\n                            details : function() { return generateSnapshotTipHtmlDetails(snapshotsAtTime); },\r\n                            at: snapshotTime,\r\n                            data: d.values,\r\n                            ids: d.values.map(p => 'p'+p.Id),  // snapshot guids will serve as the ids\r\n                            onClick: function(){ \r\n                                //timeline.highlightNodeByIds('p'+d.values[0].Id, true, 'chart-node-highlight');\r\n                                renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                renderEventDetailsTableAndSnapshotDetailsTableFromSnapshots(ct.Snapshots, snapshotsAtTime); \r\n                            }\r\n                        };\r\n                        // Set the point reference on each event object.  (NOTE: each event should belong to 1 and only 1 point.)\r\n                        d.values.forEach(evt => evt.point = pointObj);\r\n                        return pointObj;\r\n                    });\r\n\r\n                var timerSnapshotsSeries = {\r\n                    label: `Case Timer Snapshots`,\r\n                    groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                    data: caseTimerSnapshotPoints\r\n                };\r\n\r\n                var now = new Date();\r\n                var intervalConfigs = [\r\n                    {\r\n                        key: \"TimeAccrualIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"TimeAccrualInterval\",\r\n                        groupLabelFn: evt => \"Time Accrued\",\r\n                        intervalLabelFn: evt => \"Clock Running\",\r\n                        startEventId: \"TimerStartedAccruingTime\",\r\n                        endEventId: \"TimerStoppedAccruingTime\",\r\n                        intervalType: \"TimeAccrualInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"FollowingSlaIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"FollowingSlaInterval\",\r\n                        groupLabelFn: evt => \"Following SLA\",\r\n                        intervalLabelFn: evt => \"Following SLA\",\r\n                        startEventId: \"CaseTimerStartedFollowingSla\",\r\n                        endEventId: \"CaseTimerStoppedFollowingSla\",\r\n                        intervalType: \"FollowingSlaInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"NonworkingScheduledTimePeriodIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"NonworkingScheduledTimePeriodInterval-\"+evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceId,\r\n                        groupLabelFn: evt => \"Non-working Scheduled Time Period: \"+evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        intervalLabelFn: evt => \"Non-working Scheduled Time Period: \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        startEventId: \"Temporal:NonworkingScheduledTimePeriodBegan\",\r\n                        endEventId: \"Temporal:NonworkingScheduledTimePeriodEnded\",\r\n                        intervalType: \"NonworkingScheduledTimePeriodInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"SlaPauseIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"SlaPauseInterval-\"+evt.EventData.TemporalEventArgs.SourceId,\r\n                        groupLabelFn: evt => \"SLA Pause for \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        intervalLabelFn: evt => \"SLA Pause for \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        startEventId: \"Temporal:SlaPauseBegan\",\r\n                        endEventId: \"Temporal:SlaPauseEnded\",\r\n                        intervalType: \"SlaPauseInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                    {\r\n                        key: \"OffWorkTimePeriodIntervalKey\",\r\n                        intervalSeriesEventGroupingKeyFn: evt => \"OffWorkTimePeriodInterval-\"+evt.EventData.TemporalEventArgs.SourceId,\r\n                        groupLabelFn: evt => \"Off-work time period for \"+evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceNameName,\r\n                        intervalLabelFn: evt => \"Off-work time period for \" + evt.EventData.TemporalEventArgs.NonWorkingPeriod.SourceName,\r\n                        startEventId: \"Temporal:WorkPeriodEnded\",\r\n                        endEventId: \"Temporal:WorkPeriodBegan\",\r\n                        intervalType: \"OffWorkTimePeriodInterval\",\r\n                        customClass: 'interval-white',\r\n                    },\r\n                ];\r\n                //var intervalStartEventIds = intervalConfigs.map(ic => ic.startEventId);\r\n                //var intervalEndEventIds = intervalConfigs.map(ic => ic.endEventId);\r\n\r\n                // Define a function to create a grouping key from an event.  Each event will end up in at most 1 group.\r\n                let eventIntervalGroupingKeyFn = evt => {\r\n                    // find the first interval config that matches, cand call it's fn to generate the grouping key.\r\n                    var matchingIntervalConfig = intervalConfigs.find(ic => evt.EventIdentifierString.includes(ic.startEventId) || evt.EventIdentifierString.includes(ic.endEventId));\r\n                    if (!matchingIntervalConfig)\r\n                        return \"REMOVE\";\r\n                    //evt.intervalConfig = matchingIntervalConfig;  // attach this to the event here, so we don't have to resolve it again later\r\n                    return matchingIntervalConfig.key+\"::\"+matchingIntervalConfig.intervalSeriesEventGroupingKeyFn(evt);\r\n                };\r\n\r\n                // Create an array of interval groups\r\n                // Using D3.nest and the event interval grouping fn, create a series of time intervals for each distinct group of data for this timer\r\n                let timerIntervalSeriesArray = d3.nest()\r\n                    .key(eventIntervalGroupingKeyFn).entries(ct.Events)\r\n                    .filter(o => o.key != \"REMOVE\") // exclude all interval groups that yield a key of \"REMOVE\"\r\n                    .map(intervalGroup => {\r\n\r\n                        // extract the interval config key from the first part of the key\r\n                        var intervalConfigKey = intervalGroup.key.split('::')[0];\r\n                        // resolve the associated interval config using its key\r\n                        var intervalConfig = intervalConfigs.find(ic => ic.key == intervalConfigKey);\r\n\r\n                        // Ensure that the events of interest are sorted, so that intervals start and stop when appropriate.\r\n                        var eventsOfInterest = intervalGroup.values.sort((a,b) => a.EventTime*1 - b.EventTime*1);\r\n\r\n                        // Create intervals for this group from the events\r\n                        let intervals = [];\r\n                        for(var i = 0; i < eventsOfInterest.length; i += 2)\r\n                        {\r\n                            let curEvt = eventsOfInterest[i];\r\n                            let nextEvt = eventsOfInterest.length > i + 1 ? eventsOfInterest[i + 1] : null;\r\n                            let ic = intervalConfig;\r\n\r\n                            // Create and add interval object\r\n                            var intervalObj = {\r\n                                type: TimelineChart.TYPE.INTERVAL,\r\n                                intervalType: ic.intervalType,\r\n                                customClass: ic.customClass,\r\n                                label: ic.intervalLabelFn(curEvt),\r\n                                from: parseDateTime(curEvt.EventTime)\r\n                            };\r\n                            if (nextEvt != null)\r\n                            {\r\n                                // if both endpoints of interval are known\r\n                                intervalObj = Object.assign({\r\n                                    to: parseDateTime(nextEvt.EventTime),\r\n                                    data: [curEvt, nextEvt],\r\n                                    ids: ['i'+curEvt.Id, 'i'+nextEvt.Id],  // starting/ending event guids will serve as the ids\r\n                                    onClick: function(){ \r\n                                        //timeline.highlightNodeByIds('i'+curEvt.Id, true, 'chart-node-highlight');\r\n                                        renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                        renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, [curEvt, nextEvt]);\r\n                                    } \r\n                                }, intervalObj);\r\n                                nextEvt.interval = intervalObj;\r\n                            }\r\n                            else\r\n                            {\r\n                                // if only the starting time is known, the end time will be \"now\"\r\n                                intervalObj = Object.assign({\r\n                                    to: now,\r\n                                    data: [curEvt],\r\n                                    ids: ['i'+curEvt.Id ],  // starting event guid will serve as the id\r\n                                    onClick: function(){\r\n                                        //timeline.highlightNodeByIds('i'+curEvt.Id, true, 'chart-node-highlight');\r\n                                        renderLatestCaseTimersTable(caseTimerArray, [ ct ]);\r\n                                        renderEventDetailsTableAndSnapshotDetailsTableFromEvents(ct.Events, [curEvt]);\r\n                                    } \r\n                                }, intervalObj);\r\n                            }\r\n                            curEvt.interval = intervalObj; // Set the interval reference on the event object.  (NOTE: no event should be a member of > 1 interval.)\r\n                            intervals.push(intervalObj);\r\n                        }\r\n\r\n                        // return a new interval series\r\n                        return {\r\n                            label: intervalConfig.groupLabelFn(intervalGroup.values[0]),\r\n                            groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                            data: intervals\r\n                        };\r\n                    });\r\n                //console.log(\"timerIntervalSeriesArray: \", timerIntervalSeriesArray);\r\n                // end grouping of intervals\r\n\r\n\r\n                // Order and assign OrdinalId to Snapshots\r\n                ct.Snapshots.sort((a,b) => {\r\n                    // primary sort key is the snapshot time\r\n                    if (a.SnapshotTime < b.SnapshotTime) return -2;\r\n                    if (a.SnapshotTime > b.SnapshotTime) return 2;\r\n\r\n                    // secondary sort key is the modified time\r\n                    if (a.LastModified < b.LastModified) return -1;\r\n                    if (a.LastModified > b.LastModified) return 1;\r\n\r\n                    return 0;\r\n                });\r\n                // Number the snapshots\r\n                ct.Snapshots.forEach((ss, i) => { ss.OrdinalId = i+1; });\r\n\r\n                // For each snapshot, add a reference to the subsequent non-deried snapshot.\r\n                // This will represent the final non-derived state of the timer, for the purposes of displaying calculated times for each snapshot.\r\n                var subsequentNonDerivedSnapshot = {\r\n                    SnapshotTime: new Date(),\r\n                    OrdinalId: ct.Snapshots.length + 1,\r\n                    IsDerived: false,\r\n                    LastModified: new Date(),\r\n                    Id: null,\r\n                    SnapshotData: {\r\n                        CaseTimer: {\r\n                            CurrentEffectiveClockState: ct.CurrentEffectiveClockState,\r\n                            CurrentNonWorkingTimePeriodTypes: ct.CurrentNonWorkingTimePeriodTypes,\r\n                            ElapsedTime: ct.ElapsedTime,\r\n                            Offset: ct.Offset,\r\n                            RunTime: ct.RunTime,\r\n                            LastCalculated: ct.LastCalculated\r\n                        }\r\n                    }\r\n                };\r\n                var snapshotsReversed = ct.Snapshots.slice(0).reverse();\r\n                snapshotsReversed.forEach(ss => {\r\n                    ss.SubsequentNonDerivedSnapshot = subsequentNonDerivedSnapshot;\r\n                    if (!ss.IsDerived) subsequentNonDerivedSnapshot = ss;\r\n                });\r\n\r\n\r\n                // Create series for calculation intervals\r\n                var calculationIntervalsSeries = {\r\n                    label: `Calculation Intervals`,\r\n                    groupingKey: ct.Id,  // The case timer Id is a suitable grouping key\r\n                    data: []\r\n                };\r\n                ct.Snapshots.filter(x => !x.IsDerived)\r\n                    .forEach(ss => {\r\n                        var curSD = ss.SnapshotData;\r\n                        var nextSD = ss.SubsequentNonDerivedSnapshot.SnapshotData;\r\n                        var intervalObj = {\r\n                            type: TimelineChart.TYPE.INTERVAL,\r\n                            intervalType: 'CalculationInterval',\r\n                            customClass: '', //ic.customClass,\r\n                            label: '', //ic.intervalLabelFn(curEvt),\r\n                            from: curSD.CaseTimer.LastCalculated || curSD.CaseTimer.Started,\r\n                            to: nextSD.CaseTimer.LastCalculated,\r\n                            data: [curSD, nextSD],\r\n                            ids: [],\r\n                            onClick: null\r\n                        };\r\n                        calculationIntervalsSeries.data.push(intervalObj);\r\n                    });\r\n                // var ci_ss =  ct.Snapshots[0];\r\n                // while (ci_ss.SubsequentNonDerivedSnapshot) {\r\n                //     var data = [  ];\r\n                    \r\n                //     ci_ss = ci_ss.SubsequentNonDerivedSnapshot;\r\n                // }\r\n\r\n                \r\n                // Order and assign OrdinalId to Events\r\n                // Getting events sorted in an intuitive way is more complex than one might suppose.\r\n                // Here, we sort by the following things, in this particular order:\r\n                //  1. event date\r\n                //  2. intervals that each event is a part of\r\n                //  3. related snapshot time\r\n                var getIntervalPointAvgDate = p => p.type === TimelineChart.TYPE.POINT ? p.at : new Date(p.from * 1 + (p.to - p.from)/2);\r\n                ct.Events.sort((a,b) => {\r\n                    // primary sort key is the event time\r\n                    if (a.EventTime < b.EventTime) return -3;\r\n                    if (a.EventTime > b.EventTime) return 3;\r\n                    \r\n                    // tertiary sort key is the related snapshot time\r\n                    if (a.CaseTimerSnapshot.SnapshotTime*1 < b.CaseTimerSnapshot.SnapshotTime*1) return -2;\r\n                    if (a.CaseTimerSnapshot.SnapshotTime*1 > b.CaseTimerSnapshot.SnapshotTime*1) return 2;\r\n\r\n                    // secondary sort key is the related interval time\r\n                    var aAvgDate = getIntervalPointAvgDate(a.interval || a.point);\r\n                    var bAvgDate = getIntervalPointAvgDate(b.interval || b.point);\r\n                    if (aAvgDate < bAvgDate) return -1;\r\n                    if (aAvgDate > bAvgDate) return 1;\r\n\r\n                    return 0;\r\n                });\r\n                // Number the events\r\n                ct.Events.forEach((evt, i) => { evt.OrdinalId = i+1; });\r\n\r\n                var allSeriesForTimer = [ timerEventsSeries, timerSnapshotsSeries, calculationIntervalsSeries].concat(timerIntervalSeriesArray);\r\n\r\n                return allSeriesForTimer;\r\n            })\r\n            // flatten the array of timeline data series arrays into a single array of TDS.\r\n            .reduce((accumulator, currentValue) => accumulator.concat(currentValue));\r\n\r\n            // At this point, there will be multiple series associated with each timer.\r\n            // We want to provide some sort of visual grouping mechanism so that all series associated with the same case timer can be visually grouped.\r\n            // Transform the group key to a 0-based index.\r\n            var newGroupNumber = 0;\r\n            var lastGroupKey = \"----------------\";\r\n            allTimelineSeriesForAllTimers.forEach((x) => {\r\n                if (lastGroupKey != x.groupingKey)\r\n                {\r\n                    lastGroupKey = x.groupingKey;\r\n                    newGroupNumber++;\r\n                }\r\n                x.groupingKey = newGroupNumber;\r\n            });\r\n\r\n            //console.log(\"TimelineSeries: \", allTimelineSeriesForAllTimers);\r\n            return allTimelineSeriesForAllTimers;\r\n        }\r\n\r\n    }\r\n\r\n    updateTimelineData(newCaseData) {\r\n        this.renderCaseData(newCaseData);\r\n    }\r\n\r\n}\r\n\r\n\r\nmodule.exports = CaseTimerEventViewer;\r\n\r\n"]}